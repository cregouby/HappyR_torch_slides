<!DOCTYPE html>
<html lang="en"><head>
<script src="index_files/libs/clipboard/clipboard.min.js"></script>
<script src="index_files/libs/quarto-html/tabby.min.js"></script>
<script src="index_files/libs/quarto-html/popper.min.js"></script>
<script src="index_files/libs/quarto-html/tippy.umd.min.js"></script>
<link href="index_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="index_files/libs/quarto-html/light-border.css" rel="stylesheet">
<link href="index_files/libs/quarto-html/quarto-syntax-highlighting-dark-0e5c805777bb127c27a6fd03f558df56.css" rel="stylesheet" id="quarto-text-highlighting-styles"><meta charset="utf-8">
  <meta name="generator" content="quarto-1.6.26">

  <meta name="author" content="Christophe Regouby">
  <title>{torch} {tabnet} and friends</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
  <link rel="stylesheet" href="index_files/libs/revealjs/dist/reset.css">
  <link rel="stylesheet" href="index_files/libs/revealjs/dist/reveal.css">
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      width: 0.8em;
      margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
      vertical-align: middle;
    }
    /* CSS for syntax highlighting */
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #97947a;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #97947a;  padding-left: 4px; }
    div.sourceCode
      { color: #f8f8f2; background-color: #2b2b2b; }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span { color: #f8f8f2; } /* Normal */
    code span.al { color: #dcc6e0; } /* Alert */
    code span.an { color: #d4d0ab; } /* Annotation */
    code span.at { color: #ffd700; } /* Attribute */
    code span.bn { color: #dcc6e0; } /* BaseN */
    code span.bu { color: #f5ab35; } /* BuiltIn */
    code span.cf { color: #ffa07a; } /* ControlFlow */
    code span.ch { color: #abe338; } /* Char */
    code span.cn { color: #ffa07a; } /* Constant */
    code span.co { color: #d4d0ab; } /* Comment */
    code span.cv { color: #d4d0ab; font-style: italic; } /* CommentVar */
    code span.do { color: #d4d0ab; font-style: italic; } /* Documentation */
    code span.dt { color: #dcc6e0; } /* DataType */
    code span.dv { color: #dcc6e0; } /* DecVal */
    code span.er { color: #dcc6e0; } /* Error */
    code span.ex { color: #ffd700; } /* Extension */
    code span.fl { color: #f5ab35; } /* Float */
    code span.fu { color: #ffd700; } /* Function */
    code span.im { color: #f8f8f2; } /* Import */
    code span.in { color: #d4d0ab; } /* Information */
    code span.kw { color: #ffa07a; } /* Keyword */
    code span.op { color: #00e0e0; } /* Operator */
    code span.ot { color: #ffa07a; } /* Other */
    code span.pp { color: #dcc6e0; } /* Preprocessor */
    code span.sc { color: #00e0e0; } /* SpecialChar */
    code span.ss { color: #abe338; } /* SpecialString */
    code span.st { color: #abe338; } /* String */
    code span.va { color: #f5ab35; } /* Variable */
    code span.vs { color: #abe338; } /* VerbatimString */
    code span.wa { color: #d4d0ab; font-style: italic; } /* Warning */
  </style>
  <link rel="stylesheet" href="index_files/libs/revealjs/dist/theme/quarto-afb32920961a3c76c639f634e4316aa3.css">
  <link href="index_files/libs/revealjs/plugin/quarto-line-highlight/line-highlight.css" rel="stylesheet">
  <link href="index_files/libs/revealjs/plugin/reveal-menu/menu.css" rel="stylesheet">
  <link href="index_files/libs/revealjs/plugin/reveal-menu/quarto-menu.css" rel="stylesheet">
  <link href="index_files/libs/revealjs/plugin/reveal-chalkboard/font-awesome/css/all.css" rel="stylesheet">
  <link href="index_files/libs/revealjs/plugin/reveal-chalkboard/style.css" rel="stylesheet">
  <link href="index_files/libs/revealjs/plugin/quarto-support/footer.css" rel="stylesheet">
  <style type="text/css">

  .callout {
    margin-top: 1em;
    margin-bottom: 1em;  
    border-radius: .25rem;
  }

  .callout.callout-style-simple { 
    padding: 0em 0.5em;
    border-left: solid #acacac .3rem;
    border-right: solid 1px silver;
    border-top: solid 1px silver;
    border-bottom: solid 1px silver;
    display: flex;
  }

  .callout.callout-style-default {
    border-left: solid #acacac .3rem;
    border-right: solid 1px silver;
    border-top: solid 1px silver;
    border-bottom: solid 1px silver;
  }

  .callout .callout-body-container {
    flex-grow: 1;
  }

  .callout.callout-style-simple .callout-body {
    font-size: 1rem;
    font-weight: 400;
  }

  .callout.callout-style-default .callout-body {
    font-size: 0.9rem;
    font-weight: 400;
  }

  .callout.callout-titled.callout-style-simple .callout-body {
    margin-top: 0.2em;
  }

  .callout:not(.callout-titled) .callout-body {
      display: flex;
  }

  .callout:not(.no-icon).callout-titled.callout-style-simple .callout-content {
    padding-left: 1.6em;
  }

  .callout.callout-titled .callout-header {
    padding-top: 0.2em;
    margin-bottom: -0.2em;
  }

  .callout.callout-titled .callout-title  p {
    margin-top: 0.5em;
    margin-bottom: 0.5em;
  }
    
  .callout.callout-titled.callout-style-simple .callout-content  p {
    margin-top: 0;
  }

  .callout.callout-titled.callout-style-default .callout-content  p {
    margin-top: 0.7em;
  }

  .callout.callout-style-simple div.callout-title {
    border-bottom: none;
    font-size: .9rem;
    font-weight: 600;
    opacity: 75%;
  }

  .callout.callout-style-default  div.callout-title {
    border-bottom: none;
    font-weight: 600;
    opacity: 85%;
    font-size: 0.9rem;
    padding-left: 0.5em;
    padding-right: 0.5em;
  }

  .callout.callout-style-default div.callout-content {
    padding-left: 0.5em;
    padding-right: 0.5em;
  }

  .callout.callout-style-simple .callout-icon::before {
    height: 1rem;
    width: 1rem;
    display: inline-block;
    content: "";
    background-repeat: no-repeat;
    background-size: 1rem 1rem;
  }

  .callout.callout-style-default .callout-icon::before {
    height: 0.9rem;
    width: 0.9rem;
    display: inline-block;
    content: "";
    background-repeat: no-repeat;
    background-size: 0.9rem 0.9rem;
  }

  .callout-title {
    display: flex
  }
    
  .callout-icon::before {
    margin-top: 1rem;
    padding-right: .5rem;
  }

  .callout.no-icon::before {
    display: none !important;
  }

  .callout.callout-titled .callout-body > .callout-content > :last-child {
    padding-bottom: 0.5rem;
    margin-bottom: 0;
  }

  .callout.callout-titled .callout-icon::before {
    margin-top: .5rem;
    padding-right: .5rem;
  }

  .callout:not(.callout-titled) .callout-icon::before {
    margin-top: 1rem;
    padding-right: .5rem;
  }

  /* Callout Types */

  div.callout-note {
    border-left-color: #4582ec !important;
  }

  div.callout-note .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAAEU0lEQVRYCcVXTWhcVRQ+586kSUMMxkyaElstCto2SIhitS5Ek8xUKV2poatCcVHtUlFQk8mbaaziwpWgglJwVaquitBOfhQXFlqlzSJpFSpIYyXNjBNiTCck7x2/8/LeNDOZxDuEkgOXe++553zfefee+/OYLOXFk3+1LLrRdiO81yNqZ6K9cG0P3MeFaMIQjXssE8Z1JzLO9ls20MBZX7oG8w9GxB0goaPrW5aNMp1yOZIa7Wv6o2ykpLtmAPs/vrG14Z+6d4jpbSKuhdcSyq9wGMPXjonwmESXrriLzFGOdDBLB8Y6MNYBu0dRokSygMA/mrun8MGFN3behm6VVAwg4WR3i6FvYK1T7MHo9BK7ydH+1uurECoouk5MPRyVSBrBHMYwVobG2aOXM07sWrn5qgB60rc6mcwIDJtQrnrEr44kmy+UO9r0u9O5/YbkS9juQckLed3DyW2XV/qWBBB3ptvI8EUY3I9p/67OW+g967TNr3Sotn3IuVlfMLVnsBwH4fsnebJvyGm5GeIUA3jljERmrv49SizPYuq+z7c2H/jlGC+Ghhupn/hcapqmcudB9jwJ/3jvnvu6vu5lVzF1fXyZuZZ7U8nRmVzytvT+H3kilYvH09mLWrQdwFSsFEsxFVs5fK7A0g8gMZjbif4ACpKbjv7gNGaD8bUrlk8x+KRflttr22JEMRUbTUwwDQScyzPgedQHZT0xnx7ujw2jfVfExwYHwOsDTjLdJ2ebmeQIlJ7neo41s/DrsL3kl+W2lWvAga0tR3zueGr6GL78M3ifH0rGXrBC2aAR8uYcIA5gwV8zIE8onoh8u0Fca/ciF7j1uOzEnqcIm59sEXoGc0+z6+H45V1CvAvHcD7THztu669cnp+L0okAeIc6zjbM/24LgGM1gZk7jnRu1aQWoU9sfUOuhrmtaPIO3YY1KLLWZaEO5TKUbMY5zx8W9UJ6elpLwKXbsaZ4EFl7B4bMtDv0iRipKoDQT2sNQI9b1utXFdYisi+wzZ/ri/1m7QfDgEuvgUUEIJPq3DhX/5DWNqIXDOweC2wvIR90Oq3lDpdMIgD2r0dXvGdsEW5H6x6HLRJYU7C69VefO1x8Gde1ZFSJLfWS1jbCnhtOPxmpfv2LXOA2Xk2tvnwKKPFuZ/oRmwBwqRQDcKNeVQkYcOjtWVBuM/JuYw5b6isojIkYxyYAFn5K7ZBF10fea52y8QltAg6jnMqNHFBmGkQ1j+U43HMi2xMar1Nv0zGsf1s8nUsmUtPOOrbFIR8bHFDMB5zL13Gmr/kGlCkUzedTzzmzsaJXhYawnA3UmARpiYj5ooJZiUoxFRtK3X6pgNPv+IZVPcnwbOl6f+aBaO1CNvPW9n9LmCp01nuSaTRF2YxHqZ8DYQT6WsXT+RD6eUztwYLZ8rM+rcPxamv1VQzFUkzFXvkiVrySGQgJNvXHJAxiU3/NwiC03rSf05VBaPtu/Z7/B8Yn/w7eguloAAAAAElFTkSuQmCC');
  }

  div.callout-note.callout-style-default .callout-title {
    background-color: #dae6fb
  }

  div.callout-important {
    border-left-color: #d9534f !important;
  }

  div.callout-important .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAAEKklEQVRYCcVXTWhcVRS+575MJym48A+hSRFr00ySRQhURRfd2HYjk2SSTokuBCkU2o0LoSKKraKIBTcuFCoidGFD08nkBzdREbpQ1EDNIv8qSGMFUboImMSZd4/f9zJv8ibJMC8xJQfO3HPPPef7zrvvvnvviIkpC9nsw0UttFunbUhpFzFtarSd6WJkStVMw5xyVqYTvkwfzuf/5FgtkVoB0729j1rjXwThS7Vio+Mo6DNnvLfahoZ+i/o32lULuJ3NNiz7q6+pyAUkJaFF6JwaM2lUJlV0MlnQn5aTRbEu0SEqHUa0A4AdiGuB1kFXRfVyg5d87+Dg4DL6m2TLAub60ilj7A1Ec4odSAc8X95sHh7+ZRPCFo6Fnp7HfU/fBng/hi10CjCnWnJjsxvDNxWw0NfV6Rv5GgP3I3jGWXumdTD/3cbEOP2ZbOZp69yniG3FQ9z1jD7bnBu9Fc2tKGC2q+uAJOQHBDRiZX1x36o7fWBs7J9ownbtO+n0/qWkvW7UPIfc37WgT6ZGR++EOJyeQDSb9UB+DZ1G6DdLDzyS+b/kBCYGsYgJbSQHuThGKRcw5xdeQf8YdNHsc6ePXrlSYMBuSIAFTGAtQo+VuALo4BX83N190NWZWbynBjhOHsmNfFWLeL6v+ynsA58zDvvAC8j5PkbOcXCMg2PZFk3q8MjI7WAG/Dp9AwP7jdGBOOQkAvlFUB+irtm16I1Zw9YBcpGTGXYmk3kQIC/Cds55l+iMI3jqhjAuaoe+am2Jw5GT3Nbz3CkE12NavmzN5+erJW7046n/CH1RO/RVa8lBLozXk9uqykkGAyRXLWlLv5jyp4RFsG5vGVzpDLnIjTWgnRy2Rr+tDKvRc7Y8AyZq10jj8DqXdnIRNtFZb+t/ZRtXcDiVnzpqx8mPcDWxgARUqx0W1QB9MeUZiNrV4qP+Ehc+BpNgATsTX8ozYKL2NtFYAHc84fG7ndxUPr+AR/iQSns7uSUufAymwDOb2+NjK27lEFocm/EE2WpyIy/Hi66MWuMKJn8RvxIcj87IM5Vh9663ziW36kR0HNenXuxmfaD8JC7tfKbrhFr7LiZCrMjrzTeGx+PmkosrkNzW94ObzwocJ7A1HokLolY+AvkTiD/q1H0cN48c5EL8Crkttsa/AXQVDmutfyku0E7jShx49XqV3MFK8IryDhYVbj7Sj2P2eBxwcXoe8T8idsKKPRcnZw1b+slFTubwUwhktrfnAt7J++jwQtLZcm3sr9LQrjRzz6cfMv9aLvgmnAGvpoaGLxM4mAEaLV7iAzQ3oU0IvD5x9ix3yF2RAAuYAOO2f7PEFWCXZ4C9Pb2UsgDeVnFSpbFK7/IWu7TPTvBqzbGdCHOJQSxiEjt6IyZmxQyEJHv6xyQsYk//moVFsN2zP6fRImjfq7/n/wFDguUQFNEwugAAAABJRU5ErkJggg==');
  }

  div.callout-important.callout-style-default .callout-title {
    background-color: #f7dddc
  }

  div.callout-warning {
    border-left-color: #f0ad4e !important;
  }

  div.callout-warning .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAAETklEQVRYCeVWW2gcVRg+58yaTUnizqbipZeX4uWhBEniBaoUX1Ioze52t7sRq6APio9V9MEaoWlVsFasRq0gltaAPuxms8lu0gcviE/FFOstVbSIxgcv6SU7EZqmdc7v9+9mJtNks51NTUH84ed889/PP+cmxP+d5FIbMJmNbpREu4WUkiTtCicKny0l1pIKmBzovF2S+hIJHX8iEu3hZJ5lNZGqyRrGSIQpq15AzF28jgpeY6yk6GVdrfFqdrD6Iw+QlB8g0YS2g7dyQmXM/IDhBhT0UCiRf59lfqmmDvzRt6kByV/m4JjtzuaujMUM2c5Z2d6JdKrRb3K2q6mA+oYVz8JnDdKPmmNthzkAk/lN63sYPgevrguc72aZX/L9C6x09GYyxBgCX4NlvyGUHOKELlm5rXeR1kchuChJt4SSwyddZRXgvwMGvYo4QSlk3/zkHD8UHxwVJA6zjZZqP8v8kK8OWLnIZtLyCAJagYC4rTGW/9Pqj92N/c+LUaAj27movwbi19tk/whRCIE7Q9vyI6yvRpftAKVTdUjOW40X3h5OXsKCdmFcx0xlLJoSuQngnrJe7Kcjm4OMq9FlC7CMmScQANuNvjfP3PjGXDBaUQmbp296S5L4DrpbrHN1T87ZVEZVCzg1FF0Ft+dKrlLukI+/c9ENo+TvlTDbYFvuKPtQ9+l052rXrgKoWkDAFnvh0wTOmYn8R5f4k/jN/fZiCM1tQx9jQQ4ANhqG4hiL0qIFTGViG9DKB7GYzgubnpofgYRwO+DFjh0Zin2m4b/97EDkXkc+f6xYAPX0KK2I/7fUQuwzuwo/L3AkcjugPNixC8cHf0FyPjWlItmLxWw4Ou9YsQCr5fijMGoD/zpdRy95HRysyXA74MWOnscpO4j2y3HAVisw85hX5+AFBRSHt4ShfLFkIMXTqyKFc46xdzQM6XbAi702a7sy04J0+feReMFKp5q9esYLCqAZYw/k14E/xcLLsFElaornTuJB0svMuJINy8xkIYuL+xPAlWRceH6+HX7THJ0djLUom46zREu7tTkxwmf/FdOZ/sh6Q8qvEAiHpm4PJ4a/doJe0gH1t+aHRgCzOvBvJedEK5OFE5jpm4AGP2a8Dxe3gGJ/pAutug9Gp6he92CsSsWBaEcxGx0FHytmIpuqGkOpldqNYQK8cSoXvd+xLxXADw0kf6UkJNFtdo5MOgaLjiQOQHcn+A6h5NuL2s0qsC2LOM75PcF3yr5STuBSAcGG+meA14K/CI21HcS4LBT6tv0QAh8Dr5l93AhZzG5ZJ4VxAqdZUEl9z7WJ4aN+svMvwHHL21UKTd1mqvChH7/Za5xzXBBKrUcB0TQ+Ulgkfbi/H/YT5EptrGzsEK7tR1B7ln9BBwckYfMiuSqklSznIuoIIOM42MQO+QnduCoFCI0bpkzjCjddHPN/F+2Yu+sd9bKNpVwHhbS3LluK/0zgfwD0xYI5dXuzlQAAAABJRU5ErkJggg==');
  }

  div.callout-warning.callout-style-default .callout-title {
    background-color: #fcefdc
  }

  div.callout-tip {
    border-left-color: #02b875 !important;
  }

  div.callout-tip .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAADr0lEQVRYCe1XTWgTQRj9ZjZV8a9SPIkKgj8I1bMHsUWrqYLVg4Ue6v9BwZOxSYsIerFao7UiUryIqJcqgtpimhbBXoSCVxUFe9CTiogUrUp2Pt+3aUI2u5vdNh4dmMzOzHvvezuz8xNFM0mjnbXaNu1MvFWRXkXEyE6aYOYJpdW4IXuA4r0fo8qqSMDBU0v1HJUgVieAXxzCsdE/YJTdFcVIZQNMyhruOMJKXYFoLfIfIvVIMWdsrd+Rpd86ZmyzzjJmLStqRn0v8lzkb4rVIXvnpScOJuAn2ACC65FkPzEdEy4TPWRLJ2h7z4cArXzzaOdKlbOvKKX25Wl00jSnrwVxAg3o4dRxhO13RBSdNvH0xSARv3adTXbBdTf64IWO2vH0LT+cv4GR1DJt+DUItaQogeBX/chhbTBxEiZ6gftlDNXTrvT7co4ub5A6gp9HIcHvzTa46OS5fBeP87Qm0fQkr4FsYgVQ7Qg+ZayaDg9jhg1GkWj8RG6lkeSacrrHgDaxdoBiZPg+NXV/KifMuB6//JmYH4CntVEHy/keA6x4h4CU5oFy8GzrBS18cLJMXcljAKB6INjWsRcuZBWVaS3GDrqB7rdapVIeA+isQ57Eev9eCqzqOa81CY05VLd6SamW2wA2H3SiTbnbSxmzfp7WtKZkqy4mdyAlGx7ennghYf8voqp9cLSgKdqNfa6RdRsAAkPwRuJZNbpByn+RrJi1RXTwdi8RQF6ymDwGMAtZ6TVE+4uoKh+MYkcLsT0Hk8eAienbiGdjJHZTpmNjlbFJNKDVAp2fJlYju6IreQxQ08UJDNYdoLSl6AadO+fFuCQqVMB1NJwPm69T04Wv5WhfcWyfXQB+wXRs1pt+nCknRa0LVzSA/2B+a9+zQJadb7IyyV24YAxKp2Jqs3emZTuNnKxsah+uabKbMk7CbTgJx/zIgQYErIeTKRQ9yD9wxVof5YolPHqaWo7TD6tJlh7jQnK5z2n3+fGdggIOx2kaa2YI9QWarc5Ce1ipNWMKeSG4DysFF52KBmTNMmn5HqCFkwy34rDg05gDwgH3bBi+sgFhN/e8QvRn8kbamCOhgrZ9GJhFDgfcMHzFb6BAtjKpFhzTjwv1KCVuxHvCbsSiEz4CANnj84cwHdFXAbAOJ4LTSAawGWFn5tDhLMYz6nWeU2wJfIhmIJBefcd/A5FWQWGgrWzyORZ3Q6HuV+Jf0Bj+BTX69fm1zWgK7By1YTXchFDORywnfQ7GpzOo6S+qECrsx2ifVQAAAABJRU5ErkJggg==');
  }

  div.callout-tip.callout-style-default .callout-title {
    background-color: #ccf1e3
  }

  div.callout-caution {
    border-left-color: #fd7e14 !important;
  }

  div.callout-caution .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAACV0lEQVRYCdVWzWoUQRCuqp2ICBLJXgITZL1EfQDBW/bkzUMUD7klD+ATSHBEfAIfQO+iXsWDxJsHL96EHAwhgzlkg8nBg25XWb0zIb0zs9muYYWkoKeru+vn664fBqElyZNuyh167NXJ8Ut8McjbmEraKHkd7uAnAFku+VWdb3reSmRV8PKSLfZ0Gjn3a6Xlcq9YGb6tADjn+lUfTXtVmaZ1KwBIvFI11rRXlWlatwIAAv2asaa9mlB9wwygiDX26qaw1yYPzFXg2N1GgG0FMF8Oj+VIx7E/03lHx8UhvYyNZLN7BwSPgekXXLribw7w5/c8EF+DBK5idvDVYtEEwMeYefjjLAdEyQ3M9nfOkgnPTEkYU+sxMq0BxNR6jExrAI31H1rzvLEfRIdgcv1XEdj6QTQAS2wtstEALLG1yEZ3QhH6oDX7ExBSFEkFINXH98NTrme5IOaaA7kIfiu2L8A3qhH9zRbukdCqdsA98TdElyeMe5BI8Rs2xHRIsoTSSVFfCFCWGPn9XHb4cdobRIWABNf0add9jakDjQJpJ1bTXOJXnnRXHRf+dNL1ZV1MBRCXhMbaHqGI1JkKIL7+i8uffuP6wVQAzO7+qVEbF6NbS0LJureYcWXUUhH66nLR5rYmva+2tjRFtojkM2aD76HEGAD3tPtKM309FJg5j/K682ywcWJ3PASCcycH/22u+Bh7Aa0ehM2Fu4z0SAE81HF9RkB21c5bEn4Dzw+/qNOyXr3DCTQDMBOdhi4nAgiFDGCinIa2owCEChUwD8qzd03PG+qdW/4fDzjUMcE1ZpIAAAAASUVORK5CYII=');
  }

  div.callout-caution.callout-style-default .callout-title {
    background-color: #ffe5d0
  }

  </style>
  <style type="text/css">
    .reveal div.sourceCode {
      margin: 0;
      overflow: auto;
    }
    .reveal div.hanging-indent {
      margin-left: 1em;
      text-indent: -1em;
    }
    .reveal .slide:not(.center) {
      height: 100%;
    }
    .reveal .slide.scrollable {
      overflow-y: auto;
    }
    .reveal .footnotes {
      height: 100%;
      overflow-y: auto;
    }
    .reveal .slide .absolute {
      position: absolute;
      display: block;
    }
    .reveal .footnotes ol {
      counter-reset: ol;
      list-style-type: none; 
      margin-left: 0;
    }
    .reveal .footnotes ol li:before {
      counter-increment: ol;
      content: counter(ol) ". "; 
    }
    .reveal .footnotes ol li > p:first-child {
      display: inline-block;
    }
    .reveal .slide ul,
    .reveal .slide ol {
      margin-bottom: 0.5em;
    }
    .reveal .slide ul li,
    .reveal .slide ol li {
      margin-top: 0.4em;
      margin-bottom: 0.2em;
    }
    .reveal .slide ul[role="tablist"] li {
      margin-bottom: 0;
    }
    .reveal .slide ul li > *:first-child,
    .reveal .slide ol li > *:first-child {
      margin-block-start: 0;
    }
    .reveal .slide ul li > *:last-child,
    .reveal .slide ol li > *:last-child {
      margin-block-end: 0;
    }
    .reveal .slide .columns:nth-child(3) {
      margin-block-start: 0.8em;
    }
    .reveal blockquote {
      box-shadow: none;
    }
    .reveal .tippy-content>* {
      margin-top: 0.2em;
      margin-bottom: 0.7em;
    }
    .reveal .tippy-content>*:last-child {
      margin-bottom: 0.2em;
    }
    .reveal .slide > img.stretch.quarto-figure-center,
    .reveal .slide > img.r-stretch.quarto-figure-center {
      display: block;
      margin-left: auto;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-left,
    .reveal .slide > img.r-stretch.quarto-figure-left  {
      display: block;
      margin-left: 0;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-right,
    .reveal .slide > img.r-stretch.quarto-figure-right  {
      display: block;
      margin-left: auto;
      margin-right: 0; 
    }
  </style>
  <link href="index_files/libs/countdown-0.4.0/countdown.css" rel="stylesheet">
  <script src="index_files/libs/countdown-0.4.0/countdown.js"></script>
</head>
<body class="quarto-dark">
  <div class="reveal">
    <div class="slides">

<section id="title-slide" class="quarto-title-block center">
  <h1 class="title">{torch} {tabnet} and friends</h1>
  <p class="subtitle">Atelier HappyR, sept 2024</p>

<div class="quarto-title-authors">
<div class="quarto-title-author">
<div class="quarto-title-author-name">
Christophe Regouby 
</div>
</div>
</div>

</section>
<section id="agenda" class="title-slide slide level1 center">
<h1>Agenda</h1>
<p>Getting started</p>
<p>{torch}</p>
<p>mlverse</p>
<p>{tabnet}</p>
<p>{tabnet} pour la regression avec valeurs manquantes</p>
<p>{tabnet} pour la classification hierarchique</p>
<p>GPT2 avec R</p>
<p>Fine-Tuning de GPT2 en français avec un LORA</p>
<p>Un classifieur d’images avec ResNext50 fine-tuning</p>
</section>

<section>
<section id="getting-started" class="title-slide slide level1 center">
<h1>Getting started</h1>

</section>
<section class="slide level2">


<img data-src="images/clipboard-1733121037.png" class="r-stretch"></section>
<section id="licensing" class="slide level2">
<h2>Licensing</h2>
<p><br> <br> This work is licensed under a <a href="https://creativecommons.org/licenses/by-sa/4.0/">Creative Commons Attribution-ShareAlike 4.0 International License</a> (CC BY-SA4.0).</p>
</section>
<section id="checklist" class="slide level2">
<h2>Checklist</h2>
<p><br></p>
<p><svg aria-hidden="true" role="img" viewbox="0 0 448 512" style="height:1em;width:0.88em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:#C7B41D;overflow:visible;position:relative;"><path d="M438.6 105.4c12.5 12.5 12.5 32.8 0 45.3l-256 256c-12.5 12.5-32.8 12.5-45.3 0l-128-128c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0L160 338.7 393.4 105.4c12.5-12.5 32.8-12.5 45.3 0z"></path></svg> R &amp; RStudio installed?</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp; I’m on 4.4.1 and 2024.08.0 build 351</p>
<p><svg aria-hidden="true" role="img" viewbox="0 0 448 512" style="height:1em;width:0.88em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:#C7B41D;overflow:visible;position:relative;"><path d="M438.6 105.4c12.5 12.5 12.5 32.8 0 45.3l-256 256c-12.5 12.5-32.8 12.5-45.3 0l-128-128c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0L160 338.7 393.4 105.4c12.5-12.5 32.8-12.5 45.3 0z"></path></svg> {torch} installed?</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp; <code>torch::torch_is_installed()</code><br> &nbsp;&nbsp;&nbsp;&nbsp; <em>Your system is ready!</em></p>
<p><svg aria-hidden="true" role="img" viewbox="0 0 448 512" style="height:1em;width:0.88em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:#C7B41D;overflow:visible;position:relative;"><path d="M438.6 105.4c12.5 12.5 12.5 32.8 0 45.3l-256 256c-12.5 12.5-32.8 12.5-45.3 0l-128-128c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0L160 338.7 393.4 105.4c12.5-12.5 32.8-12.5 45.3 0z"></path></svg> Any {torch} device ?</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp; <code>torch::backends_xxxx_is_available()</code><br> &nbsp;&nbsp;&nbsp;&nbsp; <em>Your system has power!</em></p>
</section>
<section id="autres-ressources" class="slide level2 smaller">
<h2>Autres ressources</h2>
<ul>
<li><p>torch for R <em>website</em> <br> <a href="https://torch.mlverse.org/" class="uri">https://torch.mlverse.org/</a></p></li>
<li><p>Deep-Learning and scientific computing with R <em>book</em> <br> <a href="https://skeydan.github.io/Deep-Learning-and-Scientific-Computing-with-R-torch/" class="uri">https://skeydan.github.io/Deep-Learning-and-Scientific-Computing-with-R-torch/</a></p></li>
<li><p>torch for R <em>cheatsheet</em> <br> <a href="https://rstudio.github.io/cheatsheets/torch.pdf" class="uri">https://rstudio.github.io/cheatsheets/torch.pdf</a></p></li>
<li><p>Deep-learning avec torch <em>Aide-mémoire</em> <br> <a href="https://github.com/rstudio/cheatsheets/blob/main/translations/french/torch_fr.pdf" class="uri">https://github.com/rstudio/cheatsheets/blob/main/translations/french/torch_fr.pdf</a></p></li>
<li><p>Tutoriel de UseR2021! <a href="https://github.com/mlverse/torch-learnr" class="uri">https://github.com/mlverse/torch-learnr</a></p></li>
<li><p>Tutoriel des RencontresR 2024 par Tristan Mary-Huard : <a href="https://stateofther.github.io/finistR2022/autodiff.html" class="uri">https://stateofther.github.io/finistR2022/autodiff.html</a></p></li>
<li><p>le blog AI de Posit (avec la catégorie torch): <a href="https://blogs.rstudio.com/ai/#category:Torch" class="uri">https://blogs.rstudio.com/ai/#category:Torch</a></p></li>
</ul>
<div class="footer">

</div>
</section></section>
<section>
<section id="torch" class="title-slide slide level1 center">
<h1>{torch}</h1>

</section>
<section id="section" class="slide level2">
<h2><img data-src="images/clipboard-3520749809.png"><img data-src="images/clipboard-4058077362.png"></h2>
</section>
<section id="section-1" class="slide level2">
<h2><img data-src="images/clipboard-154709511.png"></h2>
<div class="footer">
<p>source https://xkcd.com/1987/</p>
</div>
</section>
<section id="section-2" class="slide level2">
<h2><img data-src="images/clipboard-1267880778.png"></h2>
<div class="footer">
<p>source https://xkcd.com/1987/</p>
</div>
</section>
<section id="section-3" class="slide level2">
<h2><a href="https://torch.mlverse.org/"><img data-src="images/clipboard-604787592.png"></a></h2>
<div class="footer">
<p>et {torchdatasets}, {minhub}, {tok}, {hfhub}, {safetensors}, {tabnet}, {ETM}, {tft}, {innsight}, {brulee},…</p>
</div>
</section>
<section id="torch-pourquoi-réinventer-leau-chaude" class="slide level2">
<h2>{torch} : pourquoi réinventer l’eau chaude?</h2>
<div class="small">
<ul>
<li><p>facilité d’installation CPU, GPU, MPS, …</p></li>
<li><p>frugalité d’installation</p></li>
<li><p>confort de RStudio pour développer, déverminer, visualiser</p></li>
<li><p>confort de R pour l’indexation à 1</p></li>
<li><p>la qualité des articles de blog de Posit AI blog</p></li>
<li><p>l’écosystème des packages</p></li>
<li><p>plein de possibilités de contributions</p></li>
</ul>
<p><img data-src="images/clipboard-872398520.png"></p>
</div>
</section>
<section id="installation" class="slide level2">
<h2>Installation</h2>
<p>Nominale</p>
<p><img data-src="images/clipboard-1225111648.png"></p>
<p>Avancée</p>
<p><img data-src="images/clipboard-2395058596.png"></p>
<div class="footer">
<p>https://torch.mlverse.org/docs/articles/installation.html</p>
</div>
</section>
<section class="slide level2">

<p>Expert : air-gap server</p>

<img data-src="images/clipboard-3643950338.png" class="r-stretch"><p>Expert : déverminage</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode numberSource {r}} number-lines code-with-copy"><code class="sourceCode"><span id="cb1-1"><a href=""></a>Sys.setenv(TORCH_INSTALL_DEBUG = 1)</span>
<span id="cb1-2"><a href=""></a>install_torch()</span>
<span id="cb1-3"><a href=""></a></span>
<span id="cb1-4"><a href=""></a>?install_torch()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="footer">
<p>https://torch.mlverse.org/docs/articles/installation.html</p>
</div>
</section>
<section id="la-pile-logicielle" class="slide level2">
<h2>La pile logicielle</h2>

<img data-src="images/clipboard-1623978672.png" class="r-stretch"></section>
<section id="la-manipulation-de-tenseurs" class="slide level2">
<h2>La manipulation de tenseurs</h2>
<div class="columns">
<div class="column" style="width:50%;">
<p><img data-src="images/clipboard-1496841808.png"></p>
</div><div class="column" style="width:50%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href=""></a><span class="fu">library</span>(torch)</span>
<span id="cb2-2"><a href=""></a>tt <span class="ot">&lt;-</span> <span class="fu">torch_rand</span>(<span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>)</span>
<span id="cb2-3"><a href=""></a>tt</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>torch_tensor
(1,.,.) = 
  0.9795  0.1875  0.2980  0.0509
  0.7213  0.7557  0.9511  0.2496
  0.0896  0.3535  0.7425  0.1663

(2,.,.) = 
  0.0960  0.2198  0.2652  0.1589
  0.2842  0.0544  0.6260  0.1367
  0.5224  0.0922  0.2634  0.7953
[ CPUFloatType{2,3,4} ]</code></pre>
</div>
</div>
</div></div>
</section>
<section class="slide level2">

<div class="columns">
<div class="column" style="width:50%;">
<p><img data-src="images/clipboard-4006123911.png"></p>
</div><div class="column" style="width:50%;">
<div class="small">
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href=""></a>tt[, <span class="dv">2</span><span class="sc">:</span>N, ]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>torch_tensor
(1,.,.) = 
  0.7213  0.7557  0.9511  0.2496
  0.0896  0.3535  0.7425  0.1663

(2,.,.) = 
  0.2842  0.0544  0.6260  0.1367
  0.5224  0.0922  0.2634  0.7953
[ CPUFloatType{2,2,4} ]</code></pre>
</div>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href=""></a>tt[<span class="dv">1</span>, <span class="dv">2</span><span class="sc">:</span>N, ]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>torch_tensor
 0.7213  0.7557  0.9511  0.2496
 0.0896  0.3535  0.7425  0.1663
[ CPUFloatType{2,4} ]</code></pre>
</div>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href=""></a>tt[<span class="dv">1</span><span class="sc">:</span><span class="dv">1</span>, <span class="dv">2</span><span class="sc">:</span>N, ]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>torch_tensor
(1,.,.) = 
  0.7213  0.7557  0.9511  0.2496
  0.0896  0.3535  0.7425  0.1663
[ CPUFloatType{1,2,4} ]</code></pre>
</div>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href=""></a><span class="fu">torch_squeeze</span>(tt[<span class="dv">1</span><span class="sc">:</span><span class="dv">1</span>, <span class="dv">2</span><span class="sc">:</span>N, ])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>torch_tensor
 0.7213  0.7557  0.9511  0.2496
 0.0896  0.3535  0.7425  0.1663
[ CPUFloatType{2,4} ]</code></pre>
</div>
</div>
</div>
</div></div>
</section>
<section id="à-vous-de-jouer-exercices" class="slide level2">
<h2>À vous de jouer, exercices</h2>
<p>Installations : <code>00_installation.R</code></p>
<div class="cell">
<div class="cell-output-display">
<div class="countdown" id="timer_894ba363" data-update-every="1" data-play-sound="true" tabindex="0" style="right:0;bottom:0;font-size:2em;">
<div class="countdown-controls"><button class="countdown-bump-down">−</button><button class="countdown-bump-up">+</button></div>
<code class="countdown-time"><span class="countdown-digits minutes">02</span><span class="countdown-digits colon">:</span><span class="countdown-digits seconds">00</span></code>
</div>
</div>
</div>
</section>
<section class="slide level2">

<p>Exercice : <code>01_exercice.</code></p>
<div class="cell">
<div class="cell-output-display">
<div class="countdown" id="timer_62ea9290" data-update-every="1" data-play-sound="true" tabindex="0" style="right:0;bottom:0;font-size:2em;">
<div class="countdown-controls"><button class="countdown-bump-down">−</button><button class="countdown-bump-up">+</button></div>
<code class="countdown-time"><span class="countdown-digits minutes">05</span><span class="countdown-digits colon">:</span><span class="countdown-digits seconds">00</span></code>
</div>
</div>
</div>
</section></section>
<section>
<section id="mlverse" class="title-slide slide level1 center">
<h1>mlverse</h1>

</section>
<section id="un-univers-de-dédiés-à-torch" class="slide level2">
<h2>Un univers de 📦 dédiés à {torch}</h2>
</section>
<section id="un-univers-de-en-français" class="slide level2">
<h2>Un univers de 📦 en français</h2>
<div class="small">
<table class="caption-top">
<caption>Les paquets disponibles en français</caption>
<thead>
<tr class="header">
<th>paquet</th>
<th>les messages</th>
<th>l’aide</th>
<th>les vignettes</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>{torch}</td>
<td><svg aria-hidden="true" role="img" viewbox="0 0 448 512" style="height:1em;width:0.88em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:#C7B41D;overflow:visible;position:relative;"><path d="M438.6 105.4c12.5 12.5 12.5 32.8 0 45.3l-256 256c-12.5 12.5-32.8 12.5-45.3 0l-128-128c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0L160 338.7 393.4 105.4c12.5-12.5 32.8-12.5 45.3 0z"></path></svg><sup>1</sup></td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td>{torchvision}</td>
<td><svg aria-hidden="true" role="img" viewbox="0 0 448 512" style="height:1em;width:0.88em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:#C7B41D;overflow:visible;position:relative;"><path d="M438.6 105.4c12.5 12.5 12.5 32.8 0 45.3l-256 256c-12.5 12.5-32.8 12.5-45.3 0l-128-128c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0L160 338.7 393.4 105.4c12.5-12.5 32.8-12.5 45.3 0z"></path></svg></td>
<td><svg aria-hidden="true" role="img" viewbox="0 0 448 512" style="height:1em;width:0.88em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:#C7B41D;overflow:visible;position:relative;"><path d="M438.6 105.4c12.5 12.5 12.5 32.8 0 45.3l-256 256c-12.5 12.5-32.8 12.5-45.3 0l-128-128c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0L160 338.7 393.4 105.4c12.5-12.5 32.8-12.5 45.3 0z"></path></svg> <a href="https://github.com/cregouby/torchvision.fr">cregouby/torchvision.fr</a></td>
<td></td>
</tr>
<tr class="odd">
<td>{tabnet}</td>
<td><svg aria-hidden="true" role="img" viewbox="0 0 448 512" style="height:1em;width:0.88em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:#C7B41D;overflow:visible;position:relative;"><path d="M438.6 105.4c12.5 12.5 12.5 32.8 0 45.3l-256 256c-12.5 12.5-32.8 12.5-45.3 0l-128-128c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0L160 338.7 393.4 105.4c12.5-12.5 32.8-12.5 45.3 0z"></path></svg></td>
<td><svg aria-hidden="true" role="img" viewbox="0 0 448 512" style="height:1em;width:0.88em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:#C7B41D;overflow:visible;position:relative;"><path d="M438.6 105.4c12.5 12.5 12.5 32.8 0 45.3l-256 256c-12.5 12.5-32.8 12.5-45.3 0l-128-128c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0L160 338.7 393.4 105.4c12.5-12.5 32.8-12.5 45.3 0z"></path></svg> <a href="https://github.com/cregouby/tabnet.fr">cregouby/tabnet.fr</a></td>
<td></td>
</tr>
<tr class="even">
<td>{luz}</td>
<td><svg aria-hidden="true" role="img" viewbox="0 0 448 512" style="height:1em;width:0.88em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:#C7B41D;overflow:visible;position:relative;"><path d="M438.6 105.4c12.5 12.5 12.5 32.8 0 45.3l-256 256c-12.5 12.5-32.8 12.5-45.3 0l-128-128c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0L160 338.7 393.4 105.4c12.5-12.5 32.8-12.5 45.3 0z"></path></svg></td>
<td><svg aria-hidden="true" role="img" viewbox="0 0 448 512" style="height:1em;width:0.88em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:#C7B41D;overflow:visible;position:relative;"><path d="M438.6 105.4c12.5 12.5 12.5 32.8 0 45.3l-256 256c-12.5 12.5-32.8 12.5-45.3 0l-128-128c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0L160 338.7 393.4 105.4c12.5-12.5 32.8-12.5 45.3 0z"></path></svg> <a href="https://github.com/cregouby/luz.fr">cregouby/luz.fr</a></td>
<td><svg aria-hidden="true" role="img" viewbox="0 0 448 512" style="height:1em;width:0.88em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:#C7B41D;overflow:visible;position:relative;"><path d="M438.6 105.4c12.5 12.5 12.5 32.8 0 45.3l-256 256c-12.5 12.5-32.8 12.5-45.3 0l-128-128c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0L160 338.7 393.4 105.4c12.5-12.5 32.8-12.5 45.3 0z"></path></svg> <a href="https://cregouby.github.io/luz.fr/">cregouby.github.io/luz.fr/</a></td>
</tr>
<tr class="odd">
<td>{hfhub}</td>
<td><svg aria-hidden="true" role="img" viewbox="0 0 448 512" style="height:1em;width:0.88em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:#C7B41D;overflow:visible;position:relative;"><path d="M438.6 105.4c12.5 12.5 12.5 32.8 0 45.3l-256 256c-12.5 12.5-32.8 12.5-45.3 0l-128-128c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0L160 338.7 393.4 105.4c12.5-12.5 32.8-12.5 45.3 0z"></path></svg></td>
<td><svg aria-hidden="true" role="img" viewbox="0 0 448 512" style="height:1em;width:0.88em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:#C7B41D;overflow:visible;position:relative;"><path d="M438.6 105.4c12.5 12.5 12.5 32.8 0 45.3l-256 256c-12.5 12.5-32.8 12.5-45.3 0l-128-128c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0L160 338.7 393.4 105.4c12.5-12.5 32.8-12.5 45.3 0z"></path></svg> <a href="https://github.com/cregouby/hfhub.fr">cregouby/hfhub.fr</a></td>
<td></td>
</tr>
<tr class="even">
<td>{tok}</td>
<td><svg aria-hidden="true" role="img" viewbox="0 0 448 512" style="height:1em;width:0.88em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:#C7B41D;overflow:visible;position:relative;"><path d="M438.6 105.4c12.5 12.5 12.5 32.8 0 45.3l-256 256c-12.5 12.5-32.8 12.5-45.3 0l-128-128c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0L160 338.7 393.4 105.4c12.5-12.5 32.8-12.5 45.3 0z"></path></svg></td>
<td><svg aria-hidden="true" role="img" viewbox="0 0 448 512" style="height:1em;width:0.88em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:#C7B41D;overflow:visible;position:relative;"><path d="M438.6 105.4c12.5 12.5 12.5 32.8 0 45.3l-256 256c-12.5 12.5-32.8 12.5-45.3 0l-128-128c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0L160 338.7 393.4 105.4c12.5-12.5 32.8-12.5 45.3 0z"></path></svg> <a href="https://github.com/cregouby/tok.fr">cregouby/tok.fr</a></td>
<td></td>
</tr>
<tr class="odd">
<td>{safetensors}</td>
<td><svg aria-hidden="true" role="img" viewbox="0 0 448 512" style="height:1em;width:0.88em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:#C7B41D;overflow:visible;position:relative;"><path d="M438.6 105.4c12.5 12.5 12.5 32.8 0 45.3l-256 256c-12.5 12.5-32.8 12.5-45.3 0l-128-128c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0L160 338.7 393.4 105.4c12.5-12.5 32.8-12.5 45.3 0z"></path></svg></td>
<td><svg aria-hidden="true" role="img" viewbox="0 0 448 512" style="height:1em;width:0.88em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:#C7B41D;overflow:visible;position:relative;"><path d="M438.6 105.4c12.5 12.5 12.5 32.8 0 45.3l-256 256c-12.5 12.5-32.8 12.5-45.3 0l-128-128c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0L160 338.7 393.4 105.4c12.5-12.5 32.8-12.5 45.3 0z"></path></svg> <a href="https://github.com/cregouby/safetensors.fr">cregouby/safetensors.fr</a></td>
<td></td>
</tr>
<tr class="even">
<td>{minhub}</td>
<td></td>
<td><svg aria-hidden="true" role="img" viewbox="0 0 448 512" style="height:1em;width:0.88em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:#C7B41D;overflow:visible;position:relative;"><path d="M438.6 105.4c12.5 12.5 12.5 32.8 0 45.3l-256 256c-12.5 12.5-32.8 12.5-45.3 0l-128-128c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0L160 338.7 393.4 105.4c12.5-12.5 32.8-12.5 45.3 0z"></path></svg> <a href="https://github.com/cregouby/minhub.fr">cregouby/minhub.fr</a></td>
<td></td>
</tr>
</tbody>
</table>
</div>
<aside><ol class="aside-footnotes"><li id="fn1"><p>P.R en cours</p></li></ol></aside></section>
<section class="slide level2">

<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href=""></a><span class="fu">Sys.setLanguage</span>(<span class="at">lang =</span> <span class="st">"fr"</span>)</span>
<span id="cb12-2"><a href=""></a><span class="fu">library</span>(torchvision)</span>
<span id="cb12-3"><a href=""></a><span class="fu">transform_normalize</span>(torch<span class="sc">::</span><span class="fu">torch_rand</span>(<span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">5</span>,<span class="dv">5</span>)), <span class="dv">3</span>, <span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>

<img data-src="images/clipboard-3331382707.png" class="r-stretch"></section>
<section class="slide level2">

<div class="columns">
<div class="column" style="width:40%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href=""></a><span class="fu">Sys.setenv</span>(<span class="at">LANGUAGE=</span><span class="st">"fr"</span>)</span>
<span id="cb13-2"><a href=""></a><span class="fu">library</span>(torchvision.fr)</span>
<span id="cb13-3"><a href=""></a><span class="fu">library</span>(torchvision)</span>
<span id="cb13-4"><a href=""></a>?transform_normalize</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div><div class="column" style="width:60%;">
<p><img data-src="images/clipboard-1958985727.png"></p>
</div></div>
</section></section>
<section>
<section id="tabnet" class="title-slide slide level1 center">
<h1>{tabnet}</h1>

</section>
<section id="section-4" class="slide level2">
<h2><img data-src="images/clipboard-534052795.png"></h2>
<p>v0.6.0 is on CRAN</p>
</section>
<section id="fonctionnement" class="slide level2">
<h2>Fonctionnement</h2>

<img data-src="images/clipboard-2272997678.png" class="r-stretch"></section>
<section id="usage-intégré-dans-tidymodels" class="slide level2">
<h2>Usage intégré dans tidymodels</h2>
<div class="small">
<p>Dataset</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href=""></a><span class="fu">library</span>(tidymodels, <span class="at">quietly =</span> <span class="cn">TRUE</span>)</span>
<span id="cb14-2"><a href=""></a><span class="fu">data</span>(<span class="st">"ames"</span>, <span class="at">package =</span> <span class="st">"modeldata"</span>)</span>
<span id="cb14-3"><a href=""></a><span class="fu">str</span>(ames)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>tibble [2,930 × 74] (S3: tbl_df/tbl/data.frame)
 $ MS_SubClass       : Factor w/ 16 levels "One_Story_1946_and_Newer_All_Styles",..: 1 1 1 1 6 6 12 12 12 6 ...
 $ MS_Zoning         : Factor w/ 7 levels "Floating_Village_Residential",..: 3 2 3 3 3 3 3 3 3 3 ...
 $ Lot_Frontage      : num [1:2930] 141 80 81 93 74 78 41 43 39 60 ...
 $ Lot_Area          : int [1:2930] 31770 11622 14267 11160 13830 9978 4920 5005 5389 7500 ...
 $ Street            : Factor w/ 2 levels "Grvl","Pave": 2 2 2 2 2 2 2 2 2 2 ...
 $ Alley             : Factor w/ 3 levels "Gravel","No_Alley_Access",..: 2 2 2 2 2 2 2 2 2 2 ...
 $ Lot_Shape         : Factor w/ 4 levels "Regular","Slightly_Irregular",..: 2 1 2 1 2 2 1 2 2 1 ...
 $ Land_Contour      : Factor w/ 4 levels "Bnk","HLS","Low",..: 4 4 4 4 4 4 4 2 4 4 ...
 $ Utilities         : Factor w/ 3 levels "AllPub","NoSeWa",..: 1 1 1 1 1 1 1 1 1 1 ...
 $ Lot_Config        : Factor w/ 5 levels "Corner","CulDSac",..: 1 5 1 1 5 5 5 5 5 5 ...
 $ Land_Slope        : Factor w/ 3 levels "Gtl","Mod","Sev": 1 1 1 1 1 1 1 1 1 1 ...
 $ Neighborhood      : Factor w/ 29 levels "North_Ames","College_Creek",..: 1 1 1 1 7 7 17 17 17 7 ...
 $ Condition_1       : Factor w/ 9 levels "Artery","Feedr",..: 3 2 3 3 3 3 3 3 3 3 ...
 $ Condition_2       : Factor w/ 8 levels "Artery","Feedr",..: 3 3 3 3 3 3 3 3 3 3 ...
 $ Bldg_Type         : Factor w/ 5 levels "OneFam","TwoFmCon",..: 1 1 1 1 1 1 5 5 5 1 ...
 $ House_Style       : Factor w/ 8 levels "One_and_Half_Fin",..: 3 3 3 3 8 8 3 3 3 8 ...
 $ Overall_Cond      : Factor w/ 10 levels "Very_Poor","Poor",..: 5 6 6 5 5 6 5 5 5 5 ...
 $ Year_Built        : int [1:2930] 1960 1961 1958 1968 1997 1998 2001 1992 1995 1999 ...
 $ Year_Remod_Add    : int [1:2930] 1960 1961 1958 1968 1998 1998 2001 1992 1996 1999 ...
 $ Roof_Style        : Factor w/ 6 levels "Flat","Gable",..: 4 2 4 4 2 2 2 2 2 2 ...
 $ Roof_Matl         : Factor w/ 8 levels "ClyTile","CompShg",..: 2 2 2 2 2 2 2 2 2 2 ...
 $ Exterior_1st      : Factor w/ 16 levels "AsbShng","AsphShn",..: 4 14 15 4 14 14 6 7 6 14 ...
 $ Exterior_2nd      : Factor w/ 17 levels "AsbShng","AsphShn",..: 11 15 16 4 15 15 6 7 6 15 ...
 $ Mas_Vnr_Type      : Factor w/ 5 levels "BrkCmn","BrkFace",..: 5 4 2 4 4 2 4 4 4 4 ...
 $ Mas_Vnr_Area      : num [1:2930] 112 0 108 0 0 20 0 0 0 0 ...
 $ Exter_Cond        : Factor w/ 5 levels "Excellent","Fair",..: 5 5 5 5 5 5 5 5 5 5 ...
 $ Foundation        : Factor w/ 6 levels "BrkTil","CBlock",..: 2 2 2 2 3 3 3 3 3 3 ...
 $ Bsmt_Cond         : Factor w/ 6 levels "Excellent","Fair",..: 3 6 6 6 6 6 6 6 6 6 ...
 $ Bsmt_Exposure     : Factor w/ 5 levels "Av","Gd","Mn",..: 2 4 4 4 4 4 3 4 4 4 ...
 $ BsmtFin_Type_1    : Factor w/ 7 levels "ALQ","BLQ","GLQ",..: 2 6 1 1 3 3 3 1 3 7 ...
 $ BsmtFin_SF_1      : num [1:2930] 2 6 1 1 3 3 3 1 3 7 ...
 $ BsmtFin_Type_2    : Factor w/ 7 levels "ALQ","BLQ","GLQ",..: 7 4 7 7 7 7 7 7 7 7 ...
 $ BsmtFin_SF_2      : num [1:2930] 0 144 0 0 0 0 0 0 0 0 ...
 $ Bsmt_Unf_SF       : num [1:2930] 441 270 406 1045 137 ...
 $ Total_Bsmt_SF     : num [1:2930] 1080 882 1329 2110 928 ...
 $ Heating           : Factor w/ 6 levels "Floor","GasA",..: 2 2 2 2 2 2 2 2 2 2 ...
 $ Heating_QC        : Factor w/ 5 levels "Excellent","Fair",..: 2 5 5 1 3 1 1 1 1 3 ...
 $ Central_Air       : Factor w/ 2 levels "N","Y": 2 2 2 2 2 2 2 2 2 2 ...
 $ Electrical        : Factor w/ 6 levels "FuseA","FuseF",..: 5 5 5 5 5 5 5 5 5 5 ...
 $ First_Flr_SF      : int [1:2930] 1656 896 1329 2110 928 926 1338 1280 1616 1028 ...
 $ Second_Flr_SF     : int [1:2930] 0 0 0 0 701 678 0 0 0 776 ...
 $ Gr_Liv_Area       : int [1:2930] 1656 896 1329 2110 1629 1604 1338 1280 1616 1804 ...
 $ Bsmt_Full_Bath    : num [1:2930] 1 0 0 1 0 0 1 0 1 0 ...
 $ Bsmt_Half_Bath    : num [1:2930] 0 0 0 0 0 0 0 0 0 0 ...
 $ Full_Bath         : int [1:2930] 1 1 1 2 2 2 2 2 2 2 ...
 $ Half_Bath         : int [1:2930] 0 0 1 1 1 1 0 0 0 1 ...
 $ Bedroom_AbvGr     : int [1:2930] 3 2 3 3 3 3 2 2 2 3 ...
 $ Kitchen_AbvGr     : int [1:2930] 1 1 1 1 1 1 1 1 1 1 ...
 $ TotRms_AbvGrd     : int [1:2930] 7 5 6 8 6 7 6 5 5 7 ...
 $ Functional        : Factor w/ 8 levels "Maj1","Maj2",..: 8 8 8 8 8 8 8 8 8 8 ...
 $ Fireplaces        : int [1:2930] 2 0 0 2 1 1 0 0 1 1 ...
 $ Garage_Type       : Factor w/ 7 levels "Attchd","Basment",..: 1 1 1 1 1 1 1 1 1 1 ...
 $ Garage_Finish     : Factor w/ 4 levels "Fin","No_Garage",..: 1 4 4 1 1 1 1 3 3 1 ...
 $ Garage_Cars       : num [1:2930] 2 1 1 2 2 2 2 2 2 2 ...
 $ Garage_Area       : num [1:2930] 528 730 312 522 482 470 582 506 608 442 ...
 $ Garage_Cond       : Factor w/ 6 levels "Excellent","Fair",..: 6 6 6 6 6 6 6 6 6 6 ...
 $ Paved_Drive       : Factor w/ 3 levels "Dirt_Gravel",..: 2 3 3 3 3 3 3 3 3 3 ...
 $ Wood_Deck_SF      : int [1:2930] 210 140 393 0 212 360 0 0 237 140 ...
 $ Open_Porch_SF     : int [1:2930] 62 0 36 0 34 36 0 82 152 60 ...
 $ Enclosed_Porch    : int [1:2930] 0 0 0 0 0 0 170 0 0 0 ...
 $ Three_season_porch: int [1:2930] 0 0 0 0 0 0 0 0 0 0 ...
 $ Screen_Porch      : int [1:2930] 0 120 0 0 0 0 0 144 0 0 ...
 $ Pool_Area         : int [1:2930] 0 0 0 0 0 0 0 0 0 0 ...
 $ Pool_QC           : Factor w/ 5 levels "Excellent","Fair",..: 4 4 4 4 4 4 4 4 4 4 ...
 $ Fence             : Factor w/ 5 levels "Good_Privacy",..: 5 3 5 5 3 5 5 5 5 5 ...
 $ Misc_Feature      : Factor w/ 6 levels "Elev","Gar2",..: 3 3 2 3 3 3 3 3 3 3 ...
 $ Misc_Val          : int [1:2930] 0 0 12500 0 0 0 0 0 0 0 ...
 $ Mo_Sold           : int [1:2930] 5 6 6 4 3 6 4 1 3 6 ...
 $ Year_Sold         : int [1:2930] 2010 2010 2010 2010 2010 2010 2010 2010 2010 2010 ...
 $ Sale_Type         : Factor w/ 10 levels "COD","Con","ConLD",..: 10 10 10 10 10 10 10 10 10 10 ...
 $ Sale_Condition    : Factor w/ 6 levels "Abnorml","AdjLand",..: 5 5 5 5 5 5 5 5 5 5 ...
 $ Sale_Price        : int [1:2930] 215000 105000 172000 244000 189900 195500 213500 191500 236500 189000 ...
 $ Longitude         : num [1:2930] -93.6 -93.6 -93.6 -93.6 -93.6 ...
 $ Latitude          : num [1:2930] 42.1 42.1 42.1 42.1 42.1 ...</code></pre>
</div>
</div>
<p>Recipe</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href=""></a>ames <span class="ot">&lt;-</span> ames <span class="sc">|&gt;</span> <span class="fu">mutate</span>(<span class="at">Sale_Price =</span> <span class="fu">log10</span>(Sale_Price))</span>
<span id="cb16-2"><a href=""></a>ames_rec <span class="ot">&lt;-</span> <span class="fu">recipe</span>(Sale_Price <span class="sc">~</span> ., <span class="at">data=</span>ames) <span class="sc">|&gt;</span> </span>
<span id="cb16-3"><a href=""></a>  <span class="fu">step_normalize</span>(<span class="fu">all_numeric</span>(), <span class="sc">-</span><span class="fu">all_outcomes</span>()) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div class="footer">

</div>
</section>
<section class="slide level2">

<div class="small">
<p>Pre-training</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href=""></a><span class="fu">library</span>(tabnet)</span>
<span id="cb17-2"><a href=""></a>ames_pretrain <span class="ot">&lt;-</span> <span class="fu">tabnet_pretrain</span>(</span>
<span id="cb17-3"><a href=""></a>  ames_rec, <span class="at">data=</span>ames,  <span class="at">epoch=</span><span class="dv">50</span>, <span class="at">cat_emb_dim =</span> <span class="dv">1</span>,</span>
<span id="cb17-4"><a href=""></a>  <span class="at">valid_split =</span> <span class="fl">0.2</span>, <span class="at">verbose=</span><span class="cn">TRUE</span>, </span>
<span id="cb17-5"><a href=""></a>  <span class="at">early_stopping_patience =</span> <span class="dv">3</span>L, </span>
<span id="cb17-6"><a href=""></a>  <span class="at">early_stopping_tolerance =</span> <span class="fl">1e-4</span></span>
<span id="cb17-7"><a href=""></a>)</span>
<span id="cb17-8"><a href=""></a><span class="co"># model diagnostic</span></span>
<span id="cb17-9"><a href=""></a><span class="fu">autoplot</span>(ames_pretrain)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="index_files/figure-revealjs/tabnet%20pretrain-1.png" width="960"></p>
</figure>
</div>
</div>
</div>
</div>
</section>
<section class="slide level2">

<div class="small">
<p>Training</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href=""></a>ames_fit <span class="ot">&lt;-</span> <span class="fu">tabnet_fit</span>(ames_rec, <span class="at">data=</span>ames,  <span class="at">tabnet_model =</span> ames_pretrain, </span>
<span id="cb18-2"><a href=""></a>                       <span class="at">epoch=</span><span class="dv">50</span>, <span class="at">cat_emb_dim =</span> <span class="dv">1</span>, </span>
<span id="cb18-3"><a href=""></a>                       <span class="at">valid_split =</span> <span class="fl">0.2</span>, <span class="at">verbose=</span><span class="cn">TRUE</span>, <span class="at">batch=</span><span class="dv">2930</span>, </span>
<span id="cb18-4"><a href=""></a>                       <span class="at">early_stopping_patience =</span> <span class="dv">5</span>L, </span>
<span id="cb18-5"><a href=""></a>                       <span class="at">early_stopping_tolerance =</span> <span class="fl">1e-4</span>)</span>
<span id="cb18-6"><a href=""></a><span class="co"># model diagnostic</span></span>
<span id="cb18-7"><a href=""></a><span class="fu">autoplot</span>(ames_fit)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="index_files/figure-revealjs/tabnet%20fit-1.png" width="960"></p>
</figure>
</div>
</div>
</div>
</div>
</section>
<section class="slide level2">

<div class="small">
<p>Prediction</p>
<div class="columns">
<div class="column" style="width:30%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href=""></a><span class="fu">predict</span>(ames_fit, ames)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2,930 × 1
   .pred
   &lt;dbl&gt;
 1  2.14
 2  3.97
 3  1.76
 4  2.92
 5  3.86
 6  3.05
 7  3.36
 8  2.26
 9  2.05
10  2.24
# ℹ 2,920 more rows</code></pre>
</div>
</div>
</div><div class="column" style="width:70%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href=""></a>metrics <span class="ot">&lt;-</span> <span class="fu">metric_set</span>(rmse, rsq, ccc)</span>
<span id="cb21-2"><a href=""></a><span class="fu">cbind</span>(ames, <span class="fu">predict</span>(ames_fit, ames)) <span class="sc">|&gt;</span> </span>
<span id="cb21-3"><a href=""></a>  <span class="fu">metrics</span>(Sale_Price, <span class="at">estimate =</span> .pred)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 3
  .metric .estimator .estimate
  &lt;chr&gt;   &lt;chr&gt;          &lt;dbl&gt;
1 rmse    standard      2.39  
2 rsq     standard      0.0461
3 ccc     standard     -0.0114</code></pre>
</div>
</div>
</div></div>
</div>
</section>
<section class="slide level2">

<div class="small">
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href=""></a><span class="co"># variable importance</span></span>
<span id="cb23-2"><a href=""></a>vip<span class="sc">::</span><span class="fu">vip</span>(ames_fit)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="index_files/figure-revealjs/tabnet%20vip-1.png" width="960"></p>
</figure>
</div>
</div>
</div>
</div>
</section>
<section class="slide level2">

<div class="small">
<p>Explainability</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href=""></a>ames_explain <span class="ot">&lt;-</span> tabnet<span class="sc">::</span><span class="fu">tabnet_explain</span>(ames_fit, ames)</span>
<span id="cb24-2"><a href=""></a><span class="co"># variable importance</span></span>
<span id="cb24-3"><a href=""></a><span class="fu">autoplot</span>(ames_explain, <span class="at">quantile =</span> <span class="fl">0.99</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="index_files/figure-revealjs/tabnet%20explain-1.png" width="960"></p>
</figure>
</div>
</div>
</div>
</div>
</section>
<section id="à-vous-de-jouer-exercise-02" class="slide level2">
<h2>À vous de jouer, exercise 02</h2>
<div class="question">
<p>Complete 02_exercise to practice tabnet model training.</p>
</div>
<div class="cell">
<div class="cell-output-display">
<div class="countdown" id="timer_255d0a7e" data-update-every="1" tabindex="0" style="right:0;bottom:0;">
<div class="countdown-controls"><button class="countdown-bump-down">−</button><button class="countdown-bump-up">+</button></div>
<code class="countdown-time"><span class="countdown-digits minutes">07</span><span class="countdown-digits colon">:</span><span class="countdown-digits seconds">00</span></code>
</div>
</div>
</div>
<div class="footer">

</div>
</section></section>
<section>
<section id="tabnet-pour-les-valeurs-manquantes" class="title-slide slide level1 center">
<h1>{tabnet} pour les valeurs manquantes</h1>

</section>
<section id="retour-sur-le-jeu-de-données-ames" class="slide level2">
<h2>retour sur le jeu de données Ames</h2>
<div class="small">
<ul>
<li><p>les tenseurs ne peuvent pas inclure de valeur manquantes.</p></li>
<li><p><code>ames</code> nous fait le plaisir d’être sans valeur manquante.</p></li>
</ul>
<div class="question">
<p>Quelle est la surface de la piscine quand il n’y a pas de piscine?</p>
</div>
</div>
</section>
<section class="slide level2">

<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href=""></a><span class="fu">data</span>(<span class="st">"ames"</span>, <span class="at">package =</span> <span class="st">"modeldata"</span>)</span>
<span id="cb25-2"><a href=""></a><span class="fu">qplot</span>(ames<span class="sc">$</span>Mas_Vnr_Area)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

</div>
<img data-src="index_files/figure-revealjs/unnamed-chunk-17-1.png" width="960" class="r-stretch"><div class="question">
<p>Comment le modèle peut-il capturer cette distribution ?</p>
</div>
</section>
<section class="slide level2">

<p>Et si on l’applique à toute les colonnes ?</p>
<div class="small">
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href=""></a>col_with_zero_as_na <span class="ot">&lt;-</span> ames <span class="sc">|&gt;</span>  </span>
<span id="cb26-2"><a href=""></a>  <span class="fu">select</span>(<span class="fu">where</span>(is.numeric)) <span class="sc">|&gt;</span>  </span>
<span id="cb26-3"><a href=""></a>  <span class="fu">select</span>(<span class="fu">matches</span>(<span class="st">"_SF|Area|Misc_Val|[Pp]orch$"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb26-4"><a href=""></a>  <span class="fu">summarise_each</span>(min) <span class="sc">|&gt;</span> </span>
<span id="cb26-5"><a href=""></a>  <span class="fu">select_if</span>(<span class="sc">~</span>.x<span class="sc">==</span><span class="dv">0</span>) <span class="sc">|&gt;</span> </span>
<span id="cb26-6"><a href=""></a>  <span class="fu">names</span>()</span>
<span id="cb26-7"><a href=""></a>ames_missing <span class="ot">&lt;-</span> ames <span class="sc">|&gt;</span><span class="fu">mutate_at</span>(col_with_zero_as_na, na_if, <span class="dv">0</span>) <span class="sc">|&gt;</span> </span>
<span id="cb26-8"><a href=""></a>  <span class="fu">mutate_at</span>(<span class="st">"Alley"</span>, na_if, <span class="st">"No_Alley_Access"</span>)  <span class="sc">|&gt;</span>  </span>
<span id="cb26-9"><a href=""></a>  <span class="fu">mutate_at</span>(<span class="st">"Fence"</span>, na_if, <span class="st">"No_Fence"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb26-10"><a href=""></a>  <span class="fu">mutate_at</span>(<span class="fu">c</span>(<span class="st">"Garage_Cond"</span>, <span class="st">"Garage_Finish"</span>), na_if, <span class="st">"No_Garage"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb26-11"><a href=""></a>  <span class="fu">mutate_at</span>(<span class="fu">c</span>(<span class="st">"Bsmt_Exposure"</span>, <span class="st">"BsmtFin_Type_1"</span>, <span class="st">"BsmtFin_Type_2"</span>), na_if, <span class="st">"No_Basement"</span>)</span>
<span id="cb26-12"><a href=""></a></span>
<span id="cb26-13"><a href=""></a>visdat<span class="sc">::</span><span class="fu">vis_miss</span>(ames_missing)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="index_files/figure-revealjs/tabnet%20missing%20dataset-1.png" width="960"></p>
</figure>
</div>
</div>
</div>
</div>
</section>
<section class="slide level2">

<div class="small">
<p>Recipe</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href=""></a>ames_missing <span class="ot">&lt;-</span> ames_missing <span class="sc">|&gt;</span> <span class="fu">mutate</span>(<span class="at">Sale_Price =</span> <span class="fu">log10</span>(Sale_Price))</span>
<span id="cb27-2"><a href=""></a>ames_missing_rec <span class="ot">&lt;-</span> <span class="fu">recipe</span>(Sale_Price <span class="sc">~</span> ., <span class="at">data=</span>ames_missing) <span class="sc">|&gt;</span> </span>
<span id="cb27-3"><a href=""></a>  <span class="fu">step_normalize</span>(<span class="fu">all_numeric</span>(), <span class="sc">-</span><span class="fu">all_outcomes</span>()) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Pre-training</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href=""></a><span class="fu">library</span>(tabnet)</span>
<span id="cb28-2"><a href=""></a>ames_missing_pretrain <span class="ot">&lt;-</span> <span class="fu">tabnet_pretrain</span>(</span>
<span id="cb28-3"><a href=""></a>  ames_missing_rec, <span class="at">data=</span>ames_missing,  <span class="at">epoch=</span><span class="dv">50</span>, <span class="at">cat_emb_dim =</span> <span class="dv">1</span>,  <span class="at">valid_split =</span> <span class="fl">0.2</span>,</span>
<span id="cb28-4"><a href=""></a>  <span class="at">verbose=</span><span class="cn">TRUE</span>,   <span class="at">early_stopping_patience =</span> <span class="dv">3</span>L,   <span class="at">early_stopping_tolerance =</span> <span class="fl">1e-4</span></span>
<span id="cb28-5"><a href=""></a>)</span>
<span id="cb28-6"><a href=""></a><span class="co"># model diagnostic</span></span>
<span id="cb28-7"><a href=""></a><span class="fu">autoplot</span>(ames_missing_pretrain)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="index_files/figure-revealjs/tabnet%20missing%20pretrain-1.png" width="960"></p>
</figure>
</div>
</div>
</div>
</div>
</section>
<section class="slide level2">

<div class="small">
<p>Training</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href=""></a>ames_missing_fit <span class="ot">&lt;-</span> <span class="fu">tabnet_fit</span>(</span>
<span id="cb29-2"><a href=""></a>  ames_missing_rec,   <span class="at">data =</span> ames_missing,</span>
<span id="cb29-3"><a href=""></a>  <span class="at">tabnet_model =</span> ames_missing_pretrain,</span>
<span id="cb29-4"><a href=""></a>  <span class="at">epoch =</span> <span class="dv">50</span>,  <span class="at">cat_emb_dim =</span> <span class="dv">1</span>,  <span class="at">valid_split =</span> <span class="fl">0.2</span>,</span>
<span id="cb29-5"><a href=""></a>  <span class="at">verbose =</span> <span class="cn">TRUE</span>,  <span class="at">batch =</span> <span class="dv">2930</span>,</span>
<span id="cb29-6"><a href=""></a>  <span class="at">early_stopping_patience =</span> <span class="dv">5</span>L,</span>
<span id="cb29-7"><a href=""></a>  <span class="at">early_stopping_tolerance =</span> <span class="fl">1e-4</span></span>
<span id="cb29-8"><a href=""></a>)</span>
<span id="cb29-9"><a href=""></a><span class="co"># model diagnostic</span></span>
<span id="cb29-10"><a href=""></a><span class="fu">autoplot</span>(ames_missing_fit)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="index_files/figure-revealjs/tabnet%20missing%20fit-1.png" width="960"></p>
</figure>
</div>
</div>
</div>
</div>
</section>
<section class="slide level2">

<div class="small">
<p>Prediction</p>
<div class="columns">
<div class="column" style="width:30%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href=""></a><span class="fu">predict</span>(ames_missing_fit, ames_missing)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2,930 × 1
   .pred
   &lt;dbl&gt;
 1  3.41
 2  5.07
 3  2.64
 4  3.29
 5  3.32
 6  3.09
 7  4.50
 8  2.02
 9  2.58
10  2.56
# ℹ 2,920 more rows</code></pre>
</div>
</div>
</div><div class="column" style="width:70%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href=""></a>metrics <span class="ot">&lt;-</span> <span class="fu">metric_set</span>(rmse, rsq, ccc)</span>
<span id="cb32-2"><a href=""></a><span class="fu">cbind</span>(ames_missing, <span class="fu">predict</span>(ames_missing_fit, ames_missing)) <span class="sc">|&gt;</span> </span>
<span id="cb32-3"><a href=""></a>  <span class="fu">metrics</span>(Sale_Price, <span class="at">estimate =</span> .pred)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 3
  .metric .estimator .estimate
  &lt;chr&gt;   &lt;chr&gt;          &lt;dbl&gt;
1 rmse    standard      2.00  
2 rsq     standard      0.0286
3 ccc     standard     -0.0150</code></pre>
</div>
</div>
</div></div>
</div>
</section>
<section class="slide level2">

<div class="small">
<p>Variable importance</p>
<div class="columns">
<div class="column" style="width:50%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href=""></a><span class="co"># original ames</span></span>
<span id="cb34-2"><a href=""></a><span class="fu">vip_color</span>(ames_pretrain, col_with_missings)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="index_files/figure-revealjs/tabnet%20pretrain%20vip%20color-1.png" width="960"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href=""></a><span class="fu">vip_color</span>(ames_fit, col_with_missings)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="index_files/figure-revealjs/tabnet%20pretrain%20vip%20color-2.png" width="960"></p>
</figure>
</div>
</div>
</div>
</div><div class="column" style="width:50%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href=""></a><span class="co"># ames with missing values</span></span>
<span id="cb36-2"><a href=""></a><span class="fu">vip_color</span>(ames_missing_pretrain, col_with_missings)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="index_files/figure-revealjs/tabnet%20pretrain%20missing%20vip%20color-1.png" width="960"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href=""></a><span class="fu">vip_color</span>(ames_missing_fit, col_with_missings)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="index_files/figure-revealjs/tabnet%20pretrain%20missing%20vip%20color-2.png" width="960"></p>
</figure>
</div>
</div>
</div>
</div></div>
</div>
</section>
<section class="slide level2">

<div class="small">
<p>Explainability</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href=""></a>ames_missing_explain <span class="ot">&lt;-</span> tabnet<span class="sc">::</span><span class="fu">tabnet_explain</span>(ames_missing_fit, ames_missing)</span>
<span id="cb38-2"><a href=""></a><span class="co"># variable importance</span></span>
<span id="cb38-3"><a href=""></a><span class="fu">autoplot</span>(ames_missing_explain, <span class="at">quantile =</span> <span class="fl">0.99</span>, <span class="at">type=</span><span class="st">"step"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="index_files/figure-revealjs/tabnet%20missing%20explain-1.png" width="960"></p>
</figure>
</div>
</div>
</div>
</div>
</section></section>
<section>
<section id="tabnet-avec-un-outcome-hierarchique" class="title-slide slide level1 center">
<h1>{tabnet} avec un <code>outcome()</code> hierarchique</h1>

</section>
<section class="slide level2">

<ul>
<li><p>{tabnet} admet des variable à prédire catégorielle, multi-label multi-class.</p></li>
<li><p>et si on pouvait mettre une contrainte entre les classes des différents labels ?</p></li>
<li><p>le dataset doit être de type <code>data.tree::as.Node()</code></p>
<ul>
<li>conversion de trainset et testset avec <code>as.Node()</code> avant les fonctions <code>tabnet_</code></li>
<li>conversion de inverse avec <code>node_to_df()</code></li>
</ul></li>
<li><p>nouveauté de la 0.5.0</p></li>
</ul>
</section>
<section id="exemple-avec-starwars" class="slide level2">
<h2>Exemple avec <code>starwars</code></h2>
<div class="small">
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href=""></a><span class="fu">library</span>(data.tree)</span>
<span id="cb39-2"><a href=""></a><span class="fu">data</span>(starwars, <span class="at">package =</span> <span class="st">"dplyr"</span>)</span>
<span id="cb39-3"><a href=""></a><span class="fu">head</span>(starwars, <span class="dv">4</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 14
  name      height  mass hair_color skin_color eye_color birth_year sex   gender
  &lt;chr&gt;      &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt;      &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt; 
1 Luke Sky…    172    77 blond      fair       blue            19   male  mascu…
2 C-3PO        167    75 &lt;NA&gt;       gold       yellow         112   none  mascu…
3 R2-D2         96    32 &lt;NA&gt;       white, bl… red             33   none  mascu…
4 Darth Va…    202   136 none       white      yellow          41.9 male  mascu…
# ℹ 5 more variables: homeworld &lt;chr&gt;, species &lt;chr&gt;, films &lt;list&gt;,
#   vehicles &lt;list&gt;, starships &lt;list&gt;</code></pre>
</div>
</div>
</div>
</section>
<section class="slide level2">

<div class="small">
<p>On construit la variable de sortie comme un chaîne avec des séparateurs <code>/</code> dans une variable <code>"pathString"</code> (erronné)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href=""></a>starwars_tree <span class="ot">&lt;-</span> starwars <span class="sc">|&gt;</span> </span>
<span id="cb41-2"><a href=""></a>  <span class="fu">mutate</span>(<span class="at">pathString =</span> <span class="fu">paste</span>(<span class="st">"StarWars_characters"</span>, species, sex, <span class="st">`</span><span class="at">name</span><span class="st">`</span>, <span class="at">sep =</span> <span class="st">"/"</span>))  <span class="sc">|&gt;</span> </span>
<span id="cb41-3"><a href=""></a>  <span class="fu">as.Node</span>()</span>
<span id="cb41-4"><a href=""></a><span class="fu">print</span>(starwars_tree, <span class="st">"name"</span>,<span class="st">"height"</span>, <span class="st">"mass"</span>, <span class="st">"eye_color"</span>, <span class="at">limit =</span> <span class="dv">8</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                           levelName                    name height mass
1  StarWars_characters                   StarWars_characters      4   NA
2   ¦--Human                                           Human      3   NA
3   ¦   ¦--male                                         male      2   NA
4   ¦   ¦   ¦--Luke Skywalker                 Luke Skywalker      1   77
5   ¦   ¦   ¦--Darth Vader                       Darth Vader      1  136
6   ¦   ¦   ¦--Owen Lars                           Owen Lars      1  120
7   ¦   ¦   ¦--Biggs Darklighter           Biggs Darklighter      1   84
8   ¦   ¦   °--... 22 nodes w/ 0 sub   ... 22 nodes w/ 0 sub      1   NA
9   ¦   °--... 1 nodes w/ 31 sub       ... 1 nodes w/ 31 sub      1   NA
10  °--... 37 nodes w/ 123 sub       ... 37 nodes w/ 123 sub      1   NA
   eye_color
1           
2           
3           
4       blue
5     yellow
6       blue
7      brown
8           
9           
10          </code></pre>
</div>
</div>
</div>
</section>
<section id="mais-avec-des-rêgles-sur-les-noms-et-les-types" class="slide level2">
<h2>Mais avec des rêgles sur les noms et les types</h2>
<div class="small">
<ul>
<li>pas d’usage des noms internes de {data.tree} :
<ul>
<li><code>name</code>, <code>height</code> sont interdits</li>
<li>comme tous les noms de <code>NODE_RESERVED_NAMES_CONST</code>. (Ils seraient supprimés au moment de la conversion.)</li>
</ul></li>
<li>pas de <code>factor()</code></li>
<li>pas de colonne nomée <code>level_*</code></li>
<li>le dernier niveau hiérarchique doit être l’individu (donc un Id unique)</li>
<li>il doit y avoir une racine à la hiérarchie</li>
</ul>
</div>
</section>
<section id="construction-correcte-de-la-variable-de-sortie-pathstring" class="slide level2">
<h2>Construction correcte de la variable de sortie <code>"pathString"</code></h2>
<div class="small">
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href=""></a>starwars_tree <span class="ot">&lt;-</span> starwars <span class="sc">|&gt;</span></span>
<span id="cb43-2"><a href=""></a>  <span class="fu">rename</span>(<span class="st">`</span><span class="at">_name</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"name"</span>, <span class="st">`</span><span class="at">_height</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"height"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb43-3"><a href=""></a>  <span class="fu">mutate</span>(<span class="at">pathString =</span> <span class="fu">paste</span>(<span class="st">"StarWars_characters"</span>, species, sex, <span class="st">`</span><span class="at">_name</span><span class="st">`</span>, <span class="at">sep =</span> <span class="st">"/"</span>))  <span class="sc">|&gt;</span> </span>
<span id="cb43-4"><a href=""></a>  <span class="fu">as.Node</span>()</span>
<span id="cb43-5"><a href=""></a><span class="fu">print</span>(starwars_tree, <span class="st">"name"</span>, <span class="st">"_name"</span>,<span class="st">"_height"</span>, <span class="st">"mass"</span>, <span class="st">"eye_color"</span>, <span class="at">limit =</span> <span class="dv">8</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                           levelName                    name             _name
1  StarWars_characters                   StarWars_characters                  
2   ¦--Human                                           Human                  
3   ¦   ¦--male                                         male                  
4   ¦   ¦   ¦--Luke Skywalker                 Luke Skywalker    Luke Skywalker
5   ¦   ¦   ¦--Darth Vader                       Darth Vader       Darth Vader
6   ¦   ¦   ¦--Owen Lars                           Owen Lars         Owen Lars
7   ¦   ¦   ¦--Biggs Darklighter           Biggs Darklighter Biggs Darklighter
8   ¦   ¦   °--... 22 nodes w/ 0 sub   ... 22 nodes w/ 0 sub                  
9   ¦   °--... 1 nodes w/ 31 sub       ... 1 nodes w/ 31 sub                  
10  °--... 37 nodes w/ 123 sub       ... 37 nodes w/ 123 sub                  
   _height mass eye_color
1       NA   NA          
2       NA   NA          
3       NA   NA          
4      172   77      blue
5      202  136    yellow
6      178  120      blue
7      183   84     brown
8       NA   NA          
9       NA   NA          
10      NA   NA          </code></pre>
</div>
</div>
</div>
</section>
<section id="initial-split-et-construction" class="slide level2">
<h2>Initial split et construction</h2>
<p><code>starwars</code> a des colonnes de <code>list()</code> qu’il faut dérouler</p>
<div class="small">
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href=""></a>starw_split <span class="ot">&lt;-</span> starwars <span class="sc">|&gt;</span> </span>
<span id="cb45-2"><a href=""></a>  tidyr<span class="sc">::</span><span class="fu">unnest_longer</span>(films) <span class="sc">|&gt;</span> </span>
<span id="cb45-3"><a href=""></a>  tidyr<span class="sc">::</span><span class="fu">unnest_longer</span>(vehicles, <span class="at">keep_empty =</span> <span class="cn">TRUE</span>) <span class="sc">|&gt;</span> </span>
<span id="cb45-4"><a href=""></a>  tidyr<span class="sc">::</span><span class="fu">unnest_longer</span>(starships, <span class="at">keep_empty =</span> <span class="cn">TRUE</span>) <span class="sc">|&gt;</span> </span>
<span id="cb45-5"><a href=""></a>  <span class="fu">initial_split</span>( <span class="at">prop =</span> .<span class="dv">8</span>, <span class="at">strata =</span> <span class="st">"species"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</section>
<section class="slide level2">

<div class="small">
<div class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href=""></a>starwars_train_tree <span class="ot">&lt;-</span> starw_split <span class="sc">|&gt;</span> </span>
<span id="cb46-2"><a href=""></a>  <span class="fu">training</span>() <span class="sc">|&gt;</span></span>
<span id="cb46-3"><a href=""></a>  <span class="fu">rename</span>(<span class="st">`</span><span class="at">_name</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"name"</span>, <span class="st">`</span><span class="at">_height</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"height"</span>) <span class="sc">|&gt;</span></span>
<span id="cb46-4"><a href=""></a>  <span class="fu">rowid_to_column</span>() <span class="sc">|&gt;</span></span>
<span id="cb46-5"><a href=""></a>  <span class="fu">mutate</span>(<span class="at">pathString =</span> <span class="fu">paste</span>(<span class="st">"StarWars_characters"</span>, species, sex, rowid, <span class="at">sep =</span> <span class="st">"/"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb46-6"><a href=""></a>  <span class="co"># remove outcomes labels from predictors</span></span>
<span id="cb46-7"><a href=""></a>  <span class="fu">select</span>(<span class="sc">-</span>species, <span class="sc">-</span>sex, <span class="sc">-</span><span class="st">`</span><span class="at">_name</span><span class="st">`</span>, <span class="sc">-</span>rowid) <span class="sc">|&gt;</span></span>
<span id="cb46-8"><a href=""></a>  <span class="co"># turn it as hierarchical Node</span></span>
<span id="cb46-9"><a href=""></a>  <span class="fu">as.Node</span>()</span>
<span id="cb46-10"><a href=""></a></span>
<span id="cb46-11"><a href=""></a>starwars_test_tree <span class="ot">&lt;-</span> starw_split <span class="sc">|&gt;</span></span>
<span id="cb46-12"><a href=""></a>  <span class="fu">testing</span>() <span class="sc">|&gt;</span></span>
<span id="cb46-13"><a href=""></a>  <span class="fu">rename</span>(<span class="st">`</span><span class="at">_name</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"name"</span>, <span class="st">`</span><span class="at">_height</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"height"</span>) <span class="sc">|&gt;</span></span>
<span id="cb46-14"><a href=""></a>  <span class="fu">rowid_to_column</span>() <span class="sc">|&gt;</span></span>
<span id="cb46-15"><a href=""></a>  <span class="fu">mutate</span>(<span class="at">pathString =</span> <span class="fu">paste</span>(<span class="st">"StarWars_characters"</span>, species, sex, rowid, <span class="at">sep =</span> <span class="st">"/"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb46-16"><a href=""></a>  <span class="fu">select</span>(<span class="sc">-</span>species, <span class="sc">-</span>sex, <span class="sc">-</span><span class="st">`</span><span class="at">_name</span><span class="st">`</span>, <span class="sc">-</span>rowid) <span class="sc">|&gt;</span></span>
<span id="cb46-17"><a href=""></a>  <span class="fu">as.Node</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Les <code>$attributesAll</code> du Node seront les predicteurs :</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href=""></a>starwars_train_tree<span class="sc">$</span>attributesAll</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "_height"    "birth_year" "eye_color"  "films"      "gender"    
 [6] "hair_color" "homeworld"  "mass"       "skin_color" "starships" 
[11] "vehicles"  </code></pre>
</div>
</div>
</div>
</section>
<section id="entraînement-du-modèle" class="slide level2">
<h2>Entraînement du modèle</h2>
<div class="sourceCode" id="cb49"><pre class="sourceCode numberSource markdown number-lines code-with-copy"><code class="sourceCode markdown"><span id="cb49-1"><a href=""></a><span class="in">```{r}</span></span>
<span id="cb49-2"><a href=""></a><span class="in">#| echo: true</span></span>
<span id="cb49-3"><a href=""></a><span class="in">#| label: "starwars fit"</span></span>
<span id="cb49-4"><a href=""></a></span>
<span id="cb49-5"><a href=""></a><span class="in">config &lt;- tabnet_config(</span></span>
<span id="cb49-6"><a href=""></a><span class="in">  decision_width = 8,</span></span>
<span id="cb49-7"><a href=""></a><span class="in">  attention_width = 8,</span></span>
<span id="cb49-8"><a href=""></a><span class="in">  num_steps = 3,</span></span>
<span id="cb49-9"><a href=""></a><span class="in">  penalty = .003,</span></span>
<span id="cb49-10"><a href=""></a><span class="in">  cat_emb_dim = 2,</span></span>
<span id="cb49-11"><a href=""></a><span class="in">  valid_split = 0.2,</span></span>
<span id="cb49-12"><a href=""></a><span class="in">  learn_rate = 1e-3,</span></span>
<span id="cb49-13"><a href=""></a><span class="in">  lr_scheduler = "reduce_on_plateau",</span></span>
<span id="cb49-14"><a href=""></a><span class="in">  early_stopping_monitor = "valid_loss",</span></span>
<span id="cb49-15"><a href=""></a><span class="in">  early_stopping_patience = 4,</span></span>
<span id="cb49-16"><a href=""></a><span class="in">  verbose = FALSE</span></span>
<span id="cb49-17"><a href=""></a><span class="in">)</span></span>
<span id="cb49-18"><a href=""></a></span>
<span id="cb49-19"><a href=""></a><span class="in">starw_model &lt;- tabnet_fit(starwars_train_tree, config = config, epoch = 75, checkpoint_epochs = 15)</span></span>
<span id="cb49-20"><a href=""></a><span class="in">```</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="diagnostique" class="slide level2">
<h2>Diagnostique</h2>
<div class="sourceCode" id="cb50"><pre class="sourceCode numberSource markdown number-lines code-with-copy"><code class="sourceCode markdown"><span id="cb50-1"><a href=""></a><span class="in">```{r}</span></span>
<span id="cb50-2"><a href=""></a><span class="in">#| echo: true</span></span>
<span id="cb50-3"><a href=""></a><span class="in">#| label: "starwars diag"</span></span>
<span id="cb50-4"><a href=""></a></span>
<span id="cb50-5"><a href=""></a><span class="in">autoplot(starw_model)</span></span>
<span id="cb50-6"><a href=""></a><span class="in">```</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb51"><pre class="sourceCode numberSource markdown number-lines code-with-copy"><code class="sourceCode markdown"><span id="cb51-1"><a href=""></a><span class="in">```{r}</span></span>
<span id="cb51-2"><a href=""></a><span class="in">#| echo: true</span></span>
<span id="cb51-3"><a href=""></a><span class="in">#| label: "starwars vip"</span></span>
<span id="cb51-4"><a href=""></a></span>
<span id="cb51-5"><a href=""></a><span class="in">vip::vip(starw_model)</span></span>
<span id="cb51-6"><a href=""></a><span class="in">```</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="inférence-sur-le-modèle-hierarchique" class="slide level2">
<h2>Inférence sur le modèle hierarchique</h2>
<div class="sourceCode" id="cb52"><pre class="sourceCode numberSource markdown number-lines code-with-copy"><code class="sourceCode markdown"><span id="cb52-1"><a href=""></a><span class="in">```{r}</span></span>
<span id="cb52-2"><a href=""></a><span class="in">#| echo: true</span></span>
<span id="cb52-3"><a href=""></a><span class="in">#| label: "starwars inference"</span></span>
<span id="cb52-4"><a href=""></a><span class="in">starwars_hat &lt;- bind_cols(</span></span>
<span id="cb52-5"><a href=""></a><span class="in">    predict(starw_model, starwars_test_tree),</span></span>
<span id="cb52-6"><a href=""></a><span class="in">    node_to_df(starwars_test_tree)$y</span></span>
<span id="cb52-7"><a href=""></a><span class="in">  )</span></span>
<span id="cb52-8"><a href=""></a><span class="in">tail(starwars_hat, n = 5)</span></span>
<span id="cb52-9"><a href=""></a><span class="in">```</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section></section>
<section>
<section id="gpt2-avec-r" class="title-slide slide level1 center">
<h1>GPT2 avec R</h1>
<p>basé sur 4 packages {minhub}, {hfhub}, {tok}, {safetensors}</p>
<ul>
<li>{minhub} : un dépot de <strong>réseau de neurones</strong> classiques pour {torch}</li>
<li>{hfhub} : l’accès aux téléchargement de <strong>modèles</strong> préentraînés du hub hugging-face</li>
<li>{tok} : un wrappeur des tokenizers d’hugging-face en R</li>
<li>{safetensors} : sauvegarde et lecture des données de tenseurs au format <code>.safetensors</code></li>
</ul>
</section>
<section id="téléchargement-du-modèle-et-de-ses-poids" class="slide level2">
<h2>Téléchargement du modèle et de ses poids</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href=""></a><span class="fu">library</span>(minhub)</span>
<span id="cb53-2"><a href=""></a><span class="fu">library</span>(zeallot)</span>
<span id="cb53-3"><a href=""></a></span>
<span id="cb53-4"><a href=""></a>identifier <span class="ot">&lt;-</span> <span class="st">"gpt2"</span></span>
<span id="cb53-5"><a href=""></a>revision <span class="ot">&lt;-</span> <span class="st">"e7da7f2"</span></span>
<span id="cb53-6"><a href=""></a><span class="co"># instantiate model and load Hugging Face weights</span></span>
<span id="cb53-7"><a href=""></a>model <span class="ot">&lt;-</span> <span class="fu">gpt2_from_pretrained</span>(identifier, revision)</span>
<span id="cb53-8"><a href=""></a><span class="co"># load matching tokenizer</span></span>
<span id="cb53-9"><a href=""></a>tok <span class="ot">&lt;-</span> tok<span class="sc">::</span>tokenizer<span class="sc">$</span><span class="fu">from_pretrained</span>(identifier,)</span>
<span id="cb53-10"><a href=""></a>model<span class="sc">$</span><span class="fu">eval</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="tokenisation-de-la-phrase" class="slide level2">
<h2>Tokenisation de la phrase</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href=""></a>text <span class="ot">=</span> <span class="fu">paste</span>(<span class="st">"✨ Quel plaisir de participer aux ateliers HappyR !✨"</span>,</span>
<span id="cb54-2"><a href=""></a>             <span class="st">"Vivement le prochain évènement "</span> )</span>
<span id="cb54-3"><a href=""></a></span>
<span id="cb54-4"><a href=""></a>idx <span class="ot">&lt;-</span> <span class="fu">torch_tensor</span>(tok<span class="sc">$</span><span class="fu">encode</span>(text)<span class="sc">$</span>ids)<span class="sc">$</span><span class="fu">view</span>(<span class="fu">c</span>(<span class="dv">1</span>, <span class="sc">-</span><span class="dv">1</span>))</span>
<span id="cb54-5"><a href=""></a>idx</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>torch_tensor
Columns 1 to 11 26486    101   2264    417    458  15152    343    390   1344   9346  27506

Columns 12 to 22   379    417   3183  14628     49   5145  26486    101  29237    434    443

Columns 23 to 30   386   7983  38251     85  14064     77    972    220
[ CPULongType{1,30} ]</code></pre>
</div>
</div>
</section>
<section id="génération-dune-entrée" class="slide level2">
<h2>Génération d’une entrée</h2>
<p>La génération est un process itératif, chaque prédiction du modèle est ajoutée au prompt qui grossit.</p>
<p>Ajoutons y 30 tokens :</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href=""></a>prompt_length <span class="ot">&lt;-</span> idx<span class="sc">$</span><span class="fu">size</span>(<span class="sc">-</span><span class="dv">1</span>)</span>
<span id="cb56-2"><a href=""></a></span>
<span id="cb56-3"><a href=""></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">30</span>) { <span class="co"># decide on maximal length of output sequence</span></span>
<span id="cb56-4"><a href=""></a>  <span class="co"># obtain next prediction (raw score)</span></span>
<span id="cb56-5"><a href=""></a>  <span class="fu">with_no_grad</span>({</span>
<span id="cb56-6"><a href=""></a>    logits <span class="ot">&lt;-</span> <span class="fu">model</span>(idx <span class="sc">+</span> <span class="dv">1</span>L)</span>
<span id="cb56-7"><a href=""></a>  })</span>
<span id="cb56-8"><a href=""></a>  last_logits <span class="ot">&lt;-</span> logits[, <span class="sc">-</span><span class="dv">1</span>, ]</span>
<span id="cb56-9"><a href=""></a>  <span class="co"># pick highest scores (how many is up to you)</span></span>
<span id="cb56-10"><a href=""></a>  <span class="fu">c</span>(prob, ind) <span class="sc">%&lt;-%</span> last_logits<span class="sc">$</span><span class="fu">topk</span>(<span class="dv">50</span>)</span>
<span id="cb56-11"><a href=""></a>  last_logits <span class="ot">&lt;-</span> <span class="fu">torch_full_like</span>(last_logits, <span class="sc">-</span><span class="cn">Inf</span>)<span class="sc">$</span><span class="fu">scatter_</span>(<span class="sc">-</span><span class="dv">1</span>, ind, prob)</span>
<span id="cb56-12"><a href=""></a>  <span class="co"># convert to probabilities</span></span>
<span id="cb56-13"><a href=""></a>  probs <span class="ot">&lt;-</span> <span class="fu">nnf_softmax</span>(last_logits, <span class="at">dim =</span> <span class="sc">-</span><span class="dv">1</span>)</span>
<span id="cb56-14"><a href=""></a>  <span class="co"># probabilistic sampling</span></span>
<span id="cb56-15"><a href=""></a>  id_next <span class="ot">&lt;-</span> <span class="fu">torch_multinomial</span>(probs, <span class="at">num_samples =</span> <span class="dv">1</span>) <span class="sc">-</span> <span class="dv">1</span>L</span>
<span id="cb56-16"><a href=""></a>  <span class="co"># stop if end of sequence predicted</span></span>
<span id="cb56-17"><a href=""></a>  <span class="cf">if</span> (id_next<span class="sc">$</span><span class="fu">item</span>() <span class="sc">==</span> <span class="dv">0</span>) {</span>
<span id="cb56-18"><a href=""></a>    <span class="cf">break</span></span>
<span id="cb56-19"><a href=""></a>  }</span>
<span id="cb56-20"><a href=""></a>  <span class="co"># append prediction to prompt</span></span>
<span id="cb56-21"><a href=""></a>  idx <span class="ot">&lt;-</span> <span class="fu">torch_cat</span>(<span class="fu">list</span>(idx, id_next), <span class="at">dim =</span> <span class="dv">2</span>)</span>
<span id="cb56-22"><a href=""></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="décodage-des-tokens-du-résultat" class="slide level2">
<h2>décodage des tokens du résultat</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href=""></a>tok<span class="sc">$</span><span class="fu">decode</span>(<span class="fu">as.integer</span>(idx))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "✨ Quel plaisir de participer aux ateliers HappyR !✨ Vivement le prochain évènement étour sur le l'affaire !✬\n\nLa vère monde est révolution de plus en fait.\n\n"</code></pre>
</div>
</div>
</section></section>
<section>
<section id="fine-tuning-avec-lora" class="title-slide slide level1 center">
<h1>Fine-Tuning avec LoRA</h1>

</section>
<section id="est-ce-que-les-llms-dépossèdent-le-data-scientist" class="slide level2">
<h2>Est-ce que les LLMs dépossèdent le data-scientist ?</h2>
<ul>
<li><p>des réseaux toujours plus gros impliquent des entraînements prohibitifs</p></li>
<li><p>la promesse de la prochaîne version qui résoud les faiblesses</p></li>
<li><p>le jeu de donnée de réference difficile à constituer</p></li>
</ul>
</section>
<section id="lora-à-la-rescousse" class="slide level2">
<h2>LoRA à la rescousse</h2>
<p>Low Rank Adaptation</p>

<img data-src="images/lora.png" class="r-stretch"></section>
<section id="method" class="slide level2">
<h2>Method</h2>
<div class="small">
<p>The problem of fine-tuning a neural network can be expressed by finding a <span class="math inline">\(\Delta \Theta\)</span> that minimizes <span class="math inline">\(L(X, y; \Theta_0 + \Delta\Theta)\)</span> where <span class="math inline">\(L\)</span> is a loss function, <span class="math inline">\(X\)</span> and <span class="math inline">\(y\)</span> are the data and <span class="math inline">\(\Theta_0\)</span> the weights from a pre-trained model.</p>
<p>We learn the parameters <span class="math inline">\(\Delta \Theta\)</span> with dimension <span class="math inline">\(|\Delta \Theta|\)</span> equals to <span class="math inline">\(|\Theta_0|\)</span>. When <span class="math inline">\(|\Theta_0|\)</span> is very large, such as in large scale pre-trained models, finding <span class="math inline">\(\Delta \Theta\)</span> becomes computationally challenging. Also, for each task you need to learn a new <span class="math inline">\(\Delta \Theta\)</span> parameter set, making it even more challenging to deploy fine-tuned models if you have more than a few specific tasks. LoRA proposes using an approximation <span class="math inline">\(\Delta \Phi \approx \Delta \Theta\)</span> with <span class="math inline">\(|\Delta \Phi| &lt;&lt; |\Delta \Theta|\)</span>. The observation is that neural nets have many dense layers performing matrix multiplication, and while they typically have full-rank during pre-training, when adapting to a specific task the weight updates will have a low “intrinsic dimension”.</p>
</div>
<div class="footer">
<p>d’après https://blogs.rstudio.com/ai/posts/2023-06-22-understanding-lora/</p>
</div>
</section>
<section class="slide level2">

<div class="small">
<p>A simple matrix decomposition is applied for each weight matrix update <span class="math inline">\(\Delta \theta \in \Delta \Theta\)</span>. Considering <span class="math inline">\(\Delta \theta_i \in \mathbb{R}^{d \times k}\)</span> the update for the <span class="math inline">\(i\)</span>th weight in the network, LoRA approximates it with:</p>
<p><span class="math display">\[\Delta \theta_i  \approx \Delta \phi_i = BA\]</span> where <span class="math inline">\(B \in \mathbb{R}^{d \times r}\)</span>, <span class="math inline">\(A \in \mathbb{R}^{r \times d}\)</span> and the rank <span class="math inline">\(r &lt;&lt; min(d, k)\)</span>. Thus instead of learning <span class="math inline">\(d \times k\)</span> parameters we now need to learn <span class="math inline">\((d + k) \times r\)</span> which is easily a lot smaller given the multiplicative aspect. In practice, <span class="math inline">\(\Delta \theta_i\)</span> is scaled by <span class="math inline">\(\frac{\alpha}{r}\)</span> before being added to <span class="math inline">\(\theta_i\)</span>, which can be interpreted as a ‘learning rate’ for the LoRA update.</p>
<p>LoRA does not increase inference latency, as once fine tuning is done, you can simply update the weights in <span class="math inline">\(\Theta\)</span> by adding their respective <span class="math inline">\(\Delta \theta \approx \Delta \phi\)</span>. It also makes it simpler to deploy multiple task specific models on top of one large model, as <span class="math inline">\(|\Delta \Phi|\)</span> is much smaller than <span class="math inline">\(|\Delta \Theta|\)</span>.</p>
</div>
<div class="footer">
<p>d’après https://blogs.rstudio.com/ai/posts/2023-06-22-understanding-lora/</p>
</div>
</section>
<section id="implémentation-avec-torch" class="slide level2">
<h2>Implémentation avec torch</h2>
<p>On simule un jeu de données <span class="math inline">\(y = X \theta\)</span> model. <span class="math inline">\(\theta \in \mathbb{R}^{1001, 1000}\)</span>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href=""></a><span class="fu">library</span>(torch)</span>
<span id="cb59-2"><a href=""></a></span>
<span id="cb59-3"><a href=""></a>n <span class="ot">&lt;-</span> <span class="dv">10000</span></span>
<span id="cb59-4"><a href=""></a>d_in <span class="ot">&lt;-</span> <span class="dv">1001</span></span>
<span id="cb59-5"><a href=""></a>d_out <span class="ot">&lt;-</span> <span class="dv">1000</span></span>
<span id="cb59-6"><a href=""></a></span>
<span id="cb59-7"><a href=""></a>thetas <span class="ot">&lt;-</span> <span class="fu">torch_randn</span>(d_in, d_out)</span>
<span id="cb59-8"><a href=""></a></span>
<span id="cb59-9"><a href=""></a>X <span class="ot">&lt;-</span> <span class="fu">torch_randn</span>(n, d_in)</span>
<span id="cb59-10"><a href=""></a>y <span class="ot">&lt;-</span> <span class="fu">torch_matmul</span>(X, thetas)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section class="slide level2">

<p>On entraine un modèle pour estimer <span class="math inline">\(\theta\)</span>. C’est notre modèle entraîné.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href=""></a>lin_model <span class="ot">&lt;-</span> <span class="fu">nn_linear</span>(d_in, d_out, <span class="at">bias =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href=""></a>train <span class="ot">&lt;-</span> <span class="cf">function</span>(model, X, y, <span class="at">batch_size =</span> <span class="dv">128</span>, <span class="at">epochs =</span> <span class="dv">100</span>) {</span>
<span id="cb61-2"><a href=""></a>  opt <span class="ot">&lt;-</span> <span class="fu">optim_adam</span>(model<span class="sc">$</span>parameters)</span>
<span id="cb61-3"><a href=""></a></span>
<span id="cb61-4"><a href=""></a>  <span class="cf">for</span> (epoch <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>epochs) {</span>
<span id="cb61-5"><a href=""></a>    <span class="cf">for</span>(i <span class="cf">in</span> <span class="fu">seq_len</span>(n<span class="sc">/</span>batch_size)) {</span>
<span id="cb61-6"><a href=""></a>      idx <span class="ot">&lt;-</span> <span class="fu">sample.int</span>(n, <span class="at">size =</span> batch_size)</span>
<span id="cb61-7"><a href=""></a>      loss <span class="ot">&lt;-</span> <span class="fu">nnf_mse_loss</span>(<span class="fu">model</span>(X[idx,]), y[idx])</span>
<span id="cb61-8"><a href=""></a>      </span>
<span id="cb61-9"><a href=""></a>      <span class="fu">with_no_grad</span>({</span>
<span id="cb61-10"><a href=""></a>        opt<span class="sc">$</span><span class="fu">zero_grad</span>()</span>
<span id="cb61-11"><a href=""></a>        loss<span class="sc">$</span><span class="fu">backward</span>()</span>
<span id="cb61-12"><a href=""></a>        opt<span class="sc">$</span><span class="fu">step</span>()  </span>
<span id="cb61-13"><a href=""></a>      })</span>
<span id="cb61-14"><a href=""></a>    }</span>
<span id="cb61-15"><a href=""></a>    </span>
<span id="cb61-16"><a href=""></a>    <span class="cf">if</span> (epoch <span class="sc">%%</span> <span class="dv">10</span> <span class="sc">==</span> <span class="dv">0</span>) {</span>
<span id="cb61-17"><a href=""></a>      <span class="fu">with_no_grad</span>({</span>
<span id="cb61-18"><a href=""></a>        loss <span class="ot">&lt;-</span> <span class="fu">nnf_mse_loss</span>(<span class="fu">model</span>(X), y)</span>
<span id="cb61-19"><a href=""></a>      })</span>
<span id="cb61-20"><a href=""></a>      <span class="fu">cat</span>(<span class="st">"["</span>, epoch, <span class="st">"] Loss:"</span>, loss<span class="sc">$</span><span class="fu">item</span>(), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb61-21"><a href=""></a>    }</span>
<span id="cb61-22"><a href=""></a>  }</span>
<span id="cb61-23"><a href=""></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section class="slide level2">

<p>On entraîne le modèle</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href=""></a><span class="fu">train</span>(lin_model, X, y)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[ 10 ] Loss: 576.1445 
[ 20 ] Loss: 311.7431 
[ 30 ] Loss: 154.7832 
[ 40 ] Loss: 68.28712 
[ 50 ] Loss: 25.55022 
[ 60 ] Loss: 7.555232 
[ 70 ] Loss: 1.584495 
[ 80 ] Loss: 0.2017507 
[ 90 ] Loss: 0.01315673 
[ 100 ] Loss: 0.0004144467 </code></pre>
</div>
</div>
</section>
<section class="slide level2">

<p>On simule une distribution des données différente en appliquant une transformation à <span class="math inline">\(\theta\)</span></p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href=""></a>thetas2 <span class="ot">&lt;-</span> thetas <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb64-2"><a href=""></a></span>
<span id="cb64-3"><a href=""></a>X2 <span class="ot">&lt;-</span> <span class="fu">torch_randn</span>(n, d_in)</span>
<span id="cb64-4"><a href=""></a>y2 <span class="ot">&lt;-</span> <span class="fu">torch_matmul</span>(X2, thetas2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Sur ces données, le modèle donne de mauvais résultats :</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href=""></a><span class="fu">nnf_mse_loss</span>(<span class="fu">lin_model</span>(X2), y2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>torch_tensor
1015.4
[ CPUFloatType{} ][ grad_fn = &lt;MseLossBackward0&gt; ]</code></pre>
</div>
</div>
</section>
<section class="slide level2">

<div class="small">
<p>Le nouveau LoRA - s’ajoute au modèle <code>linear</code> dont on gèle les poids - avec des tenseurs A et B de dimension intérieure <span class="math inline">\(r\)</span></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href=""></a>lora_nn_linear <span class="ot">&lt;-</span> <span class="fu">nn_module</span>(</span>
<span id="cb67-2"><a href=""></a>  <span class="at">initialize =</span> <span class="cf">function</span>(linear, <span class="at">r =</span> <span class="dv">16</span>L, <span class="at">alpha =</span> <span class="dv">1</span>) {</span>
<span id="cb67-3"><a href=""></a>    self<span class="sc">$</span>linear <span class="ot">&lt;-</span> linear</span>
<span id="cb67-4"><a href=""></a>    </span>
<span id="cb67-5"><a href=""></a>    <span class="co"># parameters from the original linear module are 'freezed', so they are not</span></span>
<span id="cb67-6"><a href=""></a>    <span class="co"># tracked by autograd. They are considered just constants.</span></span>
<span id="cb67-7"><a href=""></a>    purrr<span class="sc">::</span><span class="fu">walk</span>(self<span class="sc">$</span>linear<span class="sc">$</span>parameters, \(x) x<span class="sc">$</span><span class="fu">requires_grad_</span>(<span class="cn">FALSE</span>))</span>
<span id="cb67-8"><a href=""></a>    </span>
<span id="cb67-9"><a href=""></a>    <span class="co"># the low rank parameters that will be trained (shortcut here, specific to our lin_model)</span></span>
<span id="cb67-10"><a href=""></a>    self<span class="sc">$</span>A <span class="ot">&lt;-</span> <span class="fu">nn_parameter</span>(<span class="fu">torch_randn</span>(linear<span class="sc">$</span>in_features, r))</span>
<span id="cb67-11"><a href=""></a>    self<span class="sc">$</span>B <span class="ot">&lt;-</span> <span class="fu">nn_parameter</span>(<span class="fu">torch_zeros</span>(r, linear<span class="sc">$</span>out_features))</span>
<span id="cb67-12"><a href=""></a>    </span>
<span id="cb67-13"><a href=""></a>    <span class="co"># the scaling constant</span></span>
<span id="cb67-14"><a href=""></a>    self<span class="sc">$</span>scaling <span class="ot">&lt;-</span> alpha <span class="sc">/</span> r</span>
<span id="cb67-15"><a href=""></a>  },</span>
<span id="cb67-16"><a href=""></a>  <span class="at">forward =</span> <span class="cf">function</span>(x) {</span>
<span id="cb67-17"><a href=""></a>    <span class="co"># the modified forward, that just adds the result from the base model</span></span>
<span id="cb67-18"><a href=""></a>    <span class="co"># and ABx.</span></span>
<span id="cb67-19"><a href=""></a>    self<span class="sc">$</span><span class="fu">linear</span>(x) <span class="sc">+</span> <span class="fu">torch_matmul</span>(x, <span class="fu">torch_matmul</span>(self<span class="sc">$</span>A, self<span class="sc">$</span>B) <span class="sc">*</span> self<span class="sc">$</span>scaling)</span>
<span id="cb67-20"><a href=""></a>  }</span>
<span id="cb67-21"><a href=""></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</section>
<section class="slide level2">

<p>Essayons un LoRA avec <span class="math inline">\(r = 1\)</span> i.e.&nbsp;A et B sont des vecteurs</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href=""></a>lora <span class="ot">&lt;-</span> <span class="fu">lora_nn_linear</span>(lin_model, <span class="at">r =</span> <span class="dv">1</span>L)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>entraînement du LoRA sur la nouvelle distribution</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href=""></a><span class="fu">train</span>(lora, X2, y2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[ 10 ] Loss: 822.5748 
[ 20 ] Loss: 502.3997 
[ 30 ] Loss: 269.0267 
[ 40 ] Loss: 128.1122 
[ 50 ] Loss: 51.72063 
[ 60 ] Loss: 16.78399 
[ 70 ] Loss: 3.872193 
[ 80 ] Loss: 0.5433885 
[ 90 ] Loss: 0.03720061 
[ 100 ] Loss: 0.001482832 </code></pre>
</div>
</div>
</section>
<section class="slide level2">

<p>Le tenseur <span class="math inline">\(\Delta \theta\)</span> est idéalement constant à 1 :</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href=""></a>delta_theta <span class="ot">&lt;-</span> <span class="fu">torch_matmul</span>(lora<span class="sc">$</span>A, lora<span class="sc">$</span>B)<span class="sc">*</span>lora<span class="sc">$</span>scaling</span>
<span id="cb71-2"><a href=""></a>delta_theta[<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>torch_tensor
 1.0004  1.0004  1.0004  1.0004  1.0004
 0.9990  0.9990  0.9990  0.9990  0.9990
 0.9996  0.9996  0.9996  0.9996  0.9996
 1.0000  1.0000  1.0000  1.0000  1.0000
 1.0031  1.0031  1.0031  1.0031  1.0031
[ CPUFloatType{5,5} ][ grad_fn = &lt;SliceBackward0&gt; ]</code></pre>
</div>
</div>
</section>
<section class="slide level2">

<div class="small">
<p>Pour diminuer le temps d’inférence, unne astuce consiste à ajouter le LoRA directement au poids du modèle avec la fonction <code>$add_</code>. Ainsi on passe de deux inférences séquentielle, à une seule.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href=""></a><span class="fu">with_no_grad</span>({</span>
<span id="cb73-2"><a href=""></a>  lin_model<span class="sc">$</span>weight<span class="sc">$</span><span class="fu">add_</span>(delta_theta<span class="sc">$</span><span class="fu">t</span>())  </span>
<span id="cb73-3"><a href=""></a>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>torch_tensor
Columns 1 to 6 1.3296e+00  1.8897e+00  1.9052e+00  8.8789e-01  5.7730e-01 -7.2437e-01
 1.5356e+00  1.0976e+00  3.7098e-01  2.4404e+00  6.0118e-01  2.5537e+00
 1.0272e+00  2.2950e+00  1.0595e+00 -1.4303e+00 -9.6837e-01 -5.9120e-01
-2.1933e-01 -1.4212e+00  8.9101e-01 -5.8642e-01  2.4124e-01  3.0441e-01
-2.6172e-01  1.2927e+00  3.8304e-01  8.7396e-01  1.7198e+00  5.5940e-01
 2.3079e+00  1.2573e+00  6.4025e-01  7.9074e-01  7.8315e-01  5.9160e-01
 1.2115e+00  1.6857e+00  1.7758e+00  6.2833e-02  6.6519e-01  9.6148e-01
 2.1404e+00  9.7614e-01  5.7296e-01  1.0825e+00  8.0712e-01  3.3358e+00
 7.8929e-01  9.8394e-01  1.2060e+00  1.3180e+00  1.4406e+00  3.7330e-01
 1.9861e+00  3.1351e-01  2.9631e+00  3.2030e+00  1.1397e+00  1.7112e+00
 7.8322e-01  3.7029e-01 -8.8482e-01 -7.2995e-01  3.0561e+00 -3.1705e-01
 1.1534e+00  2.3267e-02  1.9047e+00  1.8038e+00  1.2682e+00  5.9352e-01
 5.9485e-01 -2.5446e-02  1.1699e+00  1.4308e+00 -8.8578e-01  2.0962e+00
 2.1267e+00  1.4824e+00  1.2820e+00  1.7036e-02  7.2985e-01  2.6467e+00
 1.1590e+00  2.4813e-01  1.4595e+00  2.1040e+00  2.2793e+00  1.0841e-01
 1.2398e+00  1.1105e+00  1.1314e+00  3.5579e-01  2.0812e+00  1.9316e+00
 9.5425e-01  1.9628e-01  4.7002e-01 -3.4403e-01  8.4918e-01  9.6836e-01
 9.8800e-01  7.6103e-01  7.3856e-01  2.7577e-01  1.2597e+00  7.5675e-01
 1.5487e+00  4.2922e-01 -2.4839e-01  1.8699e+00 -3.3714e-01  1.3704e+00
 3.0083e-01  1.9623e+00 -4.5198e-01 -1.1321e-01 -1.1743e+00  1.5907e+00
 4.1948e-01 -3.0987e-01  4.1868e-01  2.4399e+00  3.8666e+00  1.7528e+00
 4.5064e-02 -1.3428e+00  2.5994e+00  2.1292e+00  9.1486e-01  2.9810e+00
 2.3382e+00  2.0190e+00  9.7139e-01  8.6148e-01  1.3057e+00  9.2060e-01
 4.1141e-01  5.1131e-01 -1.2216e-01  1.2400e+00 -7.5281e-01  1.5566e+00
 2.1580e+00  9.0185e-02  7.5922e-01 -1.2410e-03 -8.8862e-02  1.0327e+00
 1.6650e+00  1.3202e+00  1.0391e+00  1.4185e+00  1.5799e+00 -4.3918e-01
 7.6200e-01  4.7425e-01  7.6585e-01  9.5746e-01  7.9398e-01  6.8105e-02
 1.8371e+00  7.8232e-03  1.4358e+00  8.4805e-01 -7.6245e-01  8.7180e-01
 4.7109e-01  2.2638e-01  1.9839e+00  1.3257e+00  2.5585e+00 -3.8413e-02
 2.7700e+00 -3.4488e-01  7.9598e-01  7.6606e-01  1.3574e-01  7.4905e-01
... [the output was truncated (use n=-1 to disable)]
[ CPUFloatType{1000,1001} ]</code></pre>
</div>
</div>
<p>Quel est la performance sur la nouvelle distribution ?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href=""></a><span class="fu">nnf_mse_loss</span>(<span class="fu">lin_model</span>(X2), y2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>torch_tensor
0.00148283
[ CPUFloatType{} ]</code></pre>
</div>
</div>
</div>
</section></section>
<section id="un-classifieur-dimages-métier-avec-le-fine-tuning-de-resnext50" class="title-slide slide level1 center">
<h1>Un classifieur d’images métier avec le fine tuning de ResNext50</h1>

</section>


    </div>
  <div class="quarto-auto-generated-content" style="display: none;">
<p><img src="images/mlverse.png" class="slide-logo"></p>
<div class="footer footer-default">
<p><a href="https://github.com/cregouby/happyR-torch-slides">{torch} {tabnet} and friends</a></p>
</div>
</div></div>

  <script>window.backupDefine = window.define; window.define = undefined;</script>
  <script src="index_files/libs/revealjs/dist/reveal.js"></script>
  <!-- reveal.js plugins -->
  <script src="index_files/libs/revealjs/plugin/quarto-line-highlight/line-highlight.js"></script>
  <script src="index_files/libs/revealjs/plugin/pdf-export/pdfexport.js"></script>
  <script src="index_files/libs/revealjs/plugin/reveal-menu/menu.js"></script>
  <script src="index_files/libs/revealjs/plugin/reveal-menu/quarto-menu.js"></script>
  <script src="index_files/libs/revealjs/plugin/reveal-chalkboard/plugin.js"></script>
  <script src="index_files/libs/revealjs/plugin/quarto-support/support.js"></script>
  

  <script src="index_files/libs/revealjs/plugin/notes/notes.js"></script>
  <script src="index_files/libs/revealjs/plugin/search/search.js"></script>
  <script src="index_files/libs/revealjs/plugin/zoom/zoom.js"></script>
  <script src="index_files/libs/revealjs/plugin/math/math.js"></script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script>

  <script>

      // Full list of configuration options available at:
      // https://revealjs.com/config/
      Reveal.initialize({
'controlsAuto': true,
'previewLinksAuto': false,
'pdfSeparateFragments': false,
'autoAnimateEasing': "ease",
'autoAnimateDuration': 1,
'autoAnimateUnmatched': true,
'jumpToSlide': true,
'menu': {"side":"left","useTextContentForMissingTitles":true,"markers":false,"loadIcons":false,"custom":[{"title":"Tools","icon":"<i class=\"fas fa-gear\"></i>","content":"<ul class=\"slide-menu-items\">\n<li class=\"slide-tool-item active\" data-item=\"0\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.fullscreen(event)\"><kbd>f</kbd> Fullscreen</a></li>\n<li class=\"slide-tool-item\" data-item=\"1\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.speakerMode(event)\"><kbd>s</kbd> Speaker View</a></li>\n<li class=\"slide-tool-item\" data-item=\"2\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.overview(event)\"><kbd>o</kbd> Slide Overview</a></li>\n<li class=\"slide-tool-item\" data-item=\"3\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.togglePdfExport(event)\"><kbd>e</kbd> PDF Export Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"4\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.toggleChalkboard(event)\"><kbd>b</kbd> Toggle Chalkboard</a></li>\n<li class=\"slide-tool-item\" data-item=\"5\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.toggleNotesCanvas(event)\"><kbd>c</kbd> Toggle Notes Canvas</a></li>\n<li class=\"slide-tool-item\" data-item=\"6\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.downloadDrawings(event)\"><kbd>d</kbd> Download Drawings</a></li>\n<li class=\"slide-tool-item\" data-item=\"7\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.keyboardHelp(event)\"><kbd>?</kbd> Keyboard Help</a></li>\n</ul>"}],"openButton":true},
'chalkboard': {"buttons":true},
'smaller': false,
 
        // Display controls in the bottom right corner
        controls: false,

        // Help the user learn the controls by providing hints, for example by
        // bouncing the down arrow when they first encounter a vertical slide
        controlsTutorial: false,

        // Determines where controls appear, "edges" or "bottom-right"
        controlsLayout: 'edges',

        // Visibility rule for backwards navigation arrows; "faded", "hidden"
        // or "visible"
        controlsBackArrows: 'faded',

        // Display a presentation progress bar
        progress: true,

        // Display the page number of the current slide
        slideNumber: 'c/t',

        // 'all', 'print', or 'speaker'
        showSlideNumber: 'all',

        // Add the current slide number to the URL hash so that reloading the
        // page/copying the URL will return you to the same slide
        hash: true,

        // Start with 1 for the hash rather than 0
        hashOneBasedIndex: false,

        // Flags if we should monitor the hash and change slides accordingly
        respondToHashChanges: true,

        // Push each slide change to the browser history
        history: true,

        // Enable keyboard shortcuts for navigation
        keyboard: true,

        // Enable the slide overview mode
        overview: true,

        // Disables the default reveal.js slide layout (scaling and centering)
        // so that you can use custom CSS layout
        disableLayout: false,

        // Vertical centering of slides
        center: false,

        // Enables touch navigation on devices with touch input
        touch: true,

        // Loop the presentation
        loop: false,

        // Change the presentation direction to be RTL
        rtl: false,

        // see https://revealjs.com/vertical-slides/#navigation-mode
        navigationMode: 'linear',

        // Randomizes the order of slides each time the presentation loads
        shuffle: false,

        // Turns fragments on and off globally
        fragments: true,

        // Flags whether to include the current fragment in the URL,
        // so that reloading brings you to the same fragment position
        fragmentInURL: false,

        // Flags if the presentation is running in an embedded mode,
        // i.e. contained within a limited portion of the screen
        embedded: false,

        // Flags if we should show a help overlay when the questionmark
        // key is pressed
        help: true,

        // Flags if it should be possible to pause the presentation (blackout)
        pause: true,

        // Flags if speaker notes should be visible to all viewers
        showNotes: false,

        // Global override for autoplaying embedded media (null/true/false)
        autoPlayMedia: null,

        // Global override for preloading lazy-loaded iframes (null/true/false)
        preloadIframes: null,

        // Number of milliseconds between automatically proceeding to the
        // next slide, disabled when set to 0, this value can be overwritten
        // by using a data-autoslide attribute on your slides
        autoSlide: 0,

        // Stop auto-sliding after user input
        autoSlideStoppable: true,

        // Use this method for navigation when auto-sliding
        autoSlideMethod: null,

        // Specify the average time in seconds that you think you will spend
        // presenting each slide. This is used to show a pacing timer in the
        // speaker view
        defaultTiming: null,

        // Enable slide navigation via mouse wheel
        mouseWheel: false,

        // The display mode that will be used to show slides
        display: 'block',

        // Hide cursor if inactive
        hideInactiveCursor: true,

        // Time before the cursor is hidden (in ms)
        hideCursorTime: 5000,

        // Opens links in an iframe preview overlay
        previewLinks: false,

        // Transition style (none/fade/slide/convex/concave/zoom)
        transition: 'fade',

        // Transition speed (default/fast/slow)
        transitionSpeed: 'default',

        // Transition style for full page slide backgrounds
        // (none/fade/slide/convex/concave/zoom)
        backgroundTransition: 'none',

        // Number of slides away from the current that are visible
        viewDistance: 3,

        // Number of slides away from the current that are visible on mobile
        // devices. It is advisable to set this to a lower number than
        // viewDistance in order to save resources.
        mobileViewDistance: 2,

        // The "normal" size of the presentation, aspect ratio will be preserved
        // when the presentation is scaled to fit different resolutions. Can be
        // specified using percentage units.
        width: 1050,

        height: 700,

        // Factor of the display size that should remain empty around the content
        margin: 0.1,

        math: {
          mathjax: 'https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/MathJax.js',
          config: 'TeX-AMS_HTML-full',
          tex2jax: {
            inlineMath: [['\\(','\\)']],
            displayMath: [['\\[','\\]']],
            balanceBraces: true,
            processEscapes: false,
            processRefs: true,
            processEnvironments: true,
            preview: 'TeX',
            skipTags: ['script','noscript','style','textarea','pre','code'],
            ignoreClass: 'tex2jax_ignore',
            processClass: 'tex2jax_process'
          },
        },

        // reveal.js plugins
        plugins: [QuartoLineHighlight, PdfExport, RevealMenu, RevealChalkboard, QuartoSupport,

          RevealMath,
          RevealNotes,
          RevealSearch,
          RevealZoom
        ]
      });
    </script>
    
    <script>
      // htmlwidgets need to know to resize themselves when slides are shown/hidden.
      // Fire the "slideenter" event (handled by htmlwidgets.js) when the current
      // slide changes (different for each slide format).
      (function () {
        // dispatch for htmlwidgets
        function fireSlideEnter() {
          const event = window.document.createEvent("Event");
          event.initEvent("slideenter", true, true);
          window.document.dispatchEvent(event);
        }

        function fireSlideChanged(previousSlide, currentSlide) {
          fireSlideEnter();

          // dispatch for shiny
          if (window.jQuery) {
            if (previousSlide) {
              window.jQuery(previousSlide).trigger("hidden");
            }
            if (currentSlide) {
              window.jQuery(currentSlide).trigger("shown");
            }
          }
        }

        // hookup for slidy
        if (window.w3c_slidy) {
          window.w3c_slidy.add_observer(function (slide_num) {
            // slide_num starts at position 1
            fireSlideChanged(null, w3c_slidy.slides[slide_num - 1]);
          });
        }

      })();
    </script>

    <script id="quarto-html-after-body" type="application/javascript">
    window.document.addEventListener("DOMContentLoaded", function (event) {
      const toggleBodyColorMode = (bsSheetEl) => {
        const mode = bsSheetEl.getAttribute("data-mode");
        const bodyEl = window.document.querySelector("body");
        if (mode === "dark") {
          bodyEl.classList.add("quarto-dark");
          bodyEl.classList.remove("quarto-light");
        } else {
          bodyEl.classList.add("quarto-light");
          bodyEl.classList.remove("quarto-dark");
        }
      }
      const toggleBodyColorPrimary = () => {
        const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
        if (bsSheetEl) {
          toggleBodyColorMode(bsSheetEl);
        }
      }
      toggleBodyColorPrimary();  
      const tabsets =  window.document.querySelectorAll(".panel-tabset-tabby")
      tabsets.forEach(function(tabset) {
        const tabby = new Tabby('#' + tabset.id);
      });
      const isCodeAnnotation = (el) => {
        for (const clz of el.classList) {
          if (clz.startsWith('code-annotation-')) {                     
            return true;
          }
        }
        return false;
      }
      const onCopySuccess = function(e) {
        // button target
        const button = e.trigger;
        // don't keep focus
        button.blur();
        // flash "checked"
        button.classList.add('code-copy-button-checked');
        var currentTitle = button.getAttribute("title");
        button.setAttribute("title", "Copied!");
        let tooltip;
        if (window.bootstrap) {
          button.setAttribute("data-bs-toggle", "tooltip");
          button.setAttribute("data-bs-placement", "left");
          button.setAttribute("data-bs-title", "Copied!");
          tooltip = new bootstrap.Tooltip(button, 
            { trigger: "manual", 
              customClass: "code-copy-button-tooltip",
              offset: [0, -8]});
          tooltip.show();    
        }
        setTimeout(function() {
          if (tooltip) {
            tooltip.hide();
            button.removeAttribute("data-bs-title");
            button.removeAttribute("data-bs-toggle");
            button.removeAttribute("data-bs-placement");
          }
          button.setAttribute("title", currentTitle);
          button.classList.remove('code-copy-button-checked');
        }, 1000);
        // clear code selection
        e.clearSelection();
      }
      const getTextToCopy = function(trigger) {
          const codeEl = trigger.previousElementSibling.cloneNode(true);
          for (const childEl of codeEl.children) {
            if (isCodeAnnotation(childEl)) {
              childEl.remove();
            }
          }
          return codeEl.innerText;
      }
      const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
        text: getTextToCopy
      });
      clipboard.on('success', onCopySuccess);
      if (window.document.getElementById('quarto-embedded-source-code-modal')) {
        // For code content inside modals, clipBoardJS needs to be initialized with a container option
        // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
        const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
          text: getTextToCopy,
          container: window.document.getElementById('quarto-embedded-source-code-modal')
        });
        clipboardModal.on('success', onCopySuccess);
      }
        var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
        var mailtoRegex = new RegExp(/^mailto:/);
          var filterRegex = new RegExp('/' + window.location.host + '/');
        var isInternal = (href) => {
            return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
        }
        // Inspect non-navigation links and adorn them if external
     	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
        for (var i=0; i<links.length; i++) {
          const link = links[i];
          if (!isInternal(link.href)) {
            // undo the damage that might have been done by quarto-nav.js in the case of
            // links that we want to consider external
            if (link.dataset.originalHref !== undefined) {
              link.href = link.dataset.originalHref;
            }
          }
        }
      function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
        const config = {
          allowHTML: true,
          maxWidth: 500,
          delay: 100,
          arrow: false,
          appendTo: function(el) {
              return el.closest('section.slide') || el.parentElement;
          },
          interactive: true,
          interactiveBorder: 10,
          theme: 'light-border',
          placement: 'bottom-start',
        };
        if (contentFn) {
          config.content = contentFn;
        }
        if (onTriggerFn) {
          config.onTrigger = onTriggerFn;
        }
        if (onUntriggerFn) {
          config.onUntrigger = onUntriggerFn;
        }
          config['offset'] = [0,0];
          config['maxWidth'] = 700;
        window.tippy(el, config); 
      }
      const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
      for (var i=0; i<noterefs.length; i++) {
        const ref = noterefs[i];
        tippyHover(ref, function() {
          // use id or data attribute instead here
          let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
          try { href = new URL(href).hash; } catch {}
          const id = href.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note) {
            return note.innerHTML;
          } else {
            return "";
          }
        });
      }
      const findCites = (el) => {
        const parentEl = el.parentElement;
        if (parentEl) {
          const cites = parentEl.dataset.cites;
          if (cites) {
            return {
              el,
              cites: cites.split(' ')
            };
          } else {
            return findCites(el.parentElement)
          }
        } else {
          return undefined;
        }
      };
      var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
      for (var i=0; i<bibliorefs.length; i++) {
        const ref = bibliorefs[i];
        const citeInfo = findCites(ref);
        if (citeInfo) {
          tippyHover(citeInfo.el, function() {
            var popup = window.document.createElement('div');
            citeInfo.cites.forEach(function(cite) {
              var citeDiv = window.document.createElement('div');
              citeDiv.classList.add('hanging-indent');
              citeDiv.classList.add('csl-entry');
              var biblioDiv = window.document.getElementById('ref-' + cite);
              if (biblioDiv) {
                citeDiv.innerHTML = biblioDiv.innerHTML;
              }
              popup.appendChild(citeDiv);
            });
            return popup.innerHTML;
          });
        }
      }
    });
    </script>
    

</body></html>