<!DOCTYPE html>
<html lang="en"><head>
<script src="index_files/libs/clipboard/clipboard.min.js"></script>
<script src="index_files/libs/quarto-html/tabby.min.js"></script>
<script src="index_files/libs/quarto-html/popper.min.js"></script>
<script src="index_files/libs/quarto-html/tippy.umd.min.js"></script>
<link href="index_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="index_files/libs/quarto-html/light-border.css" rel="stylesheet">
<link href="index_files/libs/quarto-html/quarto-syntax-highlighting-dark-fc7567a641478c5defc9efdff0f817b1.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="index_files/libs/quarto-contrib/glightbox/glightbox.min.js"></script>
<link href="index_files/libs/quarto-contrib/glightbox/glightbox.min.css" rel="stylesheet">
<link href="index_files/libs/quarto-contrib/glightbox/lightbox.css" rel="stylesheet"><meta charset="utf-8">
  <meta name="generator" content="quarto-1.6.28">

  <meta name="author" content="Christophe Regouby">
  <title>{torch} {tabnet} et l’apprentissage profond par l’usage</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
  <link rel="stylesheet" href="index_files/libs/revealjs/dist/reset.css">
  <link rel="stylesheet" href="index_files/libs/revealjs/dist/reveal.css">
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      width: 0.8em;
      margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
      vertical-align: middle;
    }
    /* CSS for syntax highlighting */
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
      }
    pre.numberSource { margin-left: 3em;  padding-left: 4px; }
    div.sourceCode
      { color: #f8f8f2;  }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span { color: #f8f8f2; } /* Normal */
    code span.al { color: #f07178; background-color: #2a0f15; font-weight: bold; } /* Alert */
    code span.an { color: #d4d0ab; } /* Annotation */
    code span.at { color: #00e0e0; } /* Attribute */
    code span.bn { color: #d4d0ab; } /* BaseN */
    code span.bu { color: #abe338; } /* BuiltIn */
    code span.cf { color: #ffa07a; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #abe338; } /* Char */
    code span.cn { color: #ffd700; } /* Constant */
    code span.co { color: #f8f8f2; font-style: italic; } /* Comment */
    code span.cv { color: #ffd700; } /* CommentVar */
    code span.do { color: #f8f8f2; } /* Documentation */
    code span.dt { color: #ffa07a; } /* DataType */
    code span.dv { color: #d4d0ab; } /* DecVal */
    code span.er { color: #f07178; text-decoration: underline; } /* Error */
    code span.ex { color: #00e0e0; font-weight: bold; } /* Extension */
    code span.fl { color: #d4d0ab; } /* Float */
    code span.fu { color: #ffa07a; } /* Function */
    code span.im { color: #abe338; } /* Import */
    code span.in { color: #d4d0ab; } /* Information */
    code span.kw { color: #ffa07a; font-weight: bold; } /* Keyword */
    code span.op { color: #ffa07a; } /* Operator */
    code span.ot { color: #00e0e0; } /* Other */
    code span.pp { color: #dcc6e0; } /* Preprocessor */
    code span.re { color: #00e0e0; background-color: #f8f8f2; } /* RegionMarker */
    code span.sc { color: #abe338; } /* SpecialChar */
    code span.ss { color: #abe338; } /* SpecialString */
    code span.st { color: #abe338; } /* String */
    code span.va { color: #00e0e0; } /* Variable */
    code span.vs { color: #abe338; } /* VerbatimString */
    code span.wa { color: #dcc6e0; } /* Warning */
  </style>
  <link rel="stylesheet" href="index_files/libs/revealjs/dist/theme/quarto-51cd128a7b5158cc7deb9bdf6789af58.css">
  <link href="index_files/libs/revealjs/plugin/quarto-line-highlight/line-highlight.css" rel="stylesheet">
  <link href="index_files/libs/revealjs/plugin/reveal-menu/menu.css" rel="stylesheet">
  <link href="index_files/libs/revealjs/plugin/reveal-menu/quarto-menu.css" rel="stylesheet">
  <link href="index_files/libs/revealjs/plugin/quarto-support/footer.css" rel="stylesheet">
  <style type="text/css">

  .callout {
    margin-top: 1em;
    margin-bottom: 1em;  
    border-radius: .25rem;
  }

  .callout.callout-style-simple { 
    padding: 0em 0.5em;
    border-left: solid #acacac .3rem;
    border-right: solid 1px silver;
    border-top: solid 1px silver;
    border-bottom: solid 1px silver;
    display: flex;
  }

  .callout.callout-style-default {
    border-left: solid #acacac .3rem;
    border-right: solid 1px silver;
    border-top: solid 1px silver;
    border-bottom: solid 1px silver;
  }

  .callout .callout-body-container {
    flex-grow: 1;
  }

  .callout.callout-style-simple .callout-body {
    font-size: 1rem;
    font-weight: 400;
  }

  .callout.callout-style-default .callout-body {
    font-size: 0.9rem;
    font-weight: 400;
  }

  .callout.callout-titled.callout-style-simple .callout-body {
    margin-top: 0.2em;
  }

  .callout:not(.callout-titled) .callout-body {
      display: flex;
  }

  .callout:not(.no-icon).callout-titled.callout-style-simple .callout-content {
    padding-left: 1.6em;
  }

  .callout.callout-titled .callout-header {
    padding-top: 0.2em;
    margin-bottom: -0.2em;
  }

  .callout.callout-titled .callout-title  p {
    margin-top: 0.5em;
    margin-bottom: 0.5em;
  }
    
  .callout.callout-titled.callout-style-simple .callout-content  p {
    margin-top: 0;
  }

  .callout.callout-titled.callout-style-default .callout-content  p {
    margin-top: 0.7em;
  }

  .callout.callout-style-simple div.callout-title {
    border-bottom: none;
    font-size: .9rem;
    font-weight: 600;
    opacity: 75%;
  }

  .callout.callout-style-default  div.callout-title {
    border-bottom: none;
    font-weight: 600;
    opacity: 85%;
    font-size: 0.9rem;
    padding-left: 0.5em;
    padding-right: 0.5em;
  }

  .callout.callout-style-default div.callout-content {
    padding-left: 0.5em;
    padding-right: 0.5em;
  }

  .callout.callout-style-simple .callout-icon::before {
    height: 1rem;
    width: 1rem;
    display: inline-block;
    content: "";
    background-repeat: no-repeat;
    background-size: 1rem 1rem;
  }

  .callout.callout-style-default .callout-icon::before {
    height: 0.9rem;
    width: 0.9rem;
    display: inline-block;
    content: "";
    background-repeat: no-repeat;
    background-size: 0.9rem 0.9rem;
  }

  .callout-title {
    display: flex
  }
    
  .callout-icon::before {
    margin-top: 1rem;
    padding-right: .5rem;
  }

  .callout.no-icon::before {
    display: none !important;
  }

  .callout.callout-titled .callout-body > .callout-content > :last-child {
    padding-bottom: 0.5rem;
    margin-bottom: 0;
  }

  .callout.callout-titled .callout-icon::before {
    margin-top: .5rem;
    padding-right: .5rem;
  }

  .callout:not(.callout-titled) .callout-icon::before {
    margin-top: 1rem;
    padding-right: .5rem;
  }

  /* Callout Types */

  div.callout-note {
    border-left-color: #4582ec !important;
  }

  div.callout-note .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAAEU0lEQVRYCcVXTWhcVRQ+586kSUMMxkyaElstCto2SIhitS5Ek8xUKV2poatCcVHtUlFQk8mbaaziwpWgglJwVaquitBOfhQXFlqlzSJpFSpIYyXNjBNiTCck7x2/8/LeNDOZxDuEkgOXe++553zfefee+/OYLOXFk3+1LLrRdiO81yNqZ6K9cG0P3MeFaMIQjXssE8Z1JzLO9ls20MBZX7oG8w9GxB0goaPrW5aNMp1yOZIa7Wv6o2ykpLtmAPs/vrG14Z+6d4jpbSKuhdcSyq9wGMPXjonwmESXrriLzFGOdDBLB8Y6MNYBu0dRokSygMA/mrun8MGFN3behm6VVAwg4WR3i6FvYK1T7MHo9BK7ydH+1uurECoouk5MPRyVSBrBHMYwVobG2aOXM07sWrn5qgB60rc6mcwIDJtQrnrEr44kmy+UO9r0u9O5/YbkS9juQckLed3DyW2XV/qWBBB3ptvI8EUY3I9p/67OW+g967TNr3Sotn3IuVlfMLVnsBwH4fsnebJvyGm5GeIUA3jljERmrv49SizPYuq+z7c2H/jlGC+Ghhupn/hcapqmcudB9jwJ/3jvnvu6vu5lVzF1fXyZuZZ7U8nRmVzytvT+H3kilYvH09mLWrQdwFSsFEsxFVs5fK7A0g8gMZjbif4ACpKbjv7gNGaD8bUrlk8x+KRflttr22JEMRUbTUwwDQScyzPgedQHZT0xnx7ujw2jfVfExwYHwOsDTjLdJ2ebmeQIlJ7neo41s/DrsL3kl+W2lWvAga0tR3zueGr6GL78M3ifH0rGXrBC2aAR8uYcIA5gwV8zIE8onoh8u0Fca/ciF7j1uOzEnqcIm59sEXoGc0+z6+H45V1CvAvHcD7THztu669cnp+L0okAeIc6zjbM/24LgGM1gZk7jnRu1aQWoU9sfUOuhrmtaPIO3YY1KLLWZaEO5TKUbMY5zx8W9UJ6elpLwKXbsaZ4EFl7B4bMtDv0iRipKoDQT2sNQI9b1utXFdYisi+wzZ/ri/1m7QfDgEuvgUUEIJPq3DhX/5DWNqIXDOweC2wvIR90Oq3lDpdMIgD2r0dXvGdsEW5H6x6HLRJYU7C69VefO1x8Gde1ZFSJLfWS1jbCnhtOPxmpfv2LXOA2Xk2tvnwKKPFuZ/oRmwBwqRQDcKNeVQkYcOjtWVBuM/JuYw5b6isojIkYxyYAFn5K7ZBF10fea52y8QltAg6jnMqNHFBmGkQ1j+U43HMi2xMar1Nv0zGsf1s8nUsmUtPOOrbFIR8bHFDMB5zL13Gmr/kGlCkUzedTzzmzsaJXhYawnA3UmARpiYj5ooJZiUoxFRtK3X6pgNPv+IZVPcnwbOl6f+aBaO1CNvPW9n9LmCp01nuSaTRF2YxHqZ8DYQT6WsXT+RD6eUztwYLZ8rM+rcPxamv1VQzFUkzFXvkiVrySGQgJNvXHJAxiU3/NwiC03rSf05VBaPtu/Z7/B8Yn/w7eguloAAAAAElFTkSuQmCC');
  }

  div.callout-note.callout-style-default .callout-title {
    background-color: #dae6fb
  }

  div.callout-important {
    border-left-color: #d9534f !important;
  }

  div.callout-important .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAAEKklEQVRYCcVXTWhcVRS+575MJym48A+hSRFr00ySRQhURRfd2HYjk2SSTokuBCkU2o0LoSKKraKIBTcuFCoidGFD08nkBzdREbpQ1EDNIv8qSGMFUboImMSZd4/f9zJv8ibJMC8xJQfO3HPPPef7zrvvvnvviIkpC9nsw0UttFunbUhpFzFtarSd6WJkStVMw5xyVqYTvkwfzuf/5FgtkVoB0729j1rjXwThS7Vio+Mo6DNnvLfahoZ+i/o32lULuJ3NNiz7q6+pyAUkJaFF6JwaM2lUJlV0MlnQn5aTRbEu0SEqHUa0A4AdiGuB1kFXRfVyg5d87+Dg4DL6m2TLAub60ilj7A1Ec4odSAc8X95sHh7+ZRPCFo6Fnp7HfU/fBng/hi10CjCnWnJjsxvDNxWw0NfV6Rv5GgP3I3jGWXumdTD/3cbEOP2ZbOZp69yniG3FQ9z1jD7bnBu9Fc2tKGC2q+uAJOQHBDRiZX1x36o7fWBs7J9ownbtO+n0/qWkvW7UPIfc37WgT6ZGR++EOJyeQDSb9UB+DZ1G6DdLDzyS+b/kBCYGsYgJbSQHuThGKRcw5xdeQf8YdNHsc6ePXrlSYMBuSIAFTGAtQo+VuALo4BX83N190NWZWbynBjhOHsmNfFWLeL6v+ynsA58zDvvAC8j5PkbOcXCMg2PZFk3q8MjI7WAG/Dp9AwP7jdGBOOQkAvlFUB+irtm16I1Zw9YBcpGTGXYmk3kQIC/Cds55l+iMI3jqhjAuaoe+am2Jw5GT3Nbz3CkE12NavmzN5+erJW7046n/CH1RO/RVa8lBLozXk9uqykkGAyRXLWlLv5jyp4RFsG5vGVzpDLnIjTWgnRy2Rr+tDKvRc7Y8AyZq10jj8DqXdnIRNtFZb+t/ZRtXcDiVnzpqx8mPcDWxgARUqx0W1QB9MeUZiNrV4qP+Ehc+BpNgATsTX8ozYKL2NtFYAHc84fG7ndxUPr+AR/iQSns7uSUufAymwDOb2+NjK27lEFocm/EE2WpyIy/Hi66MWuMKJn8RvxIcj87IM5Vh9663ziW36kR0HNenXuxmfaD8JC7tfKbrhFr7LiZCrMjrzTeGx+PmkosrkNzW94ObzwocJ7A1HokLolY+AvkTiD/q1H0cN48c5EL8Crkttsa/AXQVDmutfyku0E7jShx49XqV3MFK8IryDhYVbj7Sj2P2eBxwcXoe8T8idsKKPRcnZw1b+slFTubwUwhktrfnAt7J++jwQtLZcm3sr9LQrjRzz6cfMv9aLvgmnAGvpoaGLxM4mAEaLV7iAzQ3oU0IvD5x9ix3yF2RAAuYAOO2f7PEFWCXZ4C9Pb2UsgDeVnFSpbFK7/IWu7TPTvBqzbGdCHOJQSxiEjt6IyZmxQyEJHv6xyQsYk//moVFsN2zP6fRImjfq7/n/wFDguUQFNEwugAAAABJRU5ErkJggg==');
  }

  div.callout-important.callout-style-default .callout-title {
    background-color: #f7dddc
  }

  div.callout-warning {
    border-left-color: #f0ad4e !important;
  }

  div.callout-warning .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAAETklEQVRYCeVWW2gcVRg+58yaTUnizqbipZeX4uWhBEniBaoUX1Ioze52t7sRq6APio9V9MEaoWlVsFasRq0gltaAPuxms8lu0gcviE/FFOstVbSIxgcv6SU7EZqmdc7v9+9mJtNks51NTUH84ed889/PP+cmxP+d5FIbMJmNbpREu4WUkiTtCicKny0l1pIKmBzovF2S+hIJHX8iEu3hZJ5lNZGqyRrGSIQpq15AzF28jgpeY6yk6GVdrfFqdrD6Iw+QlB8g0YS2g7dyQmXM/IDhBhT0UCiRf59lfqmmDvzRt6kByV/m4JjtzuaujMUM2c5Z2d6JdKrRb3K2q6mA+oYVz8JnDdKPmmNthzkAk/lN63sYPgevrguc72aZX/L9C6x09GYyxBgCX4NlvyGUHOKELlm5rXeR1kchuChJt4SSwyddZRXgvwMGvYo4QSlk3/zkHD8UHxwVJA6zjZZqP8v8kK8OWLnIZtLyCAJagYC4rTGW/9Pqj92N/c+LUaAj27movwbi19tk/whRCIE7Q9vyI6yvRpftAKVTdUjOW40X3h5OXsKCdmFcx0xlLJoSuQngnrJe7Kcjm4OMq9FlC7CMmScQANuNvjfP3PjGXDBaUQmbp296S5L4DrpbrHN1T87ZVEZVCzg1FF0Ft+dKrlLukI+/c9ENo+TvlTDbYFvuKPtQ9+l052rXrgKoWkDAFnvh0wTOmYn8R5f4k/jN/fZiCM1tQx9jQQ4ANhqG4hiL0qIFTGViG9DKB7GYzgubnpofgYRwO+DFjh0Zin2m4b/97EDkXkc+f6xYAPX0KK2I/7fUQuwzuwo/L3AkcjugPNixC8cHf0FyPjWlItmLxWw4Ou9YsQCr5fijMGoD/zpdRy95HRysyXA74MWOnscpO4j2y3HAVisw85hX5+AFBRSHt4ShfLFkIMXTqyKFc46xdzQM6XbAi702a7sy04J0+feReMFKp5q9esYLCqAZYw/k14E/xcLLsFElaornTuJB0svMuJINy8xkIYuL+xPAlWRceH6+HX7THJ0djLUom46zREu7tTkxwmf/FdOZ/sh6Q8qvEAiHpm4PJ4a/doJe0gH1t+aHRgCzOvBvJedEK5OFE5jpm4AGP2a8Dxe3gGJ/pAutug9Gp6he92CsSsWBaEcxGx0FHytmIpuqGkOpldqNYQK8cSoXvd+xLxXADw0kf6UkJNFtdo5MOgaLjiQOQHcn+A6h5NuL2s0qsC2LOM75PcF3yr5STuBSAcGG+meA14K/CI21HcS4LBT6tv0QAh8Dr5l93AhZzG5ZJ4VxAqdZUEl9z7WJ4aN+svMvwHHL21UKTd1mqvChH7/Za5xzXBBKrUcB0TQ+Ulgkfbi/H/YT5EptrGzsEK7tR1B7ln9BBwckYfMiuSqklSznIuoIIOM42MQO+QnduCoFCI0bpkzjCjddHPN/F+2Yu+sd9bKNpVwHhbS3LluK/0zgfwD0xYI5dXuzlQAAAABJRU5ErkJggg==');
  }

  div.callout-warning.callout-style-default .callout-title {
    background-color: #fcefdc
  }

  div.callout-tip {
    border-left-color: #02b875 !important;
  }

  div.callout-tip .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAADr0lEQVRYCe1XTWgTQRj9ZjZV8a9SPIkKgj8I1bMHsUWrqYLVg4Ue6v9BwZOxSYsIerFao7UiUryIqJcqgtpimhbBXoSCVxUFe9CTiogUrUp2Pt+3aUI2u5vdNh4dmMzOzHvvezuz8xNFM0mjnbXaNu1MvFWRXkXEyE6aYOYJpdW4IXuA4r0fo8qqSMDBU0v1HJUgVieAXxzCsdE/YJTdFcVIZQNMyhruOMJKXYFoLfIfIvVIMWdsrd+Rpd86ZmyzzjJmLStqRn0v8lzkb4rVIXvnpScOJuAn2ACC65FkPzEdEy4TPWRLJ2h7z4cArXzzaOdKlbOvKKX25Wl00jSnrwVxAg3o4dRxhO13RBSdNvH0xSARv3adTXbBdTf64IWO2vH0LT+cv4GR1DJt+DUItaQogeBX/chhbTBxEiZ6gftlDNXTrvT7co4ub5A6gp9HIcHvzTa46OS5fBeP87Qm0fQkr4FsYgVQ7Qg+ZayaDg9jhg1GkWj8RG6lkeSacrrHgDaxdoBiZPg+NXV/KifMuB6//JmYH4CntVEHy/keA6x4h4CU5oFy8GzrBS18cLJMXcljAKB6INjWsRcuZBWVaS3GDrqB7rdapVIeA+isQ57Eev9eCqzqOa81CY05VLd6SamW2wA2H3SiTbnbSxmzfp7WtKZkqy4mdyAlGx7ennghYf8voqp9cLSgKdqNfa6RdRsAAkPwRuJZNbpByn+RrJi1RXTwdi8RQF6ymDwGMAtZ6TVE+4uoKh+MYkcLsT0Hk8eAienbiGdjJHZTpmNjlbFJNKDVAp2fJlYju6IreQxQ08UJDNYdoLSl6AadO+fFuCQqVMB1NJwPm69T04Wv5WhfcWyfXQB+wXRs1pt+nCknRa0LVzSA/2B+a9+zQJadb7IyyV24YAxKp2Jqs3emZTuNnKxsah+uabKbMk7CbTgJx/zIgQYErIeTKRQ9yD9wxVof5YolPHqaWo7TD6tJlh7jQnK5z2n3+fGdggIOx2kaa2YI9QWarc5Ce1ipNWMKeSG4DysFF52KBmTNMmn5HqCFkwy34rDg05gDwgH3bBi+sgFhN/e8QvRn8kbamCOhgrZ9GJhFDgfcMHzFb6BAtjKpFhzTjwv1KCVuxHvCbsSiEz4CANnj84cwHdFXAbAOJ4LTSAawGWFn5tDhLMYz6nWeU2wJfIhmIJBefcd/A5FWQWGgrWzyORZ3Q6HuV+Jf0Bj+BTX69fm1zWgK7By1YTXchFDORywnfQ7GpzOo6S+qECrsx2ifVQAAAABJRU5ErkJggg==');
  }

  div.callout-tip.callout-style-default .callout-title {
    background-color: #ccf1e3
  }

  div.callout-caution {
    border-left-color: #fd7e14 !important;
  }

  div.callout-caution .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAACV0lEQVRYCdVWzWoUQRCuqp2ICBLJXgITZL1EfQDBW/bkzUMUD7klD+ATSHBEfAIfQO+iXsWDxJsHL96EHAwhgzlkg8nBg25XWb0zIb0zs9muYYWkoKeru+vn664fBqElyZNuyh167NXJ8Ut8McjbmEraKHkd7uAnAFku+VWdb3reSmRV8PKSLfZ0Gjn3a6Xlcq9YGb6tADjn+lUfTXtVmaZ1KwBIvFI11rRXlWlatwIAAv2asaa9mlB9wwygiDX26qaw1yYPzFXg2N1GgG0FMF8Oj+VIx7E/03lHx8UhvYyNZLN7BwSPgekXXLribw7w5/c8EF+DBK5idvDVYtEEwMeYefjjLAdEyQ3M9nfOkgnPTEkYU+sxMq0BxNR6jExrAI31H1rzvLEfRIdgcv1XEdj6QTQAS2wtstEALLG1yEZ3QhH6oDX7ExBSFEkFINXH98NTrme5IOaaA7kIfiu2L8A3qhH9zRbukdCqdsA98TdElyeMe5BI8Rs2xHRIsoTSSVFfCFCWGPn9XHb4cdobRIWABNf0add9jakDjQJpJ1bTXOJXnnRXHRf+dNL1ZV1MBRCXhMbaHqGI1JkKIL7+i8uffuP6wVQAzO7+qVEbF6NbS0LJureYcWXUUhH66nLR5rYmva+2tjRFtojkM2aD76HEGAD3tPtKM309FJg5j/K682ywcWJ3PASCcycH/22u+Bh7Aa0ehM2Fu4z0SAE81HF9RkB21c5bEn4Dzw+/qNOyXr3DCTQDMBOdhi4nAgiFDGCinIa2owCEChUwD8qzd03PG+qdW/4fDzjUMcE1ZpIAAAAASUVORK5CYII=');
  }

  div.callout-caution.callout-style-default .callout-title {
    background-color: #ffe5d0
  }

  </style>
  <style type="text/css">
    .reveal div.sourceCode {
      margin: 0;
      overflow: auto;
    }
    .reveal div.hanging-indent {
      margin-left: 1em;
      text-indent: -1em;
    }
    .reveal .slide:not(.center) {
      height: 100%;
    }
    .reveal .slide.scrollable {
      overflow-y: auto;
    }
    .reveal .footnotes {
      height: 100%;
      overflow-y: auto;
    }
    .reveal .slide .absolute {
      position: absolute;
      display: block;
    }
    .reveal .footnotes ol {
      counter-reset: ol;
      list-style-type: none; 
      margin-left: 0;
    }
    .reveal .footnotes ol li:before {
      counter-increment: ol;
      content: counter(ol) ". "; 
    }
    .reveal .footnotes ol li > p:first-child {
      display: inline-block;
    }
    .reveal .slide ul,
    .reveal .slide ol {
      margin-bottom: 0.5em;
    }
    .reveal .slide ul li,
    .reveal .slide ol li {
      margin-top: 0.4em;
      margin-bottom: 0.2em;
    }
    .reveal .slide ul[role="tablist"] li {
      margin-bottom: 0;
    }
    .reveal .slide ul li > *:first-child,
    .reveal .slide ol li > *:first-child {
      margin-block-start: 0;
    }
    .reveal .slide ul li > *:last-child,
    .reveal .slide ol li > *:last-child {
      margin-block-end: 0;
    }
    .reveal .slide .columns:nth-child(3) {
      margin-block-start: 0.8em;
    }
    .reveal blockquote {
      box-shadow: none;
    }
    .reveal .tippy-content>* {
      margin-top: 0.2em;
      margin-bottom: 0.7em;
    }
    .reveal .tippy-content>*:last-child {
      margin-bottom: 0.2em;
    }
    .reveal .slide > img.stretch.quarto-figure-center,
    .reveal .slide > img.r-stretch.quarto-figure-center {
      display: block;
      margin-left: auto;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-left,
    .reveal .slide > img.r-stretch.quarto-figure-left  {
      display: block;
      margin-left: 0;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-right,
    .reveal .slide > img.r-stretch.quarto-figure-right  {
      display: block;
      margin-left: auto;
      margin-right: 0; 
    }
  </style>
  <link href="index_files/libs/countdown-0.4.0/countdown.css" rel="stylesheet">
  <script src="index_files/libs/countdown-0.4.0/countdown.js"></script>
</head>
<body class="quarto-dark">
  <div class="reveal">
    <div class="slides">

<section id="title-slide" class="quarto-title-block center">
  <h1 class="title">{torch} {tabnet} et l’apprentissage profond par l’usage</h1>
  <p class="subtitle">Atelier des Rencontres R 2025</p>

<div class="quarto-title-authors">
<div class="quarto-title-author">
<div class="quarto-title-author-name">
Christophe Regouby 
</div>
</div>
</div>

</section>
<section id="agenda" class="title-slide slide level1 smaller center">
<h1>Agenda</h1>
<p>Bien commencer avec torch</p>
<p>{torch}</p>
<p>Le mlverse</p>
<p>{tabnet}</p>
<ul>
<li><p>{tabnet} pour la régression avec valeurs manquantes</p></li>
<li><p>{tabnet} pour la classification hiérarchique</p></li>
<li><p>{tabnet} pour la régression logistique déséquilibrée</p></li>
</ul>
<p>GPT2 avec R</p>
<p>Fine-Tuning de GPT2 en français avec un LORA</p>
<p>Un classifieur d’images avec ResNext50 fine-tuning</p>
</section>

<section>
<section id="bien-commencer-avec-torch" class="title-slide slide level1 center">
<h1>Bien commencer avec torch</h1>

</section>
<section class="slide level2">

<p><a href="images/clipboard-1733121037.png" class="lightbox" data-gallery="quarto-lightbox-gallery-1"><img data-src="images/clipboard-1733121037.png"></a></p>
</section>
<section id="licence" class="slide level2">
<h2>Licence</h2>
<p><br> <br> Ce contenu est sous licence <a href="https://creativecommons.org/licenses/by-sa/4.0/">Creative Commons Attribution-ShareAlike 4.0 International License</a> (CC BY-SA4.0).</p>
</section>
<section id="checklist" class="slide level2">
<h2>Checklist</h2>
<p><br></p>
<p><svg aria-hidden="true" role="img" viewbox="0 0 448 512" style="height:1em;width:0.88em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:#C7B41D;overflow:visible;position:relative;"><path d="M438.6 105.4c12.5 12.5 12.5 32.8 0 45.3l-256 256c-12.5 12.5-32.8 12.5-45.3 0l-128-128c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0L160 338.7 393.4 105.4c12.5-12.5 32.8-12.5 45.3 0z"></path></svg> R &amp; RStudio/un IDE confortable installés?</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp; J’ai R 4.5.0 et RStudio 2025.05.0 build 496</p>
<p><svg aria-hidden="true" role="img" viewbox="0 0 448 512" style="height:1em;width:0.88em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:#C7B41D;overflow:visible;position:relative;"><path d="M438.6 105.4c12.5 12.5 12.5 32.8 0 45.3l-256 256c-12.5 12.5-32.8 12.5-45.3 0l-128-128c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0L160 338.7 393.4 105.4c12.5-12.5 32.8-12.5 45.3 0z"></path></svg> {torch} est installé ?</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp; <code>torch::torch_is_installed()</code><br> &nbsp;&nbsp;&nbsp;&nbsp; <em>Your system is ready!</em></p>
<p><svg aria-hidden="true" role="img" viewbox="0 0 448 512" style="height:1em;width:0.88em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:#C7B41D;overflow:visible;position:relative;"><path d="M438.6 105.4c12.5 12.5 12.5 32.8 0 45.3l-256 256c-12.5 12.5-32.8 12.5-45.3 0l-128-128c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0L160 338.7 393.4 105.4c12.5-12.5 32.8-12.5 45.3 0z"></path></svg> Un accélérateur {torch} ?</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp; <code>torch::backends_xxxx_is_available()</code><br> &nbsp;&nbsp;&nbsp;&nbsp; <em>Your system has power!</em></p>
</section>
<section id="autres-ressources" class="slide level2 smaller">
<h2>Autres ressources</h2>
<ul>
<li><p>torch for R <em>website</em> <br> <a href="https://torch.mlverse.org/" class="uri">https://torch.mlverse.org/</a></p></li>
<li><p>Deep-Learning and scientific computing with R <em>book</em> <br> <a href="https://skeydan.github.io/Deep-Learning-and-Scientific-Computing-with-R-torch/" class="uri">https://skeydan.github.io/Deep-Learning-and-Scientific-Computing-with-R-torch/</a></p></li>
<li><p>torch for R <em>cheatsheet</em> <br> <a href="https://rstudio.github.io/cheatsheets/torch.pdf" class="uri">https://rstudio.github.io/cheatsheets/torch.pdf</a></p></li>
<li><p>Deep-learning avec torch <em>Aide-mémoire</em> <br> <a href="https://github.com/rstudio/cheatsheets/blob/main/translations/french/torch_fr.pdf" class="uri">https://github.com/rstudio/cheatsheets/blob/main/translations/french/torch_fr.pdf</a></p></li>
<li><p>Tutoriel de UseR2021! <a href="https://github.com/mlverse/torch-learnr" class="uri">https://github.com/mlverse/torch-learnr</a></p></li>
<li><p>Tutoriel des RencontresR 2024 par Tristan Mary-Huard : <a href="https://stateofther.github.io/finistR2022/autodiff.html" class="uri">https://stateofther.github.io/finistR2022/autodiff.html</a></p></li>
<li><p>le blog AI de Posit (avec la catégorie torch): <a href="https://blogs.rstudio.com/ai/#category:Torch" class="uri">https://blogs.rstudio.com/ai/#category:Torch</a></p></li>
</ul>
<div class="footer">

</div>
</section></section>
<section>
<section id="torch" class="title-slide slide level1 center">
<h1>{torch}</h1>

</section>
<section id="section" class="slide level2">
<h2><img data-src="images/clipboard-3520749809.png"><img data-src="images/clipboard-4058077362.png"></h2>
</section>
<section id="section-1" class="slide level2">
<h2><img data-src="images/clipboard-154709511.png"></h2>
<div class="footer">
<p>source https://xkcd.com/1987/</p>
</div>
</section>
<section id="section-2" class="slide level2">
<h2><img data-src="images/clipboard-1267880778.png"></h2>
<div class="footer">
<p>source https://xkcd.com/1987/</p>
</div>
</section>
<section id="section-3" class="slide level2">
<h2><a href="https://torch.mlverse.org/"><img data-src="images/clipboard-604787592.png"></a></h2>
<div class="footer">

</div>
</section>
<section id="torch-pourquoi-réinventer-leau-chaude" class="slide level2">
<h2>{torch}: pourquoi réinventer l’eau chaude?</h2>
<div class="small">
<ul>
<li><p><strong>facilité</strong> et <strong>frugalité</strong> d’installation sur CPU, GPU, MPS, …</p></li>
<li><p>confort de RStudio pour développer, déverminer, visualiser</p></li>
<li><p>confort de R pour l’<strong>indexation à 1</strong></p></li>
<li><p>la qualité des articles de blog de Posit AI blog</p></li>
<li><p>l’écosystème des packages</p></li>
<li><p>plein de possibilités de <strong>contributions</strong></p></li>
</ul>
<p><img data-src="images/clipboard-torch0130.png"> <img data-src="images/clipboard-torch0142.png"></p>
</div>
</section>
<section id="installation" class="slide level2">
<h2>Installation</h2>
<p>Nominale</p>
<p><a href="images/clipboard-install_.png" class="lightbox" data-gallery="quarto-lightbox-gallery-2"><img data-src="images/clipboard-install_.png"></a></p>
<p>Avancée</p>
<p><a href="images/clipboard-install-adv.png" class="lightbox" data-gallery="quarto-lightbox-gallery-3"><img data-src="images/clipboard-install-adv.png"></a></p>
<div class="footer">
<p>https://torch.mlverse.org/docs/articles/installation.html</p>
</div>
</section>
<section class="slide level2">

<p>Expert : Machine sans connexion</p>
<p><a href="images/clipboard-install-airgap.png" class="lightbox" data-gallery="quarto-lightbox-gallery-4"><img data-src="images/clipboard-install-airgap.png"></a></p>
<p>Expert : déverminage</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode numberSource {r}} number-lines code-with-copy"><code class="sourceCode"><span id="cb1-1"><a href=""></a>Sys.setenv(TORCH_INSTALL_DEBUG = 1)</span>
<span id="cb1-2"><a href=""></a>install_torch()</span>
<span id="cb1-3"><a href=""></a></span>
<span id="cb1-4"><a href=""></a>?install_torch()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="footer">
<p>https://torch.mlverse.org/docs/articles/installation.html</p>
</div>
</section>
<section id="la-pile-logicielle" class="slide level2">
<h2>La pile logicielle</h2>
<p><a href="images/clipboard-1623978672.png" class="lightbox" data-gallery="quarto-lightbox-gallery-5"><img data-src="images/clipboard-1623978672.png" style="height:60.0%"></a></p>
</section>
<section id="la-manipulation-de-tenseurs" class="slide level2">
<h2>La manipulation de tenseurs</h2>
<div class="columns">
<div class="column" style="width:50%;">
<p><a href="images/clipboard-1496841808.png" class="lightbox" data-gallery="quarto-lightbox-gallery-6"><img data-src="images/clipboard-1496841808.png"></a></p>
</div><div class="column" style="width:50%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href=""></a><span class="fu">library</span>(torch)</span>
<span id="cb2-2"><a href=""></a>tt <span class="ot">&lt;-</span> <span class="fu">torch_rand</span>(<span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>)</span>
<span id="cb2-3"><a href=""></a>tt</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>torch_tensor
(1,.,.) = 
  0.4079  0.0998  0.9692  0.3966
  0.9698  0.6952  0.4114  0.5033
  0.3710  0.9156  0.5753  0.9652

(2,.,.) = 
  0.9233  0.0845  0.7120  0.4559
  0.7467  0.2555  0.0890  0.9118
  0.9246  0.0170  0.3035  0.4190
[ CPUFloatType{2,3,4} ]</code></pre>
</div>
</div>
</div></div>
</section>
<section class="slide level2">

<div class="columns">
<div class="column" style="width:50%;">
<div class="small">
<p><a href="images/clipboard-4006123911.png" class="lightbox" data-gallery="quarto-lightbox-gallery-7"><img data-src="images/clipboard-4006123911.png"></a></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href=""></a>tt[, <span class="dv">2</span><span class="sc">:</span>N, ]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>torch_tensor
(1,.,.) = 
  0.9698  0.6952  0.4114  0.5033
  0.3710  0.9156  0.5753  0.9652

(2,.,.) = 
  0.7467  0.2555  0.0890  0.9118
  0.9246  0.0170  0.3035  0.4190
[ CPUFloatType{2,2,4} ]</code></pre>
</div>
</div>
</div>
</div><div class="column" style="width:50%;">
<div class="small">
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href=""></a>tt[<span class="dv">1</span>, <span class="dv">2</span><span class="sc">:</span>N, ]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>torch_tensor
 0.9698  0.6952  0.4114  0.5033
 0.3710  0.9156  0.5753  0.9652
[ CPUFloatType{2,4} ]</code></pre>
</div>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href=""></a>tt[<span class="dv">1</span><span class="sc">:</span><span class="dv">1</span>, <span class="dv">2</span><span class="sc">:</span>N, ]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>torch_tensor
(1,.,.) = 
  0.9698  0.6952  0.4114  0.5033
  0.3710  0.9156  0.5753  0.9652
[ CPUFloatType{1,2,4} ]</code></pre>
</div>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href=""></a><span class="fu">torch_squeeze</span>(tt[<span class="dv">1</span><span class="sc">:</span><span class="dv">1</span>, <span class="dv">2</span><span class="sc">:</span>N, ])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>torch_tensor
 0.9698  0.6952  0.4114  0.5033
 0.3710  0.9156  0.5753  0.9652
[ CPUFloatType{2,4} ]</code></pre>
</div>
</div>
</div>
</div></div>
</section>
<section class="slide level2">

<div class="columns">
<div class="column" style="width:50%;">
<p><a href="images/clipboard-torch_device.png" class="lightbox" data-gallery="quarto-lightbox-gallery-8"><img data-src="images/clipboard-torch_device.png"></a></p>
<div class="small">
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href=""></a>tt<span class="sc">$</span><span class="fu">to</span>(<span class="at">device =</span> <span class="st">"cpu"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>torch_tensor
(1,.,.) = 
  0.4079  0.0998  0.9692  0.3966
  0.9698  0.6952  0.4114  0.5033
  0.3710  0.9156  0.5753  0.9652

(2,.,.) = 
  0.9233  0.0845  0.7120  0.4559
  0.7467  0.2555  0.0890  0.9118
  0.9246  0.0170  0.3035  0.4190
[ CPUFloatType{2,3,4} ]</code></pre>
</div>
</div>
</div>
</div><div class="column" style="width:50%;">
<div class="small">
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href=""></a><span class="fu">as.array</span>(tt<span class="sc">$</span><span class="fu">to</span>(<span class="at">device =</span> <span class="st">"cpu"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>, , 1

          [,1]      [,2]      [,3]
[1,] 0.4078748 0.9698158 0.3709612
[2,] 0.9233411 0.7466968 0.9245820

, , 2

           [,1]      [,2]      [,3]
[1,] 0.09983665 0.6951594 0.9156380
[2,] 0.08450621 0.2555134 0.0169853

, , 3

          [,1]       [,2]      [,3]
[1,] 0.9691979 0.41144335 0.5753279
[2,] 0.7120048 0.08904105 0.3034682

, , 4

          [,1]      [,2]      [,3]
[1,] 0.3966429 0.5032980 0.9652201
[2,] 0.4559080 0.9118193 0.4190165</code></pre>
</div>
</div>
</div>
</div></div>
</section>
<section id="à-vous-de-jouer-exercices" class="slide level2">
<h2>À vous de jouer, exercices</h2>
<p>Installations : <code>00_installation.R</code></p>
<div class="cell">
<div class="cell-output-display">
<div class="countdown" id="timer_82f80826" data-update-every="1" data-play-sound="true" tabindex="0" style="right:0;bottom:0;font-size:2em;">
<div class="countdown-controls"><button class="countdown-bump-down">−</button><button class="countdown-bump-up">+</button></div>
<code class="countdown-time"><span class="countdown-digits minutes">02</span><span class="countdown-digits colon">:</span><span class="countdown-digits seconds">00</span></code>
</div>
</div>
</div>
</section>
<section class="slide level2">

<p>Exercice : <code>01_exercice.</code></p>
<div class="cell">
<div class="cell-output-display">
<div class="countdown" id="timer_d8d1b952" data-update-every="1" data-play-sound="true" tabindex="0" style="right:0;bottom:0;font-size:2em;">
<div class="countdown-controls"><button class="countdown-bump-down">−</button><button class="countdown-bump-up">+</button></div>
<code class="countdown-time"><span class="countdown-digits minutes">05</span><span class="countdown-digits colon">:</span><span class="countdown-digits seconds">00</span></code>
</div>
</div>
</div>
</section>
<section id="les-nn_modules-construire-un-réseau" class="slide level2">
<h2>les <code>nn_modules</code>: construire un réseau</h2>
<div class="small">
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href=""></a>net <span class="ot">&lt;-</span> <span class="fu">nn_module</span>(</span>
<span id="cb16-2"><a href=""></a>  <span class="st">"Net"</span>,</span>
<span id="cb16-3"><a href=""></a>  <span class="at">initialize =</span> <span class="cf">function</span>(num_class) {</span>
<span id="cb16-4"><a href=""></a>    self<span class="sc">$</span>conv1 <span class="ot">&lt;-</span> <span class="fu">nn_conv2d</span>(<span class="dv">1</span>, <span class="dv">32</span>, <span class="dv">3</span>, <span class="dv">1</span>)</span>
<span id="cb16-5"><a href=""></a>    self<span class="sc">$</span>conv2 <span class="ot">&lt;-</span> <span class="fu">nn_conv2d</span>(<span class="dv">32</span>, <span class="dv">64</span>, <span class="dv">3</span>, <span class="dv">1</span>)</span>
<span id="cb16-6"><a href=""></a>    self<span class="sc">$</span>dropout1 <span class="ot">&lt;-</span> <span class="fu">nn_dropout</span>(<span class="fl">0.25</span>)</span>
<span id="cb16-7"><a href=""></a>    self<span class="sc">$</span>dropout2 <span class="ot">&lt;-</span> <span class="fu">nn_dropout</span>(<span class="fl">0.5</span>)</span>
<span id="cb16-8"><a href=""></a>    self<span class="sc">$</span>fc1 <span class="ot">&lt;-</span> <span class="fu">nn_linear</span>(<span class="dv">9216</span>, <span class="dv">128</span>)</span>
<span id="cb16-9"><a href=""></a>    self<span class="sc">$</span>fc2 <span class="ot">&lt;-</span> <span class="fu">nn_linear</span>(<span class="dv">128</span>, num_class)</span>
<span id="cb16-10"><a href=""></a>  },</span>
<span id="cb16-11"><a href=""></a>  <span class="at">forward =</span> <span class="cf">function</span>(x) {</span>
<span id="cb16-12"><a href=""></a>    x <span class="sc">%&gt;%</span> </span>
<span id="cb16-13"><a href=""></a>      self<span class="sc">$</span><span class="fu">conv1</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb16-14"><a href=""></a>      <span class="fu">nnf_relu</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb16-15"><a href=""></a>      self<span class="sc">$</span><span class="fu">conv2</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb16-16"><a href=""></a>      <span class="fu">nnf_relu</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb16-17"><a href=""></a>      <span class="fu">nnf_max_pool2d</span>(<span class="dv">2</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb16-18"><a href=""></a>      self<span class="sc">$</span><span class="fu">dropout1</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb16-19"><a href=""></a>      <span class="fu">torch_flatten</span>(<span class="at">start_dim =</span> <span class="dv">2</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb16-20"><a href=""></a>      self<span class="sc">$</span><span class="fu">fc1</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb16-21"><a href=""></a>      <span class="fu">nnf_relu</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb16-22"><a href=""></a>      self<span class="sc">$</span><span class="fu">dropout2</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb16-23"><a href=""></a>      self<span class="sc">$</span><span class="fu">fc2</span>()</span>
<span id="cb16-24"><a href=""></a>  }</span>
<span id="cb16-25"><a href=""></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</section>
<section id="entraîner-un-réseau-avec-luz" class="slide level2 small">
<h2>entraîner un réseau avec luz</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href=""></a>fitted <span class="ot">&lt;-</span> net <span class="sc">%&gt;%</span></span>
<span id="cb17-2"><a href=""></a>  <span class="fu">setup</span>(</span>
<span id="cb17-3"><a href=""></a>    <span class="at">loss =</span> <span class="fu">nn_cross_entropy_loss</span>(),</span>
<span id="cb17-4"><a href=""></a>    <span class="at">optimizer =</span> optim_ignite_adam,</span>
<span id="cb17-5"><a href=""></a>    <span class="at">metrics =</span> <span class="fu">list</span>(</span>
<span id="cb17-6"><a href=""></a>      <span class="fu">luz_metric_accuracy</span>()</span>
<span id="cb17-7"><a href=""></a>    )</span>
<span id="cb17-8"><a href=""></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb17-9"><a href=""></a>  <span class="fu">set_hparams</span>(<span class="at">num_class =</span> <span class="dv">10</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb17-10"><a href=""></a>  <span class="fu">set_opt_hparams</span>(<span class="at">lr =</span> <span class="fl">0.003</span>) <span class="sc">%&gt;%</span></span>
<span id="cb17-11"><a href=""></a>  <span class="fu">fit</span>(train_dl, <span class="at">epochs =</span> <span class="dv">10</span>, <span class="at">valid_data =</span> test_dl)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section class="slide level2">

<p>Exercice : <code>02_exercice.</code></p>
<div class="cell">
<div class="cell-output-display">
<div class="countdown" id="timer_c4f11765" data-update-every="1" data-play-sound="true" tabindex="0" style="right:0;bottom:0;font-size:2em;">
<div class="countdown-controls"><button class="countdown-bump-down">−</button><button class="countdown-bump-up">+</button></div>
<code class="countdown-time"><span class="countdown-digits minutes">05</span><span class="countdown-digits colon">:</span><span class="countdown-digits seconds">00</span></code>
</div>
</div>
</div>
</section></section>
<section>
<section id="mlverse" class="title-slide slide level1 center">
<h1>mlverse</h1>

</section>
<section id="un-univers-de-dédiés-à-torch" class="slide level2">
<h2>Un univers de 📦 dédiés à {torch}</h2>
<div class="quarto-figure quarto-figure-center">
<figure>
<p><a href="images/tile_mlverse.png" class="lightbox" data-gallery="quarto-lightbox-gallery-9" title="Packages du mlverse / utilisant torch"><img data-src="images/tile_mlverse.png" alt="Packages du mlverse / utilisant torch"></a></p>
<figcaption>Packages du mlverse / utilisant torch</figcaption>
</figure>
</div>
</section>
<section id="un-univers-de-en-français" class="slide level2">
<h2>Un univers de 📦 en français</h2>
<div class="small">
<table class="caption-top">
<caption>Les paquetages disponibles en français</caption>
<thead>
<tr class="header">
<th>paquetage</th>
<th>messages</th>
<th>l’aide<sup>1</sup></th>
<th>les vignettes</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>{torch}</td>
<td><svg aria-hidden="true" role="img" viewbox="0 0 448 512" style="height:1em;width:0.88em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:#C7B41D;overflow:visible;position:relative;"><path d="M438.6 105.4c12.5 12.5 12.5 32.8 0 45.3l-256 256c-12.5 12.5-32.8 12.5-45.3 0l-128-128c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0L160 338.7 393.4 105.4c12.5-12.5 32.8-12.5 45.3 0z"></path></svg></td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td>{torchvision}</td>
<td><svg aria-hidden="true" role="img" viewbox="0 0 448 512" style="height:1em;width:0.88em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:#C7B41D;overflow:visible;position:relative;"><path d="M438.6 105.4c12.5 12.5 12.5 32.8 0 45.3l-256 256c-12.5 12.5-32.8 12.5-45.3 0l-128-128c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0L160 338.7 393.4 105.4c12.5-12.5 32.8-12.5 45.3 0z"></path></svg></td>
<td><svg aria-hidden="true" role="img" viewbox="0 0 448 512" style="height:1em;width:0.88em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:#C7B41D;overflow:visible;position:relative;"><path d="M438.6 105.4c12.5 12.5 12.5 32.8 0 45.3l-256 256c-12.5 12.5-32.8 12.5-45.3 0l-128-128c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0L160 338.7 393.4 105.4c12.5-12.5 32.8-12.5 45.3 0z"></path></svg> <a href="https://github.com/cregouby/torchvision.fr">/torchvision.fr</a></td>
<td></td>
</tr>
<tr class="odd">
<td>{tabnet}</td>
<td><svg aria-hidden="true" role="img" viewbox="0 0 448 512" style="height:1em;width:0.88em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:#C7B41D;overflow:visible;position:relative;"><path d="M438.6 105.4c12.5 12.5 12.5 32.8 0 45.3l-256 256c-12.5 12.5-32.8 12.5-45.3 0l-128-128c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0L160 338.7 393.4 105.4c12.5-12.5 32.8-12.5 45.3 0z"></path></svg></td>
<td><svg aria-hidden="true" role="img" viewbox="0 0 448 512" style="height:1em;width:0.88em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:#C7B41D;overflow:visible;position:relative;"><path d="M438.6 105.4c12.5 12.5 12.5 32.8 0 45.3l-256 256c-12.5 12.5-32.8 12.5-45.3 0l-128-128c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0L160 338.7 393.4 105.4c12.5-12.5 32.8-12.5 45.3 0z"></path></svg> <a href="https://github.com/cregouby/tabnet.fr">/tabnet.fr</a></td>
<td></td>
</tr>
<tr class="even">
<td>{luz}</td>
<td><svg aria-hidden="true" role="img" viewbox="0 0 448 512" style="height:1em;width:0.88em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:#C7B41D;overflow:visible;position:relative;"><path d="M438.6 105.4c12.5 12.5 12.5 32.8 0 45.3l-256 256c-12.5 12.5-32.8 12.5-45.3 0l-128-128c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0L160 338.7 393.4 105.4c12.5-12.5 32.8-12.5 45.3 0z"></path></svg></td>
<td><svg aria-hidden="true" role="img" viewbox="0 0 448 512" style="height:1em;width:0.88em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:#C7B41D;overflow:visible;position:relative;"><path d="M438.6 105.4c12.5 12.5 12.5 32.8 0 45.3l-256 256c-12.5 12.5-32.8 12.5-45.3 0l-128-128c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0L160 338.7 393.4 105.4c12.5-12.5 32.8-12.5 45.3 0z"></path></svg> <a href="https://github.com/cregouby/luz.fr">/luz.fr</a></td>
<td><svg aria-hidden="true" role="img" viewbox="0 0 448 512" style="height:1em;width:0.88em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:#C7B41D;overflow:visible;position:relative;"><path d="M438.6 105.4c12.5 12.5 12.5 32.8 0 45.3l-256 256c-12.5 12.5-32.8 12.5-45.3 0l-128-128c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0L160 338.7 393.4 105.4c12.5-12.5 32.8-12.5 45.3 0z"></path></svg> <a href="https://cregouby.github.io/luz.fr/">cregouby.github.io/luz.fr/</a></td>
</tr>
<tr class="odd">
<td>{hfhub}</td>
<td><svg aria-hidden="true" role="img" viewbox="0 0 448 512" style="height:1em;width:0.88em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:#C7B41D;overflow:visible;position:relative;"><path d="M438.6 105.4c12.5 12.5 12.5 32.8 0 45.3l-256 256c-12.5 12.5-32.8 12.5-45.3 0l-128-128c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0L160 338.7 393.4 105.4c12.5-12.5 32.8-12.5 45.3 0z"></path></svg></td>
<td><svg aria-hidden="true" role="img" viewbox="0 0 448 512" style="height:1em;width:0.88em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:#C7B41D;overflow:visible;position:relative;"><path d="M438.6 105.4c12.5 12.5 12.5 32.8 0 45.3l-256 256c-12.5 12.5-32.8 12.5-45.3 0l-128-128c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0L160 338.7 393.4 105.4c12.5-12.5 32.8-12.5 45.3 0z"></path></svg> <a href="https://github.com/cregouby/hfhub.fr">/hfhub.fr</a></td>
<td></td>
</tr>
<tr class="even">
<td>{tok}</td>
<td><svg aria-hidden="true" role="img" viewbox="0 0 448 512" style="height:1em;width:0.88em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:#C7B41D;overflow:visible;position:relative;"><path d="M438.6 105.4c12.5 12.5 12.5 32.8 0 45.3l-256 256c-12.5 12.5-32.8 12.5-45.3 0l-128-128c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0L160 338.7 393.4 105.4c12.5-12.5 32.8-12.5 45.3 0z"></path></svg></td>
<td><svg aria-hidden="true" role="img" viewbox="0 0 448 512" style="height:1em;width:0.88em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:#C7B41D;overflow:visible;position:relative;"><path d="M438.6 105.4c12.5 12.5 12.5 32.8 0 45.3l-256 256c-12.5 12.5-32.8 12.5-45.3 0l-128-128c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0L160 338.7 393.4 105.4c12.5-12.5 32.8-12.5 45.3 0z"></path></svg> <a href="https://github.com/cregouby/tok.fr">/tok.fr</a></td>
<td></td>
</tr>
<tr class="odd">
<td>{safetensors}</td>
<td><svg aria-hidden="true" role="img" viewbox="0 0 448 512" style="height:1em;width:0.88em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:#C7B41D;overflow:visible;position:relative;"><path d="M438.6 105.4c12.5 12.5 12.5 32.8 0 45.3l-256 256c-12.5 12.5-32.8 12.5-45.3 0l-128-128c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0L160 338.7 393.4 105.4c12.5-12.5 32.8-12.5 45.3 0z"></path></svg></td>
<td><svg aria-hidden="true" role="img" viewbox="0 0 448 512" style="height:1em;width:0.88em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:#C7B41D;overflow:visible;position:relative;"><path d="M438.6 105.4c12.5 12.5 12.5 32.8 0 45.3l-256 256c-12.5 12.5-32.8 12.5-45.3 0l-128-128c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0L160 338.7 393.4 105.4c12.5-12.5 32.8-12.5 45.3 0z"></path></svg> <a href="https://github.com/cregouby/safetensors.fr">/safetensors.fr</a></td>
<td></td>
</tr>
<tr class="even">
<td>{minhub}</td>
<td><svg aria-hidden="true" role="img" viewbox="0 0 448 512" style="height:1em;width:0.88em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:#C7B41D;overflow:visible;position:relative;"><path d="M438.6 105.4c12.5 12.5 12.5 32.8 0 45.3l-256 256c-12.5 12.5-32.8 12.5-45.3 0l-128-128c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0L160 338.7 393.4 105.4c12.5-12.5 32.8-12.5 45.3 0z"></path></svg><sup>2</sup></td>
<td><svg aria-hidden="true" role="img" viewbox="0 0 448 512" style="height:1em;width:0.88em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:#C7B41D;overflow:visible;position:relative;"><path d="M438.6 105.4c12.5 12.5 12.5 32.8 0 45.3l-256 256c-12.5 12.5-32.8 12.5-45.3 0l-128-128c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0L160 338.7 393.4 105.4c12.5-12.5 32.8-12.5 45.3 0z"></path></svg> <a href="https://github.com/cregouby/minhub.fr">/minhub.fr</a></td>
<td></td>
</tr>
</tbody>
</table>
</div>
<aside><ol class="aside-footnotes"><li id="fn1"><p>https://github.com/cregouby/</p></li><li id="fn2"><p>P.R. en cours</p></li></ol></aside></section>
<section class="slide level2">

<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href=""></a><span class="fu">Sys.setLanguage</span>(<span class="at">lang =</span> <span class="st">"fr"</span>)</span>
<span id="cb18-2"><a href=""></a><span class="fu">library</span>(torchvision)</span>
<span id="cb18-3"><a href=""></a><span class="fu">transform_normalize</span>(torch<span class="sc">::</span><span class="fu">torch_rand</span>(<span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">5</span>,<span class="dv">5</span>)), <span class="dv">3</span>, <span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><a href="images/clipboard-3331382707.png" class="lightbox" data-gallery="quarto-lightbox-gallery-10"><img data-src="images/clipboard-3331382707.png"></a></p>
</section>
<section class="slide level2">

<div class="columns">
<div class="column" style="width:40%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href=""></a><span class="fu">Sys.setenv</span>(<span class="at">LANGUAGE=</span><span class="st">"fr"</span>)</span>
<span id="cb19-2"><a href=""></a><span class="fu">library</span>(torchvision.fr)</span>
<span id="cb19-3"><a href=""></a><span class="fu">library</span>(torchvision)</span>
<span id="cb19-4"><a href=""></a>?transform_normalize</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div><div class="column" style="width:60%;">
<p><a href="images/clipboard-1958985727.png" class="lightbox" data-gallery="quarto-lightbox-gallery-11"><img data-src="images/clipboard-1958985727.png"></a></p>
</div></div>
</section></section>
<section>
<section id="tabnet" class="title-slide slide level1 center">
<h1>{tabnet}</h1>

</section>
<section id="section-4" class="slide level2">
<h2><img data-src="images/clipboard-534052795.png"></h2>
<p>v0.7.0 is on CRAN</p>
</section>
<section id="fonctionnement" class="slide level2">
<h2>Fonctionnement</h2>
<p><a href="images/clipboard-2272997678.png" class="lightbox" data-gallery="quarto-lightbox-gallery-12"><img data-src="images/clipboard-2272997678.png"></a></p>
</section>
<section id="usage-intégré-dans-tidymodels" class="slide level2 scrollable smaller">
<h2>Usage intégré dans tidymodels</h2>
<div class="small">
<p>Dataset</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href=""></a><span class="fu">library</span>(tidymodels, <span class="at">quietly =</span> <span class="cn">TRUE</span>)</span>
<span id="cb20-2"><a href=""></a><span class="fu">data</span>(<span class="st">"ames"</span>, <span class="at">package =</span> <span class="st">"modeldata"</span>)</span>
<span id="cb20-3"><a href=""></a><span class="fu">str</span>(ames)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>tibble [2,930 × 74] (S3: tbl_df/tbl/data.frame)
 $ MS_SubClass       : Factor w/ 16 levels "One_Story_1946_and_Newer_All_Styles",..: 1 1 1 1 6 6 12 12 12 6 ...
 $ MS_Zoning         : Factor w/ 7 levels "Floating_Village_Residential",..: 3 2 3 3 3 3 3 3 3 3 ...
 $ Lot_Frontage      : num [1:2930] 141 80 81 93 74 78 41 43 39 60 ...
 $ Lot_Area          : int [1:2930] 31770 11622 14267 11160 13830 9978 4920 5005 5389 7500 ...
 $ Street            : Factor w/ 2 levels "Grvl","Pave": 2 2 2 2 2 2 2 2 2 2 ...
 $ Alley             : Factor w/ 3 levels "Gravel","No_Alley_Access",..: 2 2 2 2 2 2 2 2 2 2 ...
 $ Lot_Shape         : Factor w/ 4 levels "Regular","Slightly_Irregular",..: 2 1 2 1 2 2 1 2 2 1 ...
 $ Land_Contour      : Factor w/ 4 levels "Bnk","HLS","Low",..: 4 4 4 4 4 4 4 2 4 4 ...
 $ Utilities         : Factor w/ 3 levels "AllPub","NoSeWa",..: 1 1 1 1 1 1 1 1 1 1 ...
 $ Lot_Config        : Factor w/ 5 levels "Corner","CulDSac",..: 1 5 1 1 5 5 5 5 5 5 ...
 $ Land_Slope        : Factor w/ 3 levels "Gtl","Mod","Sev": 1 1 1 1 1 1 1 1 1 1 ...
 $ Neighborhood      : Factor w/ 29 levels "North_Ames","College_Creek",..: 1 1 1 1 7 7 17 17 17 7 ...
 $ Condition_1       : Factor w/ 9 levels "Artery","Feedr",..: 3 2 3 3 3 3 3 3 3 3 ...
 $ Condition_2       : Factor w/ 8 levels "Artery","Feedr",..: 3 3 3 3 3 3 3 3 3 3 ...
 $ Bldg_Type         : Factor w/ 5 levels "OneFam","TwoFmCon",..: 1 1 1 1 1 1 5 5 5 1 ...
 $ House_Style       : Factor w/ 8 levels "One_and_Half_Fin",..: 3 3 3 3 8 8 3 3 3 8 ...
 $ Overall_Cond      : Factor w/ 10 levels "Very_Poor","Poor",..: 5 6 6 5 5 6 5 5 5 5 ...
 $ Year_Built        : int [1:2930] 1960 1961 1958 1968 1997 1998 2001 1992 1995 1999 ...
 $ Year_Remod_Add    : int [1:2930] 1960 1961 1958 1968 1998 1998 2001 1992 1996 1999 ...
 $ Roof_Style        : Factor w/ 6 levels "Flat","Gable",..: 4 2 4 4 2 2 2 2 2 2 ...
 $ Roof_Matl         : Factor w/ 8 levels "ClyTile","CompShg",..: 2 2 2 2 2 2 2 2 2 2 ...
 $ Exterior_1st      : Factor w/ 16 levels "AsbShng","AsphShn",..: 4 14 15 4 14 14 6 7 6 14 ...
 $ Exterior_2nd      : Factor w/ 17 levels "AsbShng","AsphShn",..: 11 15 16 4 15 15 6 7 6 15 ...
 $ Mas_Vnr_Type      : Factor w/ 5 levels "BrkCmn","BrkFace",..: 5 4 2 4 4 2 4 4 4 4 ...
 $ Mas_Vnr_Area      : num [1:2930] 112 0 108 0 0 20 0 0 0 0 ...
 $ Exter_Cond        : Factor w/ 5 levels "Excellent","Fair",..: 5 5 5 5 5 5 5 5 5 5 ...
 $ Foundation        : Factor w/ 6 levels "BrkTil","CBlock",..: 2 2 2 2 3 3 3 3 3 3 ...
 $ Bsmt_Cond         : Factor w/ 6 levels "Excellent","Fair",..: 3 6 6 6 6 6 6 6 6 6 ...
 $ Bsmt_Exposure     : Factor w/ 5 levels "Av","Gd","Mn",..: 2 4 4 4 4 4 3 4 4 4 ...
 $ BsmtFin_Type_1    : Factor w/ 7 levels "ALQ","BLQ","GLQ",..: 2 6 1 1 3 3 3 1 3 7 ...
 $ BsmtFin_SF_1      : num [1:2930] 2 6 1 1 3 3 3 1 3 7 ...
 $ BsmtFin_Type_2    : Factor w/ 7 levels "ALQ","BLQ","GLQ",..: 7 4 7 7 7 7 7 7 7 7 ...
 $ BsmtFin_SF_2      : num [1:2930] 0 144 0 0 0 0 0 0 0 0 ...
 $ Bsmt_Unf_SF       : num [1:2930] 441 270 406 1045 137 ...
 $ Total_Bsmt_SF     : num [1:2930] 1080 882 1329 2110 928 ...
 $ Heating           : Factor w/ 6 levels "Floor","GasA",..: 2 2 2 2 2 2 2 2 2 2 ...
 $ Heating_QC        : Factor w/ 5 levels "Excellent","Fair",..: 2 5 5 1 3 1 1 1 1 3 ...
 $ Central_Air       : Factor w/ 2 levels "N","Y": 2 2 2 2 2 2 2 2 2 2 ...
 $ Electrical        : Factor w/ 6 levels "FuseA","FuseF",..: 5 5 5 5 5 5 5 5 5 5 ...
 $ First_Flr_SF      : int [1:2930] 1656 896 1329 2110 928 926 1338 1280 1616 1028 ...
 $ Second_Flr_SF     : int [1:2930] 0 0 0 0 701 678 0 0 0 776 ...
 $ Gr_Liv_Area       : int [1:2930] 1656 896 1329 2110 1629 1604 1338 1280 1616 1804 ...
 $ Bsmt_Full_Bath    : num [1:2930] 1 0 0 1 0 0 1 0 1 0 ...
 $ Bsmt_Half_Bath    : num [1:2930] 0 0 0 0 0 0 0 0 0 0 ...
 $ Full_Bath         : int [1:2930] 1 1 1 2 2 2 2 2 2 2 ...
 $ Half_Bath         : int [1:2930] 0 0 1 1 1 1 0 0 0 1 ...
 $ Bedroom_AbvGr     : int [1:2930] 3 2 3 3 3 3 2 2 2 3 ...
 $ Kitchen_AbvGr     : int [1:2930] 1 1 1 1 1 1 1 1 1 1 ...
 $ TotRms_AbvGrd     : int [1:2930] 7 5 6 8 6 7 6 5 5 7 ...
 $ Functional        : Factor w/ 8 levels "Maj1","Maj2",..: 8 8 8 8 8 8 8 8 8 8 ...
 $ Fireplaces        : int [1:2930] 2 0 0 2 1 1 0 0 1 1 ...
 $ Garage_Type       : Factor w/ 7 levels "Attchd","Basment",..: 1 1 1 1 1 1 1 1 1 1 ...
 $ Garage_Finish     : Factor w/ 4 levels "Fin","No_Garage",..: 1 4 4 1 1 1 1 3 3 1 ...
 $ Garage_Cars       : num [1:2930] 2 1 1 2 2 2 2 2 2 2 ...
 $ Garage_Area       : num [1:2930] 528 730 312 522 482 470 582 506 608 442 ...
 $ Garage_Cond       : Factor w/ 6 levels "Excellent","Fair",..: 6 6 6 6 6 6 6 6 6 6 ...
 $ Paved_Drive       : Factor w/ 3 levels "Dirt_Gravel",..: 2 3 3 3 3 3 3 3 3 3 ...
 $ Wood_Deck_SF      : int [1:2930] 210 140 393 0 212 360 0 0 237 140 ...
 $ Open_Porch_SF     : int [1:2930] 62 0 36 0 34 36 0 82 152 60 ...
 $ Enclosed_Porch    : int [1:2930] 0 0 0 0 0 0 170 0 0 0 ...
 $ Three_season_porch: int [1:2930] 0 0 0 0 0 0 0 0 0 0 ...
 $ Screen_Porch      : int [1:2930] 0 120 0 0 0 0 0 144 0 0 ...
 $ Pool_Area         : int [1:2930] 0 0 0 0 0 0 0 0 0 0 ...
 $ Pool_QC           : Factor w/ 5 levels "Excellent","Fair",..: 4 4 4 4 4 4 4 4 4 4 ...
 $ Fence             : Factor w/ 5 levels "Good_Privacy",..: 5 3 5 5 3 5 5 5 5 5 ...
 $ Misc_Feature      : Factor w/ 6 levels "Elev","Gar2",..: 3 3 2 3 3 3 3 3 3 3 ...
 $ Misc_Val          : int [1:2930] 0 0 12500 0 0 0 0 0 0 0 ...
 $ Mo_Sold           : int [1:2930] 5 6 6 4 3 6 4 1 3 6 ...
 $ Year_Sold         : int [1:2930] 2010 2010 2010 2010 2010 2010 2010 2010 2010 2010 ...
 $ Sale_Type         : Factor w/ 10 levels "COD","Con","ConLD",..: 10 10 10 10 10 10 10 10 10 10 ...
 $ Sale_Condition    : Factor w/ 6 levels "Abnorml","AdjLand",..: 5 5 5 5 5 5 5 5 5 5 ...
 $ Sale_Price        : int [1:2930] 215000 105000 172000 244000 189900 195500 213500 191500 236500 189000 ...
 $ Longitude         : num [1:2930] -93.6 -93.6 -93.6 -93.6 -93.6 ...
 $ Latitude          : num [1:2930] 42.1 42.1 42.1 42.1 42.1 ...</code></pre>
</div>
</div>
<p>Recipe</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href=""></a>ames <span class="ot">&lt;-</span> ames <span class="sc">|&gt;</span> <span class="fu">mutate</span>(<span class="at">Sale_Price =</span> <span class="fu">log10</span>(Sale_Price))</span>
<span id="cb22-2"><a href=""></a>ames_rec <span class="ot">&lt;-</span> <span class="fu">recipe</span>(Sale_Price <span class="sc">~</span> ., <span class="at">data=</span>ames) <span class="sc">|&gt;</span> </span>
<span id="cb22-3"><a href=""></a>  <span class="fu">step_normalize</span>(<span class="fu">all_numeric</span>(), <span class="sc">-</span><span class="fu">all_outcomes</span>()) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div class="footer">

</div>
</section>
<section class="slide level2">

<div class="small">
<p>Pre-training</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href=""></a><span class="fu">library</span>(tabnet)</span>
<span id="cb23-2"><a href=""></a>ames_pretrain <span class="ot">&lt;-</span> <span class="fu">tabnet_pretrain</span>(</span>
<span id="cb23-3"><a href=""></a>  ames_rec, <span class="at">data=</span>ames,  <span class="at">epoch=</span><span class="dv">50</span>, <span class="at">cat_emb_dim =</span> <span class="dv">1</span>,</span>
<span id="cb23-4"><a href=""></a>  <span class="at">valid_split =</span> <span class="fl">0.2</span>, <span class="at">verbose=</span><span class="cn">TRUE</span>, </span>
<span id="cb23-5"><a href=""></a>  <span class="at">early_stopping_patience =</span> <span class="dv">3</span>L, </span>
<span id="cb23-6"><a href=""></a>  <span class="at">early_stopping_tolerance =</span> <span class="fl">1e-4</span></span>
<span id="cb23-7"><a href=""></a>)</span>
<span id="cb23-8"><a href=""></a><span class="co"># model diagnostic</span></span>
<span id="cb23-9"><a href=""></a><span class="fu">autoplot</span>(ames_pretrain)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure>
<p><a href="index_files/figure-revealjs/tabnet%20pretrain-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-13"><img data-src="index_files/figure-revealjs/tabnet%20pretrain-1.png" width="960"></a></p>
</figure>
</div>
</div>
</div>
</div>
</section>
<section class="slide level2">

<div class="small">
<p>Training</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href=""></a>ames_fit <span class="ot">&lt;-</span> <span class="fu">tabnet_fit</span>(ames_rec, <span class="at">data=</span>ames,  <span class="at">tabnet_model =</span> ames_pretrain, </span>
<span id="cb24-2"><a href=""></a>                       <span class="at">epoch=</span><span class="dv">50</span>, <span class="at">cat_emb_dim =</span> <span class="dv">1</span>, </span>
<span id="cb24-3"><a href=""></a>                       <span class="at">valid_split =</span> <span class="fl">0.2</span>, <span class="at">verbose=</span><span class="cn">TRUE</span>, <span class="at">batch=</span><span class="dv">2930</span>)</span>
<span id="cb24-4"><a href=""></a><span class="co"># model diagnostic</span></span>
<span id="cb24-5"><a href=""></a><span class="fu">autoplot</span>(ames_fit)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure>
<p><a href="index_files/figure-revealjs/tabnet%20fit-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-14"><img data-src="index_files/figure-revealjs/tabnet%20fit-1.png" width="960"></a></p>
</figure>
</div>
</div>
</div>
</div>
</section>
<section class="slide level2">

<div class="small">
<p>Prediction</p>
<div class="columns">
<div class="column" style="width:35%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href=""></a><span class="fu">predict</span>(ames_fit, ames)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2,930 × 1
   .pred
   &lt;dbl&gt;
 1  4.68
 2  4.35
 3  4.66
 4  4.19
 5  4.41
 6  4.48
 7  5.01
 8  4.80
 9  4.82
10  4.38
# ℹ 2,920 more rows</code></pre>
</div>
</div>
</div><div class="column" style="width:65%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href=""></a>metrics <span class="ot">&lt;-</span> <span class="fu">metric_set</span>(rmse, rsq, ccc)</span>
<span id="cb27-2"><a href=""></a><span class="fu">cbind</span>(ames, <span class="fu">predict</span>(ames_fit, ames)) <span class="sc">|&gt;</span> </span>
<span id="cb27-3"><a href=""></a>  <span class="fu">metrics</span>(Sale_Price, <span class="at">estimate =</span> .pred)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 3
  .metric .estimator .estimate
  &lt;chr&gt;   &lt;chr&gt;          &lt;dbl&gt;
1 rmse    standard      0.881 
2 rsq     standard      0.0754
3 ccc     standard      0.0423</code></pre>
</div>
</div>
</div></div>
</div>
</section>
<section class="slide level2">

<div class="small">
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href=""></a><span class="co"># variable importance</span></span>
<span id="cb29-2"><a href=""></a>vip<span class="sc">::</span><span class="fu">vip</span>(ames_fit)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure>
<p><a href="index_files/figure-revealjs/tabnet%20vip-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-15"><img data-src="index_files/figure-revealjs/tabnet%20vip-1.png" width="960"></a></p>
</figure>
</div>
</div>
</div>
</div>
</section>
<section class="slide level2">

<div class="small">
<p>Explainability</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href=""></a>ames_explain <span class="ot">&lt;-</span> tabnet<span class="sc">::</span><span class="fu">tabnet_explain</span>(ames_fit, ames)</span>
<span id="cb30-2"><a href=""></a><span class="co"># variable importance</span></span>
<span id="cb30-3"><a href=""></a><span class="fu">autoplot</span>(ames_explain, <span class="at">quantile =</span> <span class="fl">0.99</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure>
<p><a href="index_files/figure-revealjs/tabnet%20explain-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-16"><img data-src="index_files/figure-revealjs/tabnet%20explain-1.png" width="960"></a></p>
</figure>
</div>
</div>
</div>
</div>
</section>
<section id="à-vous-de-jouer-exercice-03" class="slide level2">
<h2>À vous de jouer, exercice 03</h2>
<div class="question">
<p>Complete 03_exercise to practice tabnet model training.</p>
</div>
<div class="cell">
<div class="cell-output-display">
<div class="countdown" id="timer_2a8ebdad" data-update-every="1" tabindex="0" style="right:0;bottom:0;">
<div class="countdown-controls"><button class="countdown-bump-down">−</button><button class="countdown-bump-up">+</button></div>
<code class="countdown-time"><span class="countdown-digits minutes">07</span><span class="countdown-digits colon">:</span><span class="countdown-digits seconds">00</span></code>
</div>
</div>
</div>
<div class="footer">

</div>
</section></section>
<section>
<section id="tabnet-pour-les-valeurs-manquantes" class="title-slide slide level1 center">
<h1>{tabnet} pour les valeurs manquantes</h1>

</section>
<section id="retour-sur-le-jeu-de-données-ames" class="slide level2">
<h2>retour sur le jeu de données Ames</h2>
<div class="small">
<ul>
<li><p>les tenseurs ne peuvent pas inclure de valeur manquantes.</p></li>
<li><p><code>ames</code> nous fait le plaisir d’être sans valeur manquante.</p></li>
</ul>
<div class="question">
<p>Quelle est la surface de la piscine quand il n’y a pas de piscine?</p>
</div>
</div>
</section>
<section class="slide level2">

<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href=""></a><span class="fu">data</span>(<span class="st">"ames"</span>, <span class="at">package =</span> <span class="st">"modeldata"</span>)</span>
<span id="cb31-2"><a href=""></a><span class="fu">qplot</span>(ames<span class="sc">$</span>Mas_Vnr_Area)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure>
<p><a href="index_files/figure-revealjs/unnamed-chunk-16-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-17"><img data-src="index_files/figure-revealjs/unnamed-chunk-16-1.png" width="960"></a></p>
</figure>
</div>
</div>
</div>
<div class="question">
<p>Comment le modèle peut-il capturer cette distribution ?</p>
</div>
</section>
<section class="slide level2">

<p>Et si on l’applique à toute les colonnes ?</p>
<div class="small">
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href=""></a>col_with_zero_as_na <span class="ot">&lt;-</span> ames <span class="sc">|&gt;</span>  </span>
<span id="cb32-2"><a href=""></a>  <span class="fu">select</span>(<span class="fu">where</span>(is.numeric)) <span class="sc">|&gt;</span>  </span>
<span id="cb32-3"><a href=""></a>  <span class="fu">select</span>(<span class="fu">matches</span>(<span class="st">"_SF|Area|Misc_Val|[Pp]orch$"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb32-4"><a href=""></a>  <span class="fu">summarise_each</span>(min) <span class="sc">|&gt;</span> </span>
<span id="cb32-5"><a href=""></a>  <span class="fu">select_if</span>(<span class="sc">~</span>.x<span class="sc">==</span><span class="dv">0</span>) <span class="sc">|&gt;</span> </span>
<span id="cb32-6"><a href=""></a>  <span class="fu">names</span>()</span>
<span id="cb32-7"><a href=""></a>ames_missing <span class="ot">&lt;-</span> ames <span class="sc">|&gt;</span><span class="fu">mutate_at</span>(col_with_zero_as_na, na_if, <span class="dv">0</span>) <span class="sc">|&gt;</span> </span>
<span id="cb32-8"><a href=""></a>  <span class="fu">mutate_at</span>(<span class="st">"Alley"</span>, na_if, <span class="st">"No_Alley_Access"</span>)  <span class="sc">|&gt;</span>  </span>
<span id="cb32-9"><a href=""></a>  <span class="fu">mutate_at</span>(<span class="st">"Fence"</span>, na_if, <span class="st">"No_Fence"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb32-10"><a href=""></a>  <span class="fu">mutate_at</span>(<span class="fu">c</span>(<span class="st">"Garage_Cond"</span>, <span class="st">"Garage_Finish"</span>), na_if, <span class="st">"No_Garage"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb32-11"><a href=""></a>  <span class="fu">mutate_at</span>(<span class="fu">c</span>(<span class="st">"Bsmt_Exposure"</span>, <span class="st">"BsmtFin_Type_1"</span>, <span class="st">"BsmtFin_Type_2"</span>), na_if, <span class="st">"No_Basement"</span>)</span>
<span id="cb32-12"><a href=""></a></span>
<span id="cb32-13"><a href=""></a>visdat<span class="sc">::</span><span class="fu">vis_miss</span>(ames_missing)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure>
<p><a href="index_files/figure-revealjs/tabnet%20missing%20dataset-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-18"><img data-src="index_files/figure-revealjs/tabnet%20missing%20dataset-1.png" width="960"></a></p>
</figure>
</div>
</div>
</div>
</div>
</section>
<section class="slide level2">

<div class="small">
<p>Recipe</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href=""></a>ames_missing <span class="ot">&lt;-</span> ames_missing <span class="sc">|&gt;</span> <span class="fu">mutate</span>(<span class="at">Sale_Price =</span> <span class="fu">log10</span>(Sale_Price))</span>
<span id="cb33-2"><a href=""></a>ames_missing_rec <span class="ot">&lt;-</span> <span class="fu">recipe</span>(Sale_Price <span class="sc">~</span> ., <span class="at">data=</span>ames_missing) <span class="sc">|&gt;</span> </span>
<span id="cb33-3"><a href=""></a>  <span class="fu">step_normalize</span>(<span class="fu">all_numeric</span>(), <span class="sc">-</span><span class="fu">all_outcomes</span>()) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Pre-training</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href=""></a><span class="fu">library</span>(tabnet)</span>
<span id="cb34-2"><a href=""></a>ames_missing_pretrain <span class="ot">&lt;-</span> <span class="fu">tabnet_pretrain</span>(</span>
<span id="cb34-3"><a href=""></a>  ames_missing_rec, <span class="at">data=</span>ames_missing,  <span class="at">epoch=</span><span class="dv">50</span>, <span class="at">cat_emb_dim =</span> <span class="dv">1</span>,  <span class="at">valid_split =</span> <span class="fl">0.2</span>,</span>
<span id="cb34-4"><a href=""></a>  <span class="at">verbose=</span><span class="cn">TRUE</span>,   <span class="at">early_stopping_patience =</span> <span class="dv">3</span>L,   <span class="at">early_stopping_tolerance =</span> <span class="fl">1e-4</span></span>
<span id="cb34-5"><a href=""></a>)</span>
<span id="cb34-6"><a href=""></a><span class="co"># model diagnostic</span></span>
<span id="cb34-7"><a href=""></a><span class="fu">autoplot</span>(ames_missing_pretrain)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure>
<p><a href="index_files/figure-revealjs/tabnet%20missing%20pretrain-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-19"><img data-src="index_files/figure-revealjs/tabnet%20missing%20pretrain-1.png" width="960"></a></p>
</figure>
</div>
</div>
</div>
</div>
</section>
<section class="slide level2">

<div class="small">
<p>Training</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href=""></a>ames_missing_fit <span class="ot">&lt;-</span> <span class="fu">tabnet_fit</span>(</span>
<span id="cb35-2"><a href=""></a>  ames_missing_rec,   <span class="at">data =</span> ames_missing,</span>
<span id="cb35-3"><a href=""></a>  <span class="at">tabnet_model =</span> ames_missing_pretrain,</span>
<span id="cb35-4"><a href=""></a>  <span class="at">epoch =</span> <span class="dv">50</span>,  <span class="at">cat_emb_dim =</span> <span class="dv">1</span>,  <span class="at">valid_split =</span> <span class="fl">0.2</span>,</span>
<span id="cb35-5"><a href=""></a>  <span class="at">verbose =</span> <span class="cn">TRUE</span>,  <span class="at">batch =</span> <span class="dv">2930</span>,</span>
<span id="cb35-6"><a href=""></a>  <span class="at">early_stopping_patience =</span> <span class="dv">5</span>L,</span>
<span id="cb35-7"><a href=""></a>  <span class="at">early_stopping_tolerance =</span> <span class="fl">1e-4</span></span>
<span id="cb35-8"><a href=""></a>)</span>
<span id="cb35-9"><a href=""></a><span class="co"># model diagnostic</span></span>
<span id="cb35-10"><a href=""></a><span class="fu">autoplot</span>(ames_missing_fit)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure>
<p><a href="index_files/figure-revealjs/tabnet%20missing%20fit-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-20"><img data-src="index_files/figure-revealjs/tabnet%20missing%20fit-1.png" width="960"></a></p>
</figure>
</div>
</div>
</div>
</div>
</section>
<section class="slide level2">

<div class="small">
<p>Prediction</p>
<div class="columns">
<div class="column" style="width:30%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href=""></a><span class="fu">predict</span>(ames_missing_fit, ames_missing)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2,930 × 1
   .pred
   &lt;dbl&gt;
 1  5.36
 2  3.49
 3  4.07
 4  5.48
 5  3.99
 6  4.26
 7  4.81
 8  5.33
 9  5.82
10  3.72
# ℹ 2,920 more rows</code></pre>
</div>
</div>
</div><div class="column" style="width:70%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href=""></a>metrics <span class="ot">&lt;-</span> <span class="fu">metric_set</span>(rmse, rsq, ccc)</span>
<span id="cb38-2"><a href=""></a><span class="fu">cbind</span>(ames_missing, <span class="fu">predict</span>(ames_missing_fit, ames_missing)) <span class="sc">|&gt;</span> </span>
<span id="cb38-3"><a href=""></a>  <span class="fu">metrics</span>(Sale_Price, <span class="at">estimate =</span> .pred)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 3
  .metric .estimator .estimate
  &lt;chr&gt;   &lt;chr&gt;          &lt;dbl&gt;
1 rmse    standard      1.04  
2 rsq     standard      0.0118
3 ccc     standard      0.0222</code></pre>
</div>
</div>
</div></div>
</div>
</section>
<section class="slide level2">

<div class="small">
<p>Variable importance</p>
<div class="columns">
<div class="column" style="width:50%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href=""></a><span class="co"># original ames</span></span>
<span id="cb40-2"><a href=""></a><span class="fu">vip_color</span>(ames_pretrain, col_with_missings)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure>
<p><a href="index_files/figure-revealjs/tabnet%20pretrain%20vip%20color-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-21"><img data-src="index_files/figure-revealjs/tabnet%20pretrain%20vip%20color-1.png" width="960"></a></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href=""></a><span class="fu">vip_color</span>(ames_fit, col_with_missings)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure>
<p><a href="index_files/figure-revealjs/tabnet%20pretrain%20vip%20color-2.png" class="lightbox" data-gallery="quarto-lightbox-gallery-22"><img data-src="index_files/figure-revealjs/tabnet%20pretrain%20vip%20color-2.png" width="960"></a></p>
</figure>
</div>
</div>
</div>
</div><div class="column" style="width:50%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href=""></a><span class="co"># ames with missing values</span></span>
<span id="cb42-2"><a href=""></a><span class="fu">vip_color</span>(ames_missing_pretrain, col_with_missings)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure>
<p><a href="index_files/figure-revealjs/tabnet%20pretrain%20missing%20vip%20color-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-23"><img data-src="index_files/figure-revealjs/tabnet%20pretrain%20missing%20vip%20color-1.png" width="960"></a></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href=""></a><span class="fu">vip_color</span>(ames_missing_fit, col_with_missings)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure>
<p><a href="index_files/figure-revealjs/tabnet%20pretrain%20missing%20vip%20color-2.png" class="lightbox" data-gallery="quarto-lightbox-gallery-24"><img data-src="index_files/figure-revealjs/tabnet%20pretrain%20missing%20vip%20color-2.png" width="960"></a></p>
</figure>
</div>
</div>
</div>
</div></div>
</div>
</section>
<section class="slide level2">

<div class="small">
<p>Explainability</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href=""></a>ames_missing_explain <span class="ot">&lt;-</span> tabnet<span class="sc">::</span><span class="fu">tabnet_explain</span>(ames_missing_fit, ames_missing)</span>
<span id="cb44-2"><a href=""></a><span class="co"># variable importance</span></span>
<span id="cb44-3"><a href=""></a><span class="fu">autoplot</span>(ames_missing_explain, <span class="at">quantile =</span> <span class="fl">0.99</span>, <span class="at">type=</span><span class="st">"step"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure>
<p><a href="index_files/figure-revealjs/tabnet%20missing%20explain-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-25"><img data-src="index_files/figure-revealjs/tabnet%20missing%20explain-1.png" width="960"></a></p>
</figure>
</div>
</div>
</div>
</div>
</section></section>
<section>
<section id="tabnet-avec-un-outcome-hiérarchique" class="title-slide slide level1 center">
<h1>{tabnet} avec un <code>outcome()</code> hiérarchique</h1>

</section>
<section class="slide level2">

<ul>
<li><p>{tabnet} admet des variable à prédire catégorielle, multi-label multi-class.</p></li>
<li><p>et si on pouvait mettre une contrainte entre les classes des différents labels ?</p></li>
<li><p>le dataset doit être de type <code>data.tree::as.Node()</code></p>
<ul>
<li>conversion de trainset et testset avec <code>as.Node()</code> avant les fonctions <code>tabnet_</code></li>
<li>conversion de inverse avec <code>node_to_df()</code></li>
</ul></li>
<li><p>nouveauté de la 0.5.0</p></li>
</ul>
</section>
<section id="exemple-avec-starwars" class="slide level2">
<h2>Exemple avec <code>starwars</code></h2>
<div class="small">
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href=""></a><span class="fu">library</span>(data.tree)</span>
<span id="cb45-2"><a href=""></a><span class="fu">data</span>(starwars, <span class="at">package =</span> <span class="st">"dplyr"</span>)</span>
<span id="cb45-3"><a href=""></a><span class="fu">head</span>(starwars, <span class="dv">4</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 14
  name      height  mass hair_color skin_color eye_color birth_year sex   gender
  &lt;chr&gt;      &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt;      &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt; 
1 Luke Sky…    172    77 blond      fair       blue            19   male  mascu…
2 C-3PO        167    75 &lt;NA&gt;       gold       yellow         112   none  mascu…
3 R2-D2         96    32 &lt;NA&gt;       white, bl… red             33   none  mascu…
4 Darth Va…    202   136 none       white      yellow          41.9 male  mascu…
# ℹ 5 more variables: homeworld &lt;chr&gt;, species &lt;chr&gt;, films &lt;list&gt;,
#   vehicles &lt;list&gt;, starships &lt;list&gt;</code></pre>
</div>
</div>
</div>
</section>
<section class="slide level2">

<div class="smaller">
<p>On construit la variable de sortie comme un chaîne avec des séparateurs <code>/</code> dans une variable <code>"pathString"</code> (erronné)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href=""></a>starwars_tree <span class="ot">&lt;-</span> starwars <span class="sc">|&gt;</span> </span>
<span id="cb47-2"><a href=""></a>  <span class="fu">mutate</span>(<span class="at">pathString =</span> <span class="fu">paste</span>(<span class="st">"StarWars_characters"</span>, species, sex, <span class="st">`</span><span class="at">name</span><span class="st">`</span>, <span class="at">sep =</span> <span class="st">"/"</span>))  <span class="sc">|&gt;</span> </span>
<span id="cb47-3"><a href=""></a>  <span class="fu">as.Node</span>()</span>
<span id="cb47-4"><a href=""></a><span class="fu">print</span>(starwars_tree, <span class="st">"name"</span>,<span class="st">"height"</span>, <span class="st">"mass"</span>, <span class="st">"eye_color"</span>, <span class="at">limit =</span> <span class="dv">8</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                           levelName                    name height mass
1  StarWars_characters                   StarWars_characters      4   NA
2   ¦--Human                                           Human      3   NA
3   ¦   ¦--male                                         male      2   NA
4   ¦   ¦   ¦--Luke Skywalker                 Luke Skywalker      1   77
5   ¦   ¦   ¦--Darth Vader                       Darth Vader      1  136
6   ¦   ¦   ¦--Owen Lars                           Owen Lars      1  120
7   ¦   ¦   ¦--Biggs Darklighter           Biggs Darklighter      1   84
8   ¦   ¦   °--... 22 nodes w/ 0 sub   ... 22 nodes w/ 0 sub      1   NA
9   ¦   °--... 1 nodes w/ 31 sub       ... 1 nodes w/ 31 sub      1   NA
10  °--... 37 nodes w/ 123 sub       ... 37 nodes w/ 123 sub      1   NA
   eye_color
1           
2           
3           
4       blue
5     yellow
6       blue
7      brown
8           
9           
10          </code></pre>
</div>
</div>
</div>
</section>
<section id="mais-avec-des-règles-sur-les-noms-et-les-types" class="slide level2">
<h2>Mais avec des règles sur les noms et les types</h2>
<div class="small">
<ul>
<li>pas d’usage des noms internes de {data.tree} :
<ul>
<li><code>name</code>, <code>height</code> sont interdits</li>
<li>comme tous les noms de <code>NODE_RESERVED_NAMES_CONST</code>. (Ils seraient supprimés au moment de la conversion.)</li>
</ul></li>
<li>pas de <code>factor()</code></li>
<li>pas de colonne nommée <code>level_*</code></li>
<li>le dernier niveau hiérarchique doit être l’individu (donc un Id unique)</li>
<li>il doit y avoir une racine à la hiérarchie</li>
</ul>
</div>
</section>
<section id="construction-correcte-de-la-variable-de-sortie-pathstring" class="slide level2">
<h2>Construction correcte de la variable de sortie <code>"pathString"</code></h2>
<div class="smaller">
<div class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href=""></a>starwars_tree <span class="ot">&lt;-</span> starwars <span class="sc">|&gt;</span></span>
<span id="cb49-2"><a href=""></a>  <span class="fu">rename</span>(<span class="st">`</span><span class="at">_name</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"name"</span>, <span class="st">`</span><span class="at">_height</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"height"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb49-3"><a href=""></a>  <span class="fu">mutate</span>(<span class="at">pathString =</span> <span class="fu">paste</span>(<span class="st">"StarWars_characters"</span>, species, sex, <span class="st">`</span><span class="at">_name</span><span class="st">`</span>, <span class="at">sep =</span> <span class="st">"/"</span>))  <span class="sc">|&gt;</span> </span>
<span id="cb49-4"><a href=""></a>  <span class="fu">as.Node</span>()</span>
<span id="cb49-5"><a href=""></a><span class="fu">print</span>(starwars_tree, <span class="st">"name"</span>, <span class="st">"_name"</span>,<span class="st">"_height"</span>, <span class="st">"mass"</span>, <span class="st">"eye_color"</span>, <span class="at">limit =</span> <span class="dv">8</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                           levelName                    name             _name
1  StarWars_characters                   StarWars_characters                  
2   ¦--Human                                           Human                  
3   ¦   ¦--male                                         male                  
4   ¦   ¦   ¦--Luke Skywalker                 Luke Skywalker    Luke Skywalker
5   ¦   ¦   ¦--Darth Vader                       Darth Vader       Darth Vader
6   ¦   ¦   ¦--Owen Lars                           Owen Lars         Owen Lars
7   ¦   ¦   ¦--Biggs Darklighter           Biggs Darklighter Biggs Darklighter
8   ¦   ¦   °--... 22 nodes w/ 0 sub   ... 22 nodes w/ 0 sub                  
9   ¦   °--... 1 nodes w/ 31 sub       ... 1 nodes w/ 31 sub                  
10  °--... 37 nodes w/ 123 sub       ... 37 nodes w/ 123 sub                  
   _height mass eye_color
1       NA   NA          
2       NA   NA          
3       NA   NA          
4      172   77      blue
5      202  136    yellow
6      178  120      blue
7      183   84     brown
8       NA   NA          
9       NA   NA          
10      NA   NA          </code></pre>
</div>
</div>
</div>
</section>
<section id="initial-split-et-construction" class="slide level2">
<h2>Initial split et construction</h2>
<p><code>starwars</code> a des colonnes de <code>list()</code> qu’il faut dérouler</p>
<div class="small">
<div class="cell">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href=""></a>starw_split <span class="ot">&lt;-</span> starwars <span class="sc">|&gt;</span> </span>
<span id="cb51-2"><a href=""></a>  tidyr<span class="sc">::</span><span class="fu">unnest_longer</span>(films) <span class="sc">|&gt;</span> </span>
<span id="cb51-3"><a href=""></a>  tidyr<span class="sc">::</span><span class="fu">unnest_longer</span>(vehicles, <span class="at">keep_empty =</span> <span class="cn">TRUE</span>) <span class="sc">|&gt;</span> </span>
<span id="cb51-4"><a href=""></a>  tidyr<span class="sc">::</span><span class="fu">unnest_longer</span>(starships, <span class="at">keep_empty =</span> <span class="cn">TRUE</span>) <span class="sc">|&gt;</span> </span>
<span id="cb51-5"><a href=""></a>  <span class="fu">initial_split</span>( <span class="at">prop =</span> .<span class="dv">8</span>, <span class="at">strata =</span> <span class="st">"species"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</section>
<section class="slide level2">

<div class="small">
<div class="cell">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href=""></a>starwars_train_tree <span class="ot">&lt;-</span> starw_split <span class="sc">|&gt;</span> </span>
<span id="cb52-2"><a href=""></a>  <span class="fu">training</span>() <span class="sc">|&gt;</span></span>
<span id="cb52-3"><a href=""></a>  <span class="fu">rename</span>(<span class="st">`</span><span class="at">_name</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"name"</span>, <span class="st">`</span><span class="at">_height</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"height"</span>) <span class="sc">|&gt;</span></span>
<span id="cb52-4"><a href=""></a>  <span class="fu">rowid_to_column</span>() <span class="sc">|&gt;</span></span>
<span id="cb52-5"><a href=""></a>  <span class="fu">mutate</span>(<span class="at">pathString =</span> <span class="fu">paste</span>(<span class="st">"StarWars_characters"</span>, species, sex, rowid, <span class="at">sep =</span> <span class="st">"/"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb52-6"><a href=""></a>  <span class="co"># remove outcomes labels from predictors</span></span>
<span id="cb52-7"><a href=""></a>  <span class="fu">select</span>(<span class="sc">-</span>species, <span class="sc">-</span>sex, <span class="sc">-</span><span class="st">`</span><span class="at">_name</span><span class="st">`</span>, <span class="sc">-</span>rowid) <span class="sc">|&gt;</span></span>
<span id="cb52-8"><a href=""></a>  <span class="co"># turn it as hierarchical Node</span></span>
<span id="cb52-9"><a href=""></a>  <span class="fu">as.Node</span>()</span>
<span id="cb52-10"><a href=""></a></span>
<span id="cb52-11"><a href=""></a>starwars_test_tree <span class="ot">&lt;-</span> starw_split <span class="sc">|&gt;</span></span>
<span id="cb52-12"><a href=""></a>  <span class="fu">testing</span>() <span class="sc">|&gt;</span></span>
<span id="cb52-13"><a href=""></a>  <span class="fu">rename</span>(<span class="st">`</span><span class="at">_name</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"name"</span>, <span class="st">`</span><span class="at">_height</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"height"</span>) <span class="sc">|&gt;</span></span>
<span id="cb52-14"><a href=""></a>  <span class="fu">rowid_to_column</span>() <span class="sc">|&gt;</span></span>
<span id="cb52-15"><a href=""></a>  <span class="fu">mutate</span>(<span class="at">pathString =</span> <span class="fu">paste</span>(<span class="st">"StarWars_characters"</span>, species, sex, rowid, <span class="at">sep =</span> <span class="st">"/"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb52-16"><a href=""></a>  <span class="fu">select</span>(<span class="sc">-</span>species, <span class="sc">-</span>sex, <span class="sc">-</span><span class="st">`</span><span class="at">_name</span><span class="st">`</span>, <span class="sc">-</span>rowid) <span class="sc">|&gt;</span></span>
<span id="cb52-17"><a href=""></a>  <span class="fu">as.Node</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Les <code>$attributesAll</code> du Node seront les predicteurs :</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href=""></a>starwars_train_tree<span class="sc">$</span>attributesAll</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "_height"    "birth_year" "eye_color"  "films"      "gender"    
 [6] "hair_color" "homeworld"  "mass"       "skin_color" "starships" 
[11] "vehicles"  </code></pre>
</div>
</div>
</div>
</section>
<section id="entraînement-du-modèle" class="slide level2">
<h2>Entraînement du modèle</h2>
<div class="sourceCode" id="cb55"><pre class="sourceCode numberSource markdown number-lines code-with-copy"><code class="sourceCode markdown"><span id="cb55-1"><a href=""></a><span class="in">```{r}</span></span>
<span id="cb55-2"><a href=""></a><span class="in">#| echo: true</span></span>
<span id="cb55-3"><a href=""></a><span class="in">#| label: "starwars fit"</span></span>
<span id="cb55-4"><a href=""></a></span>
<span id="cb55-5"><a href=""></a><span class="in">config &lt;- tabnet_config(</span></span>
<span id="cb55-6"><a href=""></a><span class="in">  decision_width = 8,</span></span>
<span id="cb55-7"><a href=""></a><span class="in">  attention_width = 8,</span></span>
<span id="cb55-8"><a href=""></a><span class="in">  num_steps = 3,</span></span>
<span id="cb55-9"><a href=""></a><span class="in">  penalty = .003,</span></span>
<span id="cb55-10"><a href=""></a><span class="in">  cat_emb_dim = 2,</span></span>
<span id="cb55-11"><a href=""></a><span class="in">  valid_split = 0.2,</span></span>
<span id="cb55-12"><a href=""></a><span class="in">  learn_rate = 1e-3,</span></span>
<span id="cb55-13"><a href=""></a><span class="in">  lr_scheduler = "reduce_on_plateau",</span></span>
<span id="cb55-14"><a href=""></a><span class="in">  early_stopping_monitor = "valid_loss",</span></span>
<span id="cb55-15"><a href=""></a><span class="in">  early_stopping_patience = 4,</span></span>
<span id="cb55-16"><a href=""></a><span class="in">  verbose = FALSE</span></span>
<span id="cb55-17"><a href=""></a><span class="in">)</span></span>
<span id="cb55-18"><a href=""></a></span>
<span id="cb55-19"><a href=""></a><span class="in">starw_model &lt;- tabnet_fit(starwars_train_tree, config = config, epoch = 75, checkpoint_epochs = 15)</span></span>
<span id="cb55-20"><a href=""></a><span class="in">```</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="diagnostique" class="slide level2">
<h2>Diagnostique</h2>
<div class="sourceCode" id="cb56"><pre class="sourceCode numberSource markdown number-lines code-with-copy"><code class="sourceCode markdown"><span id="cb56-1"><a href=""></a><span class="in">```{r}</span></span>
<span id="cb56-2"><a href=""></a><span class="in">#| echo: true</span></span>
<span id="cb56-3"><a href=""></a><span class="in">#| label: "starwars diag"</span></span>
<span id="cb56-4"><a href=""></a></span>
<span id="cb56-5"><a href=""></a><span class="in">autoplot(starw_model)</span></span>
<span id="cb56-6"><a href=""></a><span class="in">```</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb57"><pre class="sourceCode numberSource markdown number-lines code-with-copy"><code class="sourceCode markdown"><span id="cb57-1"><a href=""></a><span class="in">```{r}</span></span>
<span id="cb57-2"><a href=""></a><span class="in">#| echo: true</span></span>
<span id="cb57-3"><a href=""></a><span class="in">#| label: "starwars vip"</span></span>
<span id="cb57-4"><a href=""></a></span>
<span id="cb57-5"><a href=""></a><span class="in">vip::vip(starw_model)</span></span>
<span id="cb57-6"><a href=""></a><span class="in">```</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="inférence-avec-le-modèle-hiérarchique" class="slide level2">
<h2>Inférence avec le modèle hiérarchique</h2>
<div class="sourceCode" id="cb58"><pre class="sourceCode numberSource markdown number-lines code-with-copy"><code class="sourceCode markdown"><span id="cb58-1"><a href=""></a><span class="in">```{r}</span></span>
<span id="cb58-2"><a href=""></a><span class="in">#| echo: true</span></span>
<span id="cb58-3"><a href=""></a><span class="in">#| label: "starwars inference"</span></span>
<span id="cb58-4"><a href=""></a><span class="in">starwars_hat &lt;- bind_cols(</span></span>
<span id="cb58-5"><a href=""></a><span class="in">    predict(starw_model, starwars_test_tree),</span></span>
<span id="cb58-6"><a href=""></a><span class="in">    node_to_df(starwars_test_tree)$y</span></span>
<span id="cb58-7"><a href=""></a><span class="in">  )</span></span>
<span id="cb58-8"><a href=""></a><span class="in">tail(starwars_hat, n = 5)</span></span>
<span id="cb58-9"><a href=""></a><span class="in">```</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section></section>
<section>
<section id="tabnet-pour-la-classification-binaire-déséquilibrée" class="title-slide slide level1 center">
<h1>{tabnet} pour la classification binaire déséquilibrée</h1>

</section>
<section class="slide level2">

<p>Prenons le jeu de données <code>lending_club</code> du package {modeldata}</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href=""></a><span class="fu">data</span>(<span class="st">"lending_club"</span>, <span class="at">package =</span> <span class="st">"modeldata"</span>)</span>
<span id="cb59-2"><a href=""></a>class_ratio <span class="ot">&lt;-</span> lending_club <span class="sc">|&gt;</span> </span>
<span id="cb59-3"><a href=""></a>  <span class="fu">summarise</span>(<span class="fu">sum</span>( Class <span class="sc">==</span> <span class="st">"good"</span>) <span class="sc">/</span> <span class="fu">sum</span>( Class <span class="sc">==</span> <span class="st">"bad"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb59-4"><a href=""></a>  <span class="fu">pull</span>() </span>
<span id="cb59-5"><a href=""></a></span>
<span id="cb59-6"><a href=""></a>class_ratio</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 18.06576</code></pre>
</div>
</div>
</section>
<section class="slide level2">

<p>Voyons ce que donne tabnet face à XGBoost sur cette tâche</p>
<div class="columns">
<div class="column" style="width:50%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb61" data-code-line-numbers="|4|12"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href=""></a>tab_rec <span class="ot">&lt;-</span> train <span class="sc">|&gt;</span></span>
<span id="cb61-2"><a href=""></a>  <span class="fu">recipe</span>() <span class="sc">|&gt;</span></span>
<span id="cb61-3"><a href=""></a>  <span class="fu">update_role</span>(</span>
<span id="cb61-4"><a href=""></a>    Class, </span>
<span id="cb61-5"><a href=""></a>    <span class="at">new_role =</span> <span class="st">"outcome"</span>) <span class="sc">|&gt;</span></span>
<span id="cb61-6"><a href=""></a>  <span class="fu">update_role</span>(</span>
<span id="cb61-7"><a href=""></a>    <span class="sc">-</span><span class="fu">has_role</span>(<span class="fu">c</span>(<span class="st">"outcome"</span>, <span class="st">"id"</span>, <span class="st">"case_weights"</span>)), </span>
<span id="cb61-8"><a href=""></a>    <span class="at">new_role =</span> <span class="st">"predictor"</span>)</span>
<span id="cb61-9"><a href=""></a></span>
<span id="cb61-10"><a href=""></a>tab_mod <span class="ot">&lt;-</span> <span class="fu">tabnet</span>(<span class="at">epochs =</span> <span class="dv">100</span>, </span>
<span id="cb61-11"><a href=""></a>                  <span class="at">loss =</span> tabnet<span class="sc">::</span>nn_aum_loss, </span>
<span id="cb61-12"><a href=""></a>                  <span class="at">learn_rate =</span> <span class="fl">0.02</span>) <span class="sc">|&gt;</span> </span>
<span id="cb61-13"><a href=""></a>  <span class="fu">set_engine</span>(<span class="st">"torch"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb61-14"><a href=""></a>  <span class="fu">set_mode</span>(<span class="st">"classification"</span>)</span>
<span id="cb61-15"><a href=""></a></span>
<span id="cb61-16"><a href=""></a>tab_wf <span class="ot">&lt;-</span> <span class="fu">workflow</span>() <span class="sc">|&gt;</span> </span>
<span id="cb61-17"><a href=""></a>  <span class="fu">add_model</span>(tab_mod) <span class="sc">|&gt;</span> </span>
<span id="cb61-18"><a href=""></a>  <span class="fu">add_recipe</span>(tab_rec) <span class="sc">|&gt;</span> </span>
<span id="cb61-19"><a href=""></a>  <span class="fu">add_case_weights</span>(case_wts)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div><div class="column" style="width:50%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb62" data-code-line-numbers="|11"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href=""></a>xgb_rec <span class="ot">&lt;-</span> tab_rec <span class="sc">|&gt;</span> </span>
<span id="cb62-2"><a href=""></a>  <span class="fu">step_dummy</span>(term, sub_grade, addr_state, verification_status, emp_length)</span>
<span id="cb62-3"><a href=""></a></span>
<span id="cb62-4"><a href=""></a>xgb_mod <span class="ot">&lt;-</span> <span class="fu">boost_tree</span>(<span class="at">trees =</span> <span class="dv">100</span>, <span class="at">tree_depth =</span> <span class="dv">10</span>, <span class="at">learn_rate =</span> <span class="fl">0.1</span>, <span class="at">mtry =</span> <span class="dv">1</span>, <span class="at">sample_size =</span> <span class="fl">0.8</span>) <span class="sc">|&gt;</span> </span>
<span id="cb62-5"><a href=""></a>  <span class="fu">set_engine</span>(<span class="st">"xgboost"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb62-6"><a href=""></a>  <span class="fu">set_mode</span>(<span class="st">"classification"</span>)</span>
<span id="cb62-7"><a href=""></a></span>
<span id="cb62-8"><a href=""></a>xgb_wf <span class="ot">&lt;-</span> <span class="fu">workflow</span>() <span class="sc">|&gt;</span> </span>
<span id="cb62-9"><a href=""></a>  <span class="fu">add_model</span>(xgb_mod) <span class="sc">|&gt;</span> </span>
<span id="cb62-10"><a href=""></a>  <span class="fu">add_recipe</span>(xgb_rec) <span class="sc">|&gt;</span> </span>
<span id="cb62-11"><a href=""></a>  <span class="fu">add_case_weights</span>(case_wts)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div></div>
<p>:::</p>
</section>
<section class="slide level2">

<div class="columns">
<div class="column small" style="width:33%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href=""></a>tab_fit <span class="ot">&lt;-</span> tab_wf <span class="sc">|&gt;</span></span>
<span id="cb63-2"><a href=""></a>  <span class="fu">fit</span>(train)</span>
<span id="cb63-3"><a href=""></a></span>
<span id="cb63-4"><a href=""></a>tab_test <span class="ot">&lt;-</span> tab_fit <span class="sc">|&gt;</span></span>
<span id="cb63-5"><a href=""></a>  <span class="fu">augment</span>(test)</span>
<span id="cb63-6"><a href=""></a></span>
<span id="cb63-7"><a href=""></a>tab_test <span class="sc">|&gt;</span> </span>
<span id="cb63-8"><a href=""></a>  <span class="fu">pr_curve</span>(</span>
<span id="cb63-9"><a href=""></a>    Class, .pred_good, </span>
<span id="cb63-10"><a href=""></a>    <span class="at">case_weights =</span> case_wts) <span class="sc">|&gt;</span> </span>
<span id="cb63-11"><a href=""></a>  <span class="fu">autoplot</span>() </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><a href="index_files/figure-revealjs/tabnet%20lending%20fit-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-26" title="Tabnet, avec pondération, perte ROC_AUM"><img data-src="index_files/figure-revealjs/tabnet%20lending%20fit-1.png" width="480" alt="Tabnet, avec pondération, perte ROC_AUM"></a></p>
<figcaption>Tabnet, avec pondération, perte ROC_AUM</figcaption>
</figure>
</div>
</div>
</div>
</div><div class="column small" style="width:33%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href=""></a>tab_fit_bce <span class="ot">&lt;-</span> tab_wf_bce <span class="sc">|&gt;</span></span>
<span id="cb64-2"><a href=""></a>  <span class="fu">fit</span>(train)</span>
<span id="cb64-3"><a href=""></a></span>
<span id="cb64-4"><a href=""></a>tab_test <span class="ot">&lt;-</span> tab_fit_bce <span class="sc">|&gt;</span></span>
<span id="cb64-5"><a href=""></a>  <span class="fu">augment</span>(test)</span>
<span id="cb64-6"><a href=""></a></span>
<span id="cb64-7"><a href=""></a>tab_test <span class="sc">|&gt;</span> </span>
<span id="cb64-8"><a href=""></a>  <span class="fu">pr_curve</span>(</span>
<span id="cb64-9"><a href=""></a>    Class, .pred_good, </span>
<span id="cb64-10"><a href=""></a>    <span class="at">case_weights =</span> case_wts) <span class="sc">|&gt;</span> </span>
<span id="cb64-11"><a href=""></a>  <span class="fu">autoplot</span>() </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><a href="index_files/figure-revealjs/tabnet%20lending%20fit%20bce-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-27" title="Tabnet, avec pondération, perte BCE"><img data-src="index_files/figure-revealjs/tabnet%20lending%20fit%20bce-1.png" width="480" alt="Tabnet, avec pondération, perte BCE"></a></p>
<figcaption>Tabnet, avec pondération, perte BCE</figcaption>
</figure>
</div>
</div>
</div>
</div><div class="column" style="width:30%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href=""></a>xgb_fit <span class="ot">&lt;-</span> xgb_wf <span class="sc">|&gt;</span></span>
<span id="cb65-2"><a href=""></a>  <span class="fu">fit</span>(train)</span>
<span id="cb65-3"><a href=""></a></span>
<span id="cb65-4"><a href=""></a>xgb_test <span class="ot">&lt;-</span> xgb_fit <span class="sc">|&gt;</span></span>
<span id="cb65-5"><a href=""></a>  <span class="fu">augment</span>(test)</span>
<span id="cb65-6"><a href=""></a></span>
<span id="cb65-7"><a href=""></a>xgb_test <span class="sc">|&gt;</span></span>
<span id="cb65-8"><a href=""></a>  <span class="fu">pr_curve</span>(</span>
<span id="cb65-9"><a href=""></a>    Class, .pred_good,</span>
<span id="cb65-10"><a href=""></a>    <span class="at">case_weights =</span> case_wts) <span class="sc">|&gt;</span></span>
<span id="cb65-11"><a href=""></a>  <span class="fu">autoplot</span>() </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><a href="index_files/figure-revealjs/xgboost%20lending%20fit-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-28" title="XGBoost, avec pondération"><img data-src="index_files/figure-revealjs/xgboost%20lending%20fit-1.png" width="480" alt="XGBoost, avec pondération"></a></p>
<figcaption>XGBoost, avec pondération</figcaption>
</figure>
</div>
</div>
</div>
</div></div>
</section></section>
<section>
<section id="gpt2-avec-r" class="title-slide slide level1 center">
<h1>GPT2 avec R</h1>
<p>basé sur 4 packages {minhub}, {hfhub}, {tok}, {safetensors}</p>
<ul>
<li>{minhub} : un dépot de <strong>réseau de neurones</strong> classiques pour {torch}</li>
<li>{hfhub} : l’accès aux téléchargement de <strong>modèles</strong> préentraînés du hub hugging-face</li>
<li>{tok} : un wrappeur des tokenizers d’huggingface en R</li>
<li>{safetensors} : sauvegarde et lecture des données de tenseurs au format <code>.safetensors</code></li>
</ul>
</section>
<section id="téléchargement-du-modèle-et-de-ses-poids" class="slide level2">
<h2>Téléchargement du modèle et de ses poids</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href=""></a><span class="fu">library</span>(minhub)</span>
<span id="cb66-2"><a href=""></a><span class="fu">library</span>(zeallot)</span>
<span id="cb66-3"><a href=""></a></span>
<span id="cb66-4"><a href=""></a>identifier <span class="ot">&lt;-</span> <span class="st">"gpt2"</span></span>
<span id="cb66-5"><a href=""></a>revision <span class="ot">&lt;-</span> <span class="st">"e7da7f2"</span></span>
<span id="cb66-6"><a href=""></a><span class="co"># instantiate model and load Hugging Face weights</span></span>
<span id="cb66-7"><a href=""></a>model <span class="ot">&lt;-</span> <span class="fu">gpt2_from_pretrained</span>(identifier, revision)</span>
<span id="cb66-8"><a href=""></a><span class="co"># load matching tokenizer</span></span>
<span id="cb66-9"><a href=""></a>tok <span class="ot">&lt;-</span> tok<span class="sc">::</span>tokenizer<span class="sc">$</span><span class="fu">from_pretrained</span>(identifier,)</span>
<span id="cb66-10"><a href=""></a>model<span class="sc">$</span><span class="fu">eval</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="tokenisation-de-la-phrase" class="slide level2">
<h2>Tokenisation de la phrase</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href=""></a>text <span class="ot">=</span> <span class="fu">paste</span>(<span class="st">"✨ Quel plaisir de participer aux Rencontres R 2025 à Mons !✨"</span>,</span>
<span id="cb67-2"><a href=""></a>             <span class="st">"Vivement la prochaine"</span> )</span>
<span id="cb67-3"><a href=""></a></span>
<span id="cb67-4"><a href=""></a>idx <span class="ot">&lt;-</span> <span class="fu">torch_tensor</span>(tok<span class="sc">$</span><span class="fu">encode</span>(text)<span class="sc">$</span>ids)<span class="sc">$</span><span class="fu">view</span>(<span class="fu">c</span>(<span class="dv">1</span>, <span class="sc">-</span><span class="dv">1</span>))</span>
<span id="cb67-5"><a href=""></a>idx</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>torch_tensor
Columns 1 to 11 26486    101   2264    417    458  15152    343    390   1344   9346  27506

Columns 12 to 22  7152   3642    411    371  32190  28141  19853   5145  26486    101  29237

Columns 23 to 27   434   8591    386    354   5718
[ CPULongType{1,27} ]</code></pre>
</div>
</div>
</section>
<section id="génération-dune-entrée" class="slide level2">
<h2>Génération d’une entrée</h2>
<p>La génération est un process itératif, chaque prédiction du modèle est ajoutée au prompt qui grossit.</p>
<p>Ajoutons y 30 tokens :</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href=""></a>prompt_length <span class="ot">&lt;-</span> idx<span class="sc">$</span><span class="fu">size</span>(<span class="sc">-</span><span class="dv">1</span>)</span>
<span id="cb69-2"><a href=""></a></span>
<span id="cb69-3"><a href=""></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">30</span>) { <span class="co"># decide on maximal length of output sequence</span></span>
<span id="cb69-4"><a href=""></a>  <span class="co"># obtain next prediction (raw score)</span></span>
<span id="cb69-5"><a href=""></a>  <span class="fu">with_no_grad</span>({</span>
<span id="cb69-6"><a href=""></a>    logits <span class="ot">&lt;-</span> <span class="fu">model</span>(idx <span class="sc">+</span> <span class="dv">1</span>L)</span>
<span id="cb69-7"><a href=""></a>  })</span>
<span id="cb69-8"><a href=""></a>  last_logits <span class="ot">&lt;-</span> logits[, <span class="sc">-</span><span class="dv">1</span>, ]</span>
<span id="cb69-9"><a href=""></a>  <span class="co"># pick highest scores (how many is up to you)</span></span>
<span id="cb69-10"><a href=""></a>  <span class="fu">c</span>(prob, ind) <span class="sc">%&lt;-%</span> last_logits<span class="sc">$</span><span class="fu">topk</span>(<span class="dv">50</span>)</span>
<span id="cb69-11"><a href=""></a>  last_logits <span class="ot">&lt;-</span> <span class="fu">torch_full_like</span>(last_logits, <span class="sc">-</span><span class="cn">Inf</span>)<span class="sc">$</span><span class="fu">scatter_</span>(<span class="sc">-</span><span class="dv">1</span>, ind, prob)</span>
<span id="cb69-12"><a href=""></a>  <span class="co"># convert to probabilities</span></span>
<span id="cb69-13"><a href=""></a>  probs <span class="ot">&lt;-</span> <span class="fu">nnf_softmax</span>(last_logits, <span class="at">dim =</span> <span class="sc">-</span><span class="dv">1</span>)</span>
<span id="cb69-14"><a href=""></a>  <span class="co"># probabilistic sampling</span></span>
<span id="cb69-15"><a href=""></a>  id_next <span class="ot">&lt;-</span> <span class="fu">torch_multinomial</span>(probs, <span class="at">num_samples =</span> <span class="dv">1</span>) <span class="sc">-</span> <span class="dv">1</span>L</span>
<span id="cb69-16"><a href=""></a>  <span class="co"># stop if end of sequence predicted</span></span>
<span id="cb69-17"><a href=""></a>  <span class="cf">if</span> (id_next<span class="sc">$</span><span class="fu">item</span>() <span class="sc">==</span> <span class="dv">0</span>) {</span>
<span id="cb69-18"><a href=""></a>    <span class="cf">break</span></span>
<span id="cb69-19"><a href=""></a>  }</span>
<span id="cb69-20"><a href=""></a>  <span class="co"># append prediction to prompt</span></span>
<span id="cb69-21"><a href=""></a>  idx <span class="ot">&lt;-</span> <span class="fu">torch_cat</span>(<span class="fu">list</span>(idx, id_next), <span class="at">dim =</span> <span class="dv">2</span>)</span>
<span id="cb69-22"><a href=""></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="décodage-des-tokens-du-résultat" class="slide level2">
<h2>décodage des tokens du résultat</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href=""></a>tok<span class="sc">$</span><span class="fu">decode</span>(<span class="fu">as.integer</span>(idx))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "✨ Quel plaisir de participer aux Rencontres R 2025 à Mons !✨ Vivement la prochaine (the word for \"no matter what he does\") !✨\n\n‍♪‍♪‍♪‍"</code></pre>
</div>
</div>
</section></section>
<section>
<section id="fine-tuning-avec-lora" class="title-slide slide level1 center">
<h1>Fine-Tuning avec LoRA</h1>

</section>
<section id="est-ce-que-les-llms-dépossèdent-le-data-scientist" class="slide level2">
<h2>Est-ce que les LLMs dépossèdent le data-scientist ?</h2>
<ul>
<li><p>des réseaux toujours plus gros impliquent des entraînements prohibitifs</p></li>
<li><p>la promesse de la prochaîne version qui résoudra les faiblesses constatées</p></li>
<li><p>le jeu de donnée de réference difficile à constituer</p></li>
</ul>
</section>
<section id="lora-à-la-rescousse" class="slide level2">
<h2>LoRA à la rescousse</h2>
<p>Low Rank Adaptation</p>
<p><a href="images/lora.png" class="lightbox" data-gallery="quarto-lightbox-gallery-29"><img data-src="images/lora.png"></a></p>
</section>
<section id="method" class="slide level2">
<h2>Method</h2>
<div class="small">
<p>The problem of fine-tuning a neural network can be expressed by finding a <span class="math inline">\(\Delta \Theta\)</span> that minimizes <span class="math inline">\(L(X, y; \Theta_0 + \Delta\Theta)\)</span> where <span class="math inline">\(L\)</span> is a loss function, <span class="math inline">\(X\)</span> and <span class="math inline">\(y\)</span> are the data and <span class="math inline">\(\Theta_0\)</span> the weights from a pre-trained model.</p>
<p>We learn the parameters <span class="math inline">\(\Delta \Theta\)</span> with dimension <span class="math inline">\(|\Delta \Theta|\)</span> equals to <span class="math inline">\(|\Theta_0|\)</span>. When <span class="math inline">\(|\Theta_0|\)</span> is very large, such as in large scale pre-trained models, finding <span class="math inline">\(\Delta \Theta\)</span> becomes computationally challenging. Also, for each task you need to learn a new <span class="math inline">\(\Delta \Theta\)</span> parameter set, making it even more challenging to deploy fine-tuned models if you have more than a few specific tasks. LoRA proposes using an approximation <span class="math inline">\(\Delta \Phi \approx \Delta \Theta\)</span> with <span class="math inline">\(|\Delta \Phi| &lt;&lt; |\Delta \Theta|\)</span>. The observation is that neural nets have many dense layers performing matrix multiplication, and while they typically have full-rank during pre-training, when adapting to a specific task the weight updates will have a low “intrinsic dimension”.</p>
</div>
<div class="footer">
<p>d’après https://blogs.rstudio.com/ai/posts/2023-06-22-understanding-lora/</p>
</div>
</section>
<section class="slide level2">

<div class="small">
<p>A simple matrix decomposition is applied for each weight matrix update <span class="math inline">\(\Delta \theta \in \Delta \Theta\)</span>. Considering <span class="math inline">\(\Delta \theta_i \in \mathbb{R}^{d \times k}\)</span> the update for the <span class="math inline">\(i\)</span>th weight in the network, LoRA approximates it with:</p>
<p><span class="math display">\[\Delta \theta_i  \approx \Delta \phi_i = BA\]</span> where <span class="math inline">\(B \in \mathbb{R}^{d \times r}\)</span>, <span class="math inline">\(A \in \mathbb{R}^{r \times d}\)</span> and the rank <span class="math inline">\(r &lt;&lt; min(d, k)\)</span>. Thus instead of learning <span class="math inline">\(d \times k\)</span> parameters we now need to learn <span class="math inline">\((d + k) \times r\)</span> which is easily a lot smaller given the multiplicative aspect. In practice, <span class="math inline">\(\Delta \theta_i\)</span> is scaled by <span class="math inline">\(\frac{\alpha}{r}\)</span> before being added to <span class="math inline">\(\theta_i\)</span>, which can be interpreted as a ‘learning rate’ for the LoRA update.</p>
<p>LoRA does not increase inference latency, as once fine tuning is done, you can simply update the weights in <span class="math inline">\(\Theta\)</span> by adding their respective <span class="math inline">\(\Delta \theta \approx \Delta \phi\)</span>. It also makes it simpler to deploy multiple task specific models on top of one large model, as <span class="math inline">\(|\Delta \Phi|\)</span> is much smaller than <span class="math inline">\(|\Delta \Theta|\)</span>.</p>
</div>
<div class="footer">
<p>d’après https://blogs.rstudio.com/ai/posts/2023-06-22-understanding-lora/</p>
</div>
</section>
<section id="implémentation-avec-torch" class="slide level2">
<h2>Implémentation avec torch</h2>
<p>On simule un jeu de données <span class="math inline">\(y = X \theta\)</span> model. <span class="math inline">\(\theta \in \mathbb{R}^{1001, 1000}\)</span>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href=""></a><span class="fu">library</span>(torch)</span>
<span id="cb72-2"><a href=""></a></span>
<span id="cb72-3"><a href=""></a>n <span class="ot">&lt;-</span> <span class="dv">10000</span></span>
<span id="cb72-4"><a href=""></a>d_in <span class="ot">&lt;-</span> <span class="dv">1001</span></span>
<span id="cb72-5"><a href=""></a>d_out <span class="ot">&lt;-</span> <span class="dv">1000</span></span>
<span id="cb72-6"><a href=""></a></span>
<span id="cb72-7"><a href=""></a>thetas <span class="ot">&lt;-</span> <span class="fu">torch_randn</span>(d_in, d_out)</span>
<span id="cb72-8"><a href=""></a></span>
<span id="cb72-9"><a href=""></a>X <span class="ot">&lt;-</span> <span class="fu">torch_randn</span>(n, d_in)</span>
<span id="cb72-10"><a href=""></a>y <span class="ot">&lt;-</span> <span class="fu">torch_matmul</span>(X, thetas)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section class="slide level2">

<p>On entraine un modèle pour estimer <span class="math inline">\(\theta\)</span>. C’est notre modèle entraîné.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href=""></a>lin_model <span class="ot">&lt;-</span> <span class="fu">nn_linear</span>(d_in, d_out, <span class="at">bias =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href=""></a>train <span class="ot">&lt;-</span> <span class="cf">function</span>(model, X, y, <span class="at">batch_size =</span> <span class="dv">128</span>, <span class="at">epochs =</span> <span class="dv">100</span>) {</span>
<span id="cb74-2"><a href=""></a>  opt <span class="ot">&lt;-</span> <span class="fu">optim_ignite_adam</span>(model<span class="sc">$</span>parameters)</span>
<span id="cb74-3"><a href=""></a></span>
<span id="cb74-4"><a href=""></a>  <span class="cf">for</span> (epoch <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>epochs) {</span>
<span id="cb74-5"><a href=""></a>    <span class="cf">for</span>(i <span class="cf">in</span> <span class="fu">seq_len</span>(n<span class="sc">/</span>batch_size)) {</span>
<span id="cb74-6"><a href=""></a>      idx <span class="ot">&lt;-</span> <span class="fu">sample.int</span>(n, <span class="at">size =</span> batch_size)</span>
<span id="cb74-7"><a href=""></a>      loss <span class="ot">&lt;-</span> <span class="fu">nnf_mse_loss</span>(<span class="fu">model</span>(X[idx,]), y[idx])</span>
<span id="cb74-8"><a href=""></a>      </span>
<span id="cb74-9"><a href=""></a>      <span class="fu">with_no_grad</span>({</span>
<span id="cb74-10"><a href=""></a>        opt<span class="sc">$</span><span class="fu">zero_grad</span>()</span>
<span id="cb74-11"><a href=""></a>        loss<span class="sc">$</span><span class="fu">backward</span>()</span>
<span id="cb74-12"><a href=""></a>        opt<span class="sc">$</span><span class="fu">step</span>()  </span>
<span id="cb74-13"><a href=""></a>      })</span>
<span id="cb74-14"><a href=""></a>    }</span>
<span id="cb74-15"><a href=""></a>    </span>
<span id="cb74-16"><a href=""></a>    <span class="cf">if</span> (epoch <span class="sc">%%</span> <span class="dv">10</span> <span class="sc">==</span> <span class="dv">0</span>) {</span>
<span id="cb74-17"><a href=""></a>      <span class="fu">with_no_grad</span>({</span>
<span id="cb74-18"><a href=""></a>        loss <span class="ot">&lt;-</span> <span class="fu">nnf_mse_loss</span>(<span class="fu">model</span>(X), y)</span>
<span id="cb74-19"><a href=""></a>      })</span>
<span id="cb74-20"><a href=""></a>      <span class="fu">cat</span>(<span class="st">"["</span>, epoch, <span class="st">"] Loss:"</span>, loss<span class="sc">$</span><span class="fu">item</span>(), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb74-21"><a href=""></a>    }</span>
<span id="cb74-22"><a href=""></a>  }</span>
<span id="cb74-23"><a href=""></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section class="slide level2">

<p>On entraîne le modèle</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href=""></a><span class="fu">train</span>(lin_model, X, y)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[ 10 ] Loss: 576.6039 
[ 20 ] Loss: 311.8771 
[ 30 ] Loss: 154.8159 
[ 40 ] Loss: 68.2778 
[ 50 ] Loss: 25.5456 
[ 60 ] Loss: 7.554851 
[ 70 ] Loss: 1.582172 
[ 80 ] Loss: 0.2017887 
[ 90 ] Loss: 0.01323973 
[ 100 ] Loss: 0.000453501 </code></pre>
</div>
</div>
</section>
<section class="slide level2">

<p>On simule une distribution des données différente en appliquant une transformation à <span class="math inline">\(\theta\)</span></p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href=""></a>thetas2 <span class="ot">&lt;-</span> thetas <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb77-2"><a href=""></a></span>
<span id="cb77-3"><a href=""></a>X2 <span class="ot">&lt;-</span> <span class="fu">torch_randn</span>(n, d_in)</span>
<span id="cb77-4"><a href=""></a>y2 <span class="ot">&lt;-</span> <span class="fu">torch_matmul</span>(X2, thetas2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Sur ces données, le modèle donne de mauvais résultats :</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href=""></a><span class="fu">nnf_mse_loss</span>(<span class="fu">lin_model</span>(X2), y2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>torch_tensor
988.92
[ CPUFloatType{} ][ grad_fn = &lt;MseLossBackward0&gt; ]</code></pre>
</div>
</div>
</section>
<section class="slide level2">

<div class="small">
<p>Le nouveau LoRA - s’ajoute au modèle <code>linear</code> dont on gèle les poids - avec des tenseurs A et B de dimension intérieure <span class="math inline">\(r\)</span></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href=""></a>lora_nn_linear <span class="ot">&lt;-</span> <span class="fu">nn_module</span>(</span>
<span id="cb80-2"><a href=""></a>  <span class="at">initialize =</span> <span class="cf">function</span>(linear, <span class="at">r =</span> <span class="dv">16</span>L, <span class="at">alpha =</span> <span class="dv">1</span>) {</span>
<span id="cb80-3"><a href=""></a>    self<span class="sc">$</span>linear <span class="ot">&lt;-</span> linear</span>
<span id="cb80-4"><a href=""></a>    </span>
<span id="cb80-5"><a href=""></a>    <span class="co"># les paramêtres du modèle linéirte initial sont  'gelés', donc pas pris en </span></span>
<span id="cb80-6"><a href=""></a>    <span class="co"># considération pr autograd. Ce sont juste des constantes.</span></span>
<span id="cb80-7"><a href=""></a>    purrr<span class="sc">::</span><span class="fu">walk</span>(self<span class="sc">$</span>linear<span class="sc">$</span>parameters, \(x) x<span class="sc">$</span><span class="fu">requires_grad_</span>(<span class="cn">FALSE</span>))</span>
<span id="cb80-8"><a href=""></a>    </span>
<span id="cb80-9"><a href=""></a>    <span class="co"># LEs paramêtre du Low-rank à entraîner (shortcut here, specific to our lin_model)</span></span>
<span id="cb80-10"><a href=""></a>    self<span class="sc">$</span>A <span class="ot">&lt;-</span> <span class="fu">nn_parameter</span>(<span class="fu">torch_randn</span>(linear<span class="sc">$</span>in_features, r))</span>
<span id="cb80-11"><a href=""></a>    self<span class="sc">$</span>B <span class="ot">&lt;-</span> <span class="fu">nn_parameter</span>(<span class="fu">torch_zeros</span>(r, linear<span class="sc">$</span>out_features))</span>
<span id="cb80-12"><a href=""></a>    </span>
<span id="cb80-13"><a href=""></a>    <span class="co"># la constante de scaling</span></span>
<span id="cb80-14"><a href=""></a>    self<span class="sc">$</span>scaling <span class="ot">&lt;-</span> alpha <span class="sc">/</span> r</span>
<span id="cb80-15"><a href=""></a>  },</span>
<span id="cb80-16"><a href=""></a>  <span class="at">forward =</span> <span class="cf">function</span>(x) {</span>
<span id="cb80-17"><a href=""></a>    <span class="co"># La fonction `forward` modifiée qui ajoute le résultat du LoRA  A.B.x aux résultat du modèle initial</span></span>
<span id="cb80-18"><a href=""></a>    self<span class="sc">$</span><span class="fu">linear</span>(x) <span class="sc">+</span> <span class="fu">torch_matmul</span>(x, <span class="fu">torch_matmul</span>(self<span class="sc">$</span>A, self<span class="sc">$</span>B) <span class="sc">*</span> self<span class="sc">$</span>scaling)</span>
<span id="cb80-19"><a href=""></a>  }</span>
<span id="cb80-20"><a href=""></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</section>
<section class="slide level2">

<p>Essayons un LoRA avec <span class="math inline">\(r = 1\)</span> i.e.&nbsp;A et B sont des vecteurs</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href=""></a>lora <span class="ot">&lt;-</span> <span class="fu">lora_nn_linear</span>(lin_model, <span class="at">r =</span> <span class="dv">1</span>L)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>entraînement du LoRA sur la nouvelle distribution</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href=""></a><span class="fu">train</span>(lora, X2, y2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[ 10 ] Loss: 803.9484 
[ 20 ] Loss: 480.2847 
[ 30 ] Loss: 252.2604 
[ 40 ] Loss: 117.0122 
[ 50 ] Loss: 45.98793 
[ 60 ] Loss: 14.2972 
[ 70 ] Loss: 3.188789 
[ 80 ] Loss: 0.4264118 
[ 90 ] Loss: 0.02679148 
[ 100 ] Loss: 0.001070438 </code></pre>
</div>
</div>
</section>
<section class="slide level2">

<p>Le tenseur <span class="math inline">\(\Delta \theta\)</span> est idéalement constant à 1 :</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb84-1"><a href=""></a>delta_theta <span class="ot">&lt;-</span> <span class="fu">torch_matmul</span>(lora<span class="sc">$</span>A, lora<span class="sc">$</span>B) <span class="sc">*</span> lora<span class="sc">$</span>scaling</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb85-1"><a href=""></a>delta_theta[<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>]</span>
<span id="cb85-2"><a href=""></a><span class="co">#&gt; torch_tensor</span></span>
<span id="cb85-3"><a href=""></a><span class="co">#&gt; 1.0005  1.0005  1.0005  1.0005  1.0005</span></span>
<span id="cb85-4"><a href=""></a><span class="co">#&gt; 1.0000  1.0000  1.0000  1.0000  1.0000</span></span>
<span id="cb85-5"><a href=""></a><span class="co">#&gt; 0.9958  0.9958  0.9958  0.9958  0.9958</span></span>
<span id="cb85-6"><a href=""></a><span class="co">#&gt; 0.9993  0.9993  0.9993  0.9993  0.9993</span></span>
<span id="cb85-7"><a href=""></a><span class="co">#&gt; 0.9997  0.9997  0.9997  0.9997  0.9997</span></span>
<span id="cb85-8"><a href=""></a><span class="co">#&gt;[ CPUFloatType{5,5} ][ grad_fn = &lt;SliceBackward0&gt; ]</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section class="slide level2">

<div class="smaller scrollable">
<p>Pour diminuer le temps d’inférence, une astuce consiste à ajouter le LoRA directement au poids du modèle avec la fonction <code>$add_</code>. Ainsi on passe de deux inférences séquentielle, à une seule.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb86-1"><a href=""></a><span class="fu">with_no_grad</span>({</span>
<span id="cb86-2"><a href=""></a>  lin_model<span class="sc">$</span>weight<span class="sc">$</span><span class="fu">add_</span>(delta_theta<span class="sc">$</span><span class="fu">t</span>())  </span>
<span id="cb86-3"><a href=""></a>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>torch_tensor
Columns 1 to 6-1.3702e+00 -1.8230e+00 -6.2842e-02 -6.6632e-01  3.9145e-01 -1.0849e+00
-9.9452e-01  2.3281e+00 -1.2232e+00  1.9496e+00 -2.2651e-01  3.4276e-01
-9.3249e-01  2.4470e-01 -7.7541e-01 -1.7575e+00  1.9786e+00 -1.7312e+00
 1.8013e+00  8.8431e-02  1.0654e+00 -6.3846e-01 -7.8318e-01  1.6281e+00
-3.7756e-01 -1.6199e+00  1.2010e+00 -1.4953e+00 -1.3473e+00  2.9494e-01
 9.4640e-01  7.6874e-01  1.1691e+00 -1.2790e+00 -1.7773e+00  1.8248e+00
-1.7454e+00  4.9157e-01 -1.1067e+00  5.3387e-01  8.1825e-02  3.7023e-01
-4.9610e-02  6.9243e-01 -1.4972e+00  6.9678e-01  1.3679e+00  3.0947e-01
 1.5678e+00  3.0892e-01  1.2925e+00 -1.3465e+00 -2.4546e-01  1.4780e+00
 9.1523e-01  8.0792e-02 -9.2377e-01  1.0088e+00  4.2277e-01 -1.5816e-01
 6.5593e-01  6.5353e-02  5.1238e-01  6.6861e-01 -4.7130e-01 -6.9400e-01
 1.0499e+00 -5.8894e-01  5.3813e-01  3.4786e-01 -8.1234e-01  9.3049e-01
-1.3125e-01 -7.7277e-01 -1.7689e+00  4.4351e-01 -1.6387e+00 -8.4184e-01
 4.9112e-01 -4.4472e-01 -8.3900e-02  2.5632e+00 -2.1624e+00  9.9819e-02
-1.4026e+00  1.2139e+00  8.6326e-01  7.5578e-01  5.9698e-01  1.9664e+00
 1.8184e+00 -1.4854e+00  4.6389e-01 -6.3541e-01 -3.5622e-02 -1.1756e+00
 9.7948e-02 -1.3066e+00 -7.6465e-01 -5.8135e-01  1.7723e+00  3.1507e-01
-6.8449e-01  1.4971e+00  8.5841e-02  1.4874e+00 -2.4287e+00 -7.7290e-01
-1.0146e+00 -9.2046e-01  1.4259e+00 -4.3127e-02  1.1053e+00 -5.5399e-01
-1.7334e+00 -1.5949e+00 -3.6605e-01  9.1769e-01 -4.8194e-01 -1.9422e+00
 1.1083e+00  3.4509e-01  3.5148e-03  6.2509e-01 -1.7053e+00  1.0438e-01
-6.2546e-01  7.2093e-01 -8.1211e-01 -8.2500e-01 -1.2463e+00 -9.3799e-01
-7.3798e-01  4.7272e-01  9.2503e-01  9.1160e-02  6.2472e-01 -1.3352e+00
-2.5224e-01 -1.3423e+00 -1.5197e+00  1.1242e+00  6.8534e-02 -1.7901e+00
-2.6883e-01  6.6717e-01  7.4457e-01 -5.4357e-01  2.2816e-01  7.0499e-02
-1.1835e-01 -1.9279e-01  6.0010e-01 -7.8544e-02 -6.1630e-01  5.0806e-01
 1.4728e+00  1.8682e-01  1.2522e+00 -9.1607e-01  1.0065e+00 -4.9821e-01
-1.1942e+00  9.1282e-01  1.2018e+00 -1.9340e+00  3.8941e-01 -1.0429e+00
 3.5208e-01 -4.7015e-01  2.6418e+00  5.7486e-01 -1.1825e+00  7.4574e-01
 1.5374e-01 -5.1457e-01 -7.9212e-01  1.8305e-01  9.3734e-01  1.1209e+00
... [the output was truncated (use n=-1 to disable)]
[ CPUFloatType{1000,1001} ]</code></pre>
</div>
</div>
</div>
</section>
<section class="slide level2">

<p>Quel est la performance sur la nouvelle distribution ?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb88-1"><a href=""></a><span class="fu">nnf_mse_loss</span>(<span class="fu">lin_model</span>(X2), y2)</span>
<span id="cb88-2"><a href=""></a><span class="co">#&gt; torch_tensor</span></span>
<span id="cb88-3"><a href=""></a><span class="co">#&gt; 0.0012366</span></span>
<span id="cb88-4"><a href=""></a><span class="co">#&gt; [ CPUFloatType{} ]</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section></section>
<section>
<section id="un-classifieur-dimages-métier-par-le-fine-tuning-de-resnext50" class="title-slide slide level1 center">
<h1>Un classifieur d’images métier par le fine-tuning de ResNext50</h1>

</section>
<section id="un-jeu-de-données-sur-le-plancton" class="slide level2">
<h2>un jeu de données sur le plancton</h2>
<div class="columns">
<div class="column" style="width:30%;">
<p><a href="images/screenshot_testset_plankton.png" class="lightbox" data-gallery="quarto-lightbox-gallery-30"><img data-src="images/screenshot_testset_plankton.png"></a></p>
</div><div class="column" style="width:70%;">
<p><a href="Data_mining_with_R/data/Samples/MTLG.2005-05-24.H1/MTLG.2005-05-24.H1+B2_392.jpg" class="lightbox" data-gallery="quarto-lightbox-gallery-31"><img data-src="Data_mining_with_R/data/Samples/MTLG.2005-05-24.H1/MTLG.2005-05-24.H1+B2_392.jpg"></a></p>
</div></div>
<p>::::::</p>
</section>
<section class="slide level2">

<div class="cell">
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb89-1"><a href=""></a><span class="fu">library</span>(torch)</span>
<span id="cb89-2"><a href=""></a><span class="fu">library</span>(torchvision)</span>
<span id="cb89-3"><a href=""></a>train_ds <span class="ot">&lt;-</span> <span class="fu">image_folder_dataset</span>(</span>
<span id="cb89-4"><a href=""></a>  <span class="st">"Data_mining_with_R/data/Training set"</span>,</span>
<span id="cb89-5"><a href=""></a>  <span class="at">transform =</span> <span class="cf">function</span>(x) {</span>
<span id="cb89-6"><a href=""></a>    x <span class="sc">|&gt;</span> <span class="fu">transform_to_tensor</span>() <span class="sc">|&gt;</span> </span>
<span id="cb89-7"><a href=""></a>      <span class="fu">transform_resize</span>(<span class="fu">c</span>(<span class="dv">224</span>, <span class="dv">224</span>))</span>
<span id="cb89-8"><a href=""></a>  })</span>
<span id="cb89-9"><a href=""></a>test_ds <span class="ot">&lt;-</span> <span class="fu">image_folder_dataset</span>(</span>
<span id="cb89-10"><a href=""></a>  <span class="st">"Data_mining_with_R/data/Test sets"</span>,</span>
<span id="cb89-11"><a href=""></a>  <span class="at">transform =</span> <span class="cf">function</span>(x) {</span>
<span id="cb89-12"><a href=""></a>    x <span class="sc">|&gt;</span> <span class="fu">transform_to_tensor</span>() <span class="sc">|&gt;</span> </span>
<span id="cb89-13"><a href=""></a>      <span class="fu">transform_resize</span>(<span class="fu">c</span>(<span class="dv">224</span>, <span class="dv">224</span>))</span>
<span id="cb89-14"><a href=""></a>  })</span>
<span id="cb89-15"><a href=""></a></span>
<span id="cb89-16"><a href=""></a></span>
<span id="cb89-17"><a href=""></a>train_ds<span class="sc">$</span><span class="fu">.length</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 2873</code></pre>
</div>
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb91-1"><a href=""></a>test_ds<span class="sc">$</span><span class="fu">.length</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 4866</code></pre>
</div>
</div>
</section>
<section id="resnext-préentrainé" class="slide level2">
<h2>ResNext préentrainé</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb93-1"><a href=""></a>resnext <span class="ot">&lt;-</span> <span class="fu">model_resnext50_32x4d</span>(<span class="at">pretrained =</span> <span class="cn">TRUE</span>)</span>
<span id="cb93-2"><a href=""></a>resnext</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>An `nn_module` containing 25,028,904 parameters.

── Modules ─────────────────────────────────────────────────────────────────────
• conv1: &lt;nn_conv2d&gt; #9,408 parameters
• bn1: &lt;nn_batch_norm2d&gt; #128 parameters
• relu: &lt;nn_relu&gt; #0 parameters
• maxpool: &lt;nn_max_pool2d&gt; #0 parameters
• layer1: &lt;nn_sequential&gt; #205,824 parameters
• layer2: &lt;nn_sequential&gt; #1,197,056 parameters
• layer3: &lt;nn_sequential&gt; #7,022,592 parameters
• layer4: &lt;nn_sequential&gt; #14,544,896 parameters
• avgpool: &lt;nn_adaptive_avg_pool2d&gt; #0 parameters
• fc: &lt;nn_linear&gt; #2,049,000 parameters</code></pre>
</div>
</div>
<aside class="notes">
<p><code>model_resnext50_32x4d(pretrained = TRUE, num_classes = length(train_ds$classes))</code> devrait être disponible bientôt. Pour le moment, il faut le faire à la main</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="à-vous-de-jouer-exercice-04" class="slide level2">
<h2>À vous de jouer, exercice 04</h2>
<div class="question">
<p>Complete 04_exercise to practice ResNext model fine-tuning.</p>
</div>
<div class="cell">
<div class="cell-output-display">
<div class="countdown" id="timer_03e38e6f" data-update-every="1" tabindex="0" style="right:0;bottom:0;">
<div class="countdown-controls"><button class="countdown-bump-down">−</button><button class="countdown-bump-up">+</button></div>
<code class="countdown-time"><span class="countdown-digits minutes">07</span><span class="countdown-digits colon">:</span><span class="countdown-digits seconds">00</span></code>
</div>
</div>
</div>
</section>
<section id="réentrainement-de-la-tête-de-classification" class="slide level2">
<h2>réentrainement de la tête de classification</h2>
<p>explorons la transformation des images par le réseau préentrainé</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb95-1"><a href=""></a>resnext_embedding <span class="ot">&lt;-</span> resnext <span class="sc">|&gt;</span> </span>
<span id="cb95-2"><a href=""></a>  <span class="fu">nn_prune_head</span>(<span class="dv">1</span>)</span>
<span id="cb95-3"><a href=""></a>resnext_embedding</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>An `nn_module` containing 22,979,904 parameters.

── Modules ─────────────────────────────────────────────────────────────────────
• conv1: &lt;nn_conv2d&gt; #9,408 parameters
• bn1: &lt;nn_batch_norm2d&gt; #128 parameters
• relu: &lt;nn_relu&gt; #0 parameters
• maxpool: &lt;nn_max_pool2d&gt; #0 parameters
• layer1: &lt;nn_sequential&gt; #205,824 parameters
• layer2: &lt;nn_sequential&gt; #1,197,056 parameters
• layer3: &lt;nn_sequential&gt; #7,022,592 parameters
• layer4: &lt;nn_sequential&gt; #14,544,896 parameters
• avgpool: &lt;nn_adaptive_avg_pool2d&gt; #0 parameters</code></pre>
</div>
</div>
</section>
<section class="slide level2">

<div class="cell">
<div class="sourceCode cell-code" id="cb97"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb97-1"><a href=""></a>dl <span class="ot">&lt;-</span> <span class="fu">dataloader</span>(train_ds, <span class="at">batch_size =</span> <span class="dv">1</span>)</span>
<span id="cb97-2"><a href=""></a>iter <span class="ot">&lt;-</span> <span class="fu">dataloader_make_iter</span>(dl)</span>
<span id="cb97-3"><a href=""></a>img_class <span class="ot">&lt;-</span> <span class="fu">dataloader_next</span>(iter)</span>
<span id="cb97-4"><a href=""></a></span>
<span id="cb97-5"><a href=""></a><span class="fu">resnext_embedding</span>(img_class[[<span class="dv">1</span>]])<span class="sc">$</span><span class="fu">squeeze</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>torch_tensor
 0.4956
 0.4499
 0.4132
 0.4217
 0.4663
 0.4511
 0.5266
 0.3839
 0.4600
 0.4451
 0.4153
 0.4536
 0.4079
 0.3616
 0.4893
 0.4373
 0.4254
 0.5138
 0.4923
 0.4400
 0.4237
 0.3764
 0.4559
 0.5589
 0.4151
 0.3832
 0.4681
 0.4256
 0.4372
 0.3886
... [the output was truncated (use n=-1 to disable)]
[ CPUFloatType{2048} ][ grad_fn = &lt;SqueezeBackward0&gt; ]</code></pre>
</div>
</div>
<p>un tenseur d’embedding de l’image de taille 2048…</p>
</section>
<section class="slide level2">


</section></section>

    </div>
  <div class="quarto-auto-generated-content" style="display: none;">
<p><img src="images/mlverse.png" class="slide-logo"></p>
<div class="footer footer-default">
<p><a href="https://github.com/cregouby/Tutoriel_torch_slides">{torch}, {tabnet},… par l’usage</a></p>
</div>
</div></div>

  <script>window.backupDefine = window.define; window.define = undefined;</script>
  <script src="index_files/libs/revealjs/dist/reveal.js"></script>
  <!-- reveal.js plugins -->
  <script src="index_files/libs/revealjs/plugin/quarto-line-highlight/line-highlight.js"></script>
  <script src="index_files/libs/revealjs/plugin/pdf-export/pdfexport.js"></script>
  <script src="index_files/libs/revealjs/plugin/reveal-menu/menu.js"></script>
  <script src="index_files/libs/revealjs/plugin/reveal-menu/quarto-menu.js"></script>
  <script src="index_files/libs/revealjs/plugin/quarto-support/support.js"></script>
  

  <script src="index_files/libs/revealjs/plugin/notes/notes.js"></script>
  <script src="index_files/libs/revealjs/plugin/search/search.js"></script>
  <script src="index_files/libs/revealjs/plugin/zoom/zoom.js"></script>
  <script src="index_files/libs/revealjs/plugin/math/math.js"></script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script>

  <script>

      // Full list of configuration options available at:
      // https://revealjs.com/config/
      Reveal.initialize({
'controlsAuto': true,
'previewLinksAuto': false,
'pdfSeparateFragments': false,
'autoAnimateEasing': "ease",
'autoAnimateDuration': 1,
'autoAnimateUnmatched': true,
'jumpToSlide': true,
'menu': {"side":"left","useTextContentForMissingTitles":true,"markers":false,"loadIcons":false,"custom":[{"title":"Tools","icon":"<i class=\"fas fa-gear\"></i>","content":"<ul class=\"slide-menu-items\">\n<li class=\"slide-tool-item active\" data-item=\"0\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.fullscreen(event)\"><kbd>f</kbd> Fullscreen</a></li>\n<li class=\"slide-tool-item\" data-item=\"1\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.speakerMode(event)\"><kbd>s</kbd> Speaker View</a></li>\n<li class=\"slide-tool-item\" data-item=\"2\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.overview(event)\"><kbd>o</kbd> Slide Overview</a></li>\n<li class=\"slide-tool-item\" data-item=\"3\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.togglePdfExport(event)\"><kbd>e</kbd> PDF Export Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"4\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.toggleScrollView(event)\"><kbd>r</kbd> Scroll View Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"5\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.keyboardHelp(event)\"><kbd>?</kbd> Keyboard Help</a></li>\n</ul>"}],"openButton":true},
'smaller': false,
 
        // Display controls in the bottom right corner
        controls: false,

        // Help the user learn the controls by providing hints, for example by
        // bouncing the down arrow when they first encounter a vertical slide
        controlsTutorial: false,

        // Determines where controls appear, "edges" or "bottom-right"
        controlsLayout: 'edges',

        // Visibility rule for backwards navigation arrows; "faded", "hidden"
        // or "visible"
        controlsBackArrows: 'faded',

        // Display a presentation progress bar
        progress: true,

        // Display the page number of the current slide
        slideNumber: false,

        // 'all', 'print', or 'speaker'
        showSlideNumber: 'all',

        // Add the current slide number to the URL hash so that reloading the
        // page/copying the URL will return you to the same slide
        hash: true,

        // Start with 1 for the hash rather than 0
        hashOneBasedIndex: false,

        // Flags if we should monitor the hash and change slides accordingly
        respondToHashChanges: true,

        // Push each slide change to the browser history
        history: true,

        // Enable keyboard shortcuts for navigation
        keyboard: true,

        // Enable the slide overview mode
        overview: true,

        // Disables the default reveal.js slide layout (scaling and centering)
        // so that you can use custom CSS layout
        disableLayout: false,

        // Vertical centering of slides
        center: false,

        // Enables touch navigation on devices with touch input
        touch: true,

        // Loop the presentation
        loop: false,

        // Change the presentation direction to be RTL
        rtl: false,

        // see https://revealjs.com/vertical-slides/#navigation-mode
        navigationMode: 'linear',

        // Randomizes the order of slides each time the presentation loads
        shuffle: false,

        // Turns fragments on and off globally
        fragments: true,

        // Flags whether to include the current fragment in the URL,
        // so that reloading brings you to the same fragment position
        fragmentInURL: false,

        // Flags if the presentation is running in an embedded mode,
        // i.e. contained within a limited portion of the screen
        embedded: false,

        // Flags if we should show a help overlay when the questionmark
        // key is pressed
        help: true,

        // Flags if it should be possible to pause the presentation (blackout)
        pause: true,

        // Flags if speaker notes should be visible to all viewers
        showNotes: false,

        // Global override for autoplaying embedded media (null/true/false)
        autoPlayMedia: null,

        // Global override for preloading lazy-loaded iframes (null/true/false)
        preloadIframes: null,

        // Number of milliseconds between automatically proceeding to the
        // next slide, disabled when set to 0, this value can be overwritten
        // by using a data-autoslide attribute on your slides
        autoSlide: 0,

        // Stop auto-sliding after user input
        autoSlideStoppable: true,

        // Use this method for navigation when auto-sliding
        autoSlideMethod: null,

        // Specify the average time in seconds that you think you will spend
        // presenting each slide. This is used to show a pacing timer in the
        // speaker view
        defaultTiming: null,

        // Enable slide navigation via mouse wheel
        mouseWheel: false,

        // The display mode that will be used to show slides
        display: 'block',

        // Hide cursor if inactive
        hideInactiveCursor: true,

        // Time before the cursor is hidden (in ms)
        hideCursorTime: 5000,

        // Opens links in an iframe preview overlay
        previewLinks: false,

        // Transition style (none/fade/slide/convex/concave/zoom)
        transition: 'none',

        // Transition speed (default/fast/slow)
        transitionSpeed: 'default',

        // Transition style for full page slide backgrounds
        // (none/fade/slide/convex/concave/zoom)
        backgroundTransition: 'none',

        // Number of slides away from the current that are visible
        viewDistance: 3,

        // Number of slides away from the current that are visible on mobile
        // devices. It is advisable to set this to a lower number than
        // viewDistance in order to save resources.
        mobileViewDistance: 2,

        // The "normal" size of the presentation, aspect ratio will be preserved
        // when the presentation is scaled to fit different resolutions. Can be
        // specified using percentage units.
        width: 1050,

        height: 700,

        // Factor of the display size that should remain empty around the content
        margin: 0.1,

        math: {
          mathjax: 'https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/MathJax.js',
          config: 'TeX-AMS_HTML-full',
          tex2jax: {
            inlineMath: [['\\(','\\)']],
            displayMath: [['\\[','\\]']],
            balanceBraces: true,
            processEscapes: false,
            processRefs: true,
            processEnvironments: true,
            preview: 'TeX',
            skipTags: ['script','noscript','style','textarea','pre','code'],
            ignoreClass: 'tex2jax_ignore',
            processClass: 'tex2jax_process'
          },
        },

        // reveal.js plugins
        plugins: [QuartoLineHighlight, PdfExport, RevealMenu, QuartoSupport,

          RevealMath,
          RevealNotes,
          RevealSearch,
          RevealZoom
        ]
      });
    </script>
    
    <script>
      // htmlwidgets need to know to resize themselves when slides are shown/hidden.
      // Fire the "slideenter" event (handled by htmlwidgets.js) when the current
      // slide changes (different for each slide format).
      (function () {
        // dispatch for htmlwidgets
        function fireSlideEnter() {
          const event = window.document.createEvent("Event");
          event.initEvent("slideenter", true, true);
          window.document.dispatchEvent(event);
        }

        function fireSlideChanged(previousSlide, currentSlide) {
          fireSlideEnter();

          // dispatch for shiny
          if (window.jQuery) {
            if (previousSlide) {
              window.jQuery(previousSlide).trigger("hidden");
            }
            if (currentSlide) {
              window.jQuery(currentSlide).trigger("shown");
            }
          }
        }

        // hookup for slidy
        if (window.w3c_slidy) {
          window.w3c_slidy.add_observer(function (slide_num) {
            // slide_num starts at position 1
            fireSlideChanged(null, w3c_slidy.slides[slide_num - 1]);
          });
        }

      })();
    </script>

    <script id="quarto-html-after-body" type="application/javascript">
    window.document.addEventListener("DOMContentLoaded", function (event) {
      const toggleBodyColorMode = (bsSheetEl) => {
        const mode = bsSheetEl.getAttribute("data-mode");
        const bodyEl = window.document.querySelector("body");
        if (mode === "dark") {
          bodyEl.classList.add("quarto-dark");
          bodyEl.classList.remove("quarto-light");
        } else {
          bodyEl.classList.add("quarto-light");
          bodyEl.classList.remove("quarto-dark");
        }
      }
      const toggleBodyColorPrimary = () => {
        const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
        if (bsSheetEl) {
          toggleBodyColorMode(bsSheetEl);
        }
      }
      toggleBodyColorPrimary();  
      const tabsets =  window.document.querySelectorAll(".panel-tabset-tabby")
      tabsets.forEach(function(tabset) {
        const tabby = new Tabby('#' + tabset.id);
      });
      const isCodeAnnotation = (el) => {
        for (const clz of el.classList) {
          if (clz.startsWith('code-annotation-')) {                     
            return true;
          }
        }
        return false;
      }
      const onCopySuccess = function(e) {
        // button target
        const button = e.trigger;
        // don't keep focus
        button.blur();
        // flash "checked"
        button.classList.add('code-copy-button-checked');
        var currentTitle = button.getAttribute("title");
        button.setAttribute("title", "Copied!");
        let tooltip;
        if (window.bootstrap) {
          button.setAttribute("data-bs-toggle", "tooltip");
          button.setAttribute("data-bs-placement", "left");
          button.setAttribute("data-bs-title", "Copied!");
          tooltip = new bootstrap.Tooltip(button, 
            { trigger: "manual", 
              customClass: "code-copy-button-tooltip",
              offset: [0, -8]});
          tooltip.show();    
        }
        setTimeout(function() {
          if (tooltip) {
            tooltip.hide();
            button.removeAttribute("data-bs-title");
            button.removeAttribute("data-bs-toggle");
            button.removeAttribute("data-bs-placement");
          }
          button.setAttribute("title", currentTitle);
          button.classList.remove('code-copy-button-checked');
        }, 1000);
        // clear code selection
        e.clearSelection();
      }
      const getTextToCopy = function(trigger) {
          const codeEl = trigger.previousElementSibling.cloneNode(true);
          for (const childEl of codeEl.children) {
            if (isCodeAnnotation(childEl)) {
              childEl.remove();
            }
          }
          return codeEl.innerText;
      }
      const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
        text: getTextToCopy
      });
      clipboard.on('success', onCopySuccess);
      if (window.document.getElementById('quarto-embedded-source-code-modal')) {
        // For code content inside modals, clipBoardJS needs to be initialized with a container option
        // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
        const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
          text: getTextToCopy,
          container: window.document.getElementById('quarto-embedded-source-code-modal')
        });
        clipboardModal.on('success', onCopySuccess);
      }
        var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
        var mailtoRegex = new RegExp(/^mailto:/);
          var filterRegex = new RegExp('/' + window.location.host + '/');
        var isInternal = (href) => {
            return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
        }
        // Inspect non-navigation links and adorn them if external
     	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
        for (var i=0; i<links.length; i++) {
          const link = links[i];
          if (!isInternal(link.href)) {
            // undo the damage that might have been done by quarto-nav.js in the case of
            // links that we want to consider external
            if (link.dataset.originalHref !== undefined) {
              link.href = link.dataset.originalHref;
            }
          }
        }
      function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
        const config = {
          allowHTML: true,
          maxWidth: 500,
          delay: 100,
          arrow: false,
          appendTo: function(el) {
              return el.closest('section.slide') || el.parentElement;
          },
          interactive: true,
          interactiveBorder: 10,
          theme: 'light-border',
          placement: 'bottom-start',
        };
        if (contentFn) {
          config.content = contentFn;
        }
        if (onTriggerFn) {
          config.onTrigger = onTriggerFn;
        }
        if (onUntriggerFn) {
          config.onUntrigger = onUntriggerFn;
        }
          config['offset'] = [0,0];
          config['maxWidth'] = 700;
        window.tippy(el, config); 
      }
      const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
      for (var i=0; i<noterefs.length; i++) {
        const ref = noterefs[i];
        tippyHover(ref, function() {
          // use id or data attribute instead here
          let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
          try { href = new URL(href).hash; } catch {}
          const id = href.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note) {
            return note.innerHTML;
          } else {
            return "";
          }
        });
      }
      const findCites = (el) => {
        const parentEl = el.parentElement;
        if (parentEl) {
          const cites = parentEl.dataset.cites;
          if (cites) {
            return {
              el,
              cites: cites.split(' ')
            };
          } else {
            return findCites(el.parentElement)
          }
        } else {
          return undefined;
        }
      };
      var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
      for (var i=0; i<bibliorefs.length; i++) {
        const ref = bibliorefs[i];
        const citeInfo = findCites(ref);
        if (citeInfo) {
          tippyHover(citeInfo.el, function() {
            var popup = window.document.createElement('div');
            citeInfo.cites.forEach(function(cite) {
              var citeDiv = window.document.createElement('div');
              citeDiv.classList.add('hanging-indent');
              citeDiv.classList.add('csl-entry');
              var biblioDiv = window.document.getElementById('ref-' + cite);
              if (biblioDiv) {
                citeDiv.innerHTML = biblioDiv.innerHTML;
              }
              popup.appendChild(citeDiv);
            });
            return popup.innerHTML;
          });
        }
      }
    });
    </script>
    <script>var lightboxQuarto = GLightbox({"selector":".lightbox","descPosition":"bottom","closeEffect":"zoom","openEffect":"zoom","loop":false});
    (function() {
      let previousOnload = window.onload;
      window.onload = () => {
        if (previousOnload) {
          previousOnload();
        }
        lightboxQuarto.on('slide_before_load', (data) => {
          const { slideIndex, slideNode, slideConfig, player, trigger } = data;
          const href = trigger.getAttribute('href');
          if (href !== null) {
            const imgEl = window.document.querySelector(`a[href="${href}"] img`);
            if (imgEl !== null) {
              const srcAttr = imgEl.getAttribute("src");
              if (srcAttr && srcAttr.startsWith("data:")) {
                slideConfig.href = srcAttr;
              }
            }
          } 
        });
      
        lightboxQuarto.on('slide_after_load', (data) => {
          const { slideIndex, slideNode, slideConfig, player, trigger } = data;
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(slideNode);
          }
        });
      
      };
      
    })();
              </script>
    

</body></html>